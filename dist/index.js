// @bun
var _9=Object.create;var{getPrototypeOf:w9,defineProperty:R2,getOwnPropertyNames:S9}=Object;var y9=Object.prototype.hasOwnProperty;var b3=(Y,M,$)=>{$=Y!=null?_9(w9(Y)):{};let X=M||!Y||!Y.__esModule?R2($,"default",{value:Y,enumerable:!0}):$;for(let O of S9(Y))if(!y9.call(X,O))R2(X,O,{get:()=>Y[O],enumerable:!0});return X};var y0=(Y,M)=>()=>(M||Y((M={exports:{}}).exports,M),M.exports);var h1=(Y,M)=>{for(var $ in M)R2(Y,$,{get:M[$],enumerable:!0,configurable:!0,set:(X)=>M[$]=()=>X})};var r$=y0((h8,m1)=>{var P$,f$,j$,T$,E$,k$,D$,v$,H$,I$,x$,_$,w$,p1,N2,S$,y$,g$,m3,u$,h$,p$,b$,m$,c$,d$,i$,n$,b1,l$,o$,s$;(function(Y){var M=typeof global==="object"?global:typeof self==="object"?self:typeof this==="object"?this:{};if(typeof define==="function"&&define.amd)define("tslib",["exports"],function(X){Y($(M,$(X)))});else if(typeof m1==="object"&&typeof h8==="object")Y($(M,$(h8)));else Y($(M));function $(X,O){if(X!==M)if(typeof Object.create==="function")Object.defineProperty(X,"__esModule",{value:!0});else X.__esModule=!0;return function(J,z){return X[J]=O?O(J,z):z}}})(function(Y){var M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,z){J.__proto__=z}||function(J,z){for(var V in z)if(Object.prototype.hasOwnProperty.call(z,V))J[V]=z[V]};P$=function(J,z){if(typeof z!=="function"&&z!==null)throw TypeError("Class extends value "+String(z)+" is not a constructor or null");M(J,z);function V(){this.constructor=J}J.prototype=z===null?Object.create(z):(V.prototype=z.prototype,new V)},f$=Object.assign||function(J){for(var z,V=1,F=arguments.length;V<F;V++){z=arguments[V];for(var L in z)if(Object.prototype.hasOwnProperty.call(z,L))J[L]=z[L]}return J},j$=function(J,z){var V={};for(var F in J)if(Object.prototype.hasOwnProperty.call(J,F)&&z.indexOf(F)<0)V[F]=J[F];if(J!=null&&typeof Object.getOwnPropertySymbols==="function"){for(var L=0,F=Object.getOwnPropertySymbols(J);L<F.length;L++)if(z.indexOf(F[L])<0&&Object.prototype.propertyIsEnumerable.call(J,F[L]))V[F[L]]=J[F[L]]}return V},T$=function(J,z,V,F){var L=arguments.length,R=L<3?z:F===null?F=Object.getOwnPropertyDescriptor(z,V):F,U;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")R=Reflect.decorate(J,z,V,F);else for(var q=J.length-1;q>=0;q--)if(U=J[q])R=(L<3?U(R):L>3?U(z,V,R):U(z,V))||R;return L>3&&R&&Object.defineProperty(z,V,R),R},E$=function(J,z){return function(V,F){z(V,F,J)}},k$=function(J,z,V,F,L,R){function U($0){if($0!==void 0&&typeof $0!=="function")throw TypeError("Function expected");return $0}var q=F.kind,f=q==="getter"?"get":q==="setter"?"set":"value",C=!z&&J?F.static?J:J.prototype:null,A=z||(C?Object.getOwnPropertyDescriptor(C,F.name):{}),j,w=!1;for(var D=V.length-1;D>=0;D--){var h={};for(var y in F)h[y]=y==="access"?{}:F[y];for(var y in F.access)h.access[y]=F.access[y];h.addInitializer=function($0){if(w)throw TypeError("Cannot add initializers after decoration has completed");R.push(U($0||null))};var n=(0,V[D])(q==="accessor"?{get:A.get,set:A.set}:A[f],h);if(q==="accessor"){if(n===void 0)continue;if(n===null||typeof n!=="object")throw TypeError("Object expected");if(j=U(n.get))A.get=j;if(j=U(n.set))A.set=j;if(j=U(n.init))L.unshift(j)}else if(j=U(n))if(q==="field")L.unshift(j);else A[f]=j}if(C)Object.defineProperty(C,F.name,A);w=!0},D$=function(J,z,V){var F=arguments.length>2;for(var L=0;L<z.length;L++)V=F?z[L].call(J,V):z[L].call(J);return F?V:void 0},v$=function(J){return typeof J==="symbol"?J:"".concat(J)},H$=function(J,z,V){if(typeof z==="symbol")z=z.description?"[".concat(z.description,"]"):"";return Object.defineProperty(J,"name",{configurable:!0,value:V?"".concat(V," ",z):z})},I$=function(J,z){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(J,z)},x$=function(J,z,V,F){function L(R){return R instanceof V?R:new V(function(U){U(R)})}return new(V||(V=Promise))(function(R,U){function q(A){try{C(F.next(A))}catch(j){U(j)}}function f(A){try{C(F.throw(A))}catch(j){U(j)}}function C(A){A.done?R(A.value):L(A.value).then(q,f)}C((F=F.apply(J,z||[])).next())})},_$=function(J,z){var V={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},F,L,R,U=Object.create((typeof Iterator==="function"?Iterator:Object).prototype);return U.next=q(0),U.throw=q(1),U.return=q(2),typeof Symbol==="function"&&(U[Symbol.iterator]=function(){return this}),U;function q(C){return function(A){return f([C,A])}}function f(C){if(F)throw TypeError("Generator is already executing.");while(U&&(U=0,C[0]&&(V=0)),V)try{if(F=1,L&&(R=C[0]&2?L.return:C[0]?L.throw||((R=L.return)&&R.call(L),0):L.next)&&!(R=R.call(L,C[1])).done)return R;if(L=0,R)C=[C[0]&2,R.value];switch(C[0]){case 0:case 1:R=C;break;case 4:return V.label++,{value:C[1],done:!1};case 5:V.label++,L=C[1],C=[0];continue;case 7:C=V.ops.pop(),V.trys.pop();continue;default:if((R=V.trys,!(R=R.length>0&&R[R.length-1]))&&(C[0]===6||C[0]===2)){V=0;continue}if(C[0]===3&&(!R||C[1]>R[0]&&C[1]<R[3])){V.label=C[1];break}if(C[0]===6&&V.label<R[1]){V.label=R[1],R=C;break}if(R&&V.label<R[2]){V.label=R[2],V.ops.push(C);break}if(R[2])V.ops.pop();V.trys.pop();continue}C=z.call(J,V)}catch(A){C=[6,A],L=0}finally{F=R=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},w$=function(J,z){for(var V in J)if(V!=="default"&&!Object.prototype.hasOwnProperty.call(z,V))b1(z,J,V)},b1=Object.create?function(J,z,V,F){if(F===void 0)F=V;var L=Object.getOwnPropertyDescriptor(z,V);if(!L||("get"in L?!z.__esModule:L.writable||L.configurable))L={enumerable:!0,get:function(){return z[V]}};Object.defineProperty(J,F,L)}:function(J,z,V,F){if(F===void 0)F=V;J[F]=z[V]},p1=function(J){var z=typeof Symbol==="function"&&Symbol.iterator,V=z&&J[z],F=0;if(V)return V.call(J);if(J&&typeof J.length==="number")return{next:function(){if(J&&F>=J.length)J=void 0;return{value:J&&J[F++],done:!J}}};throw TypeError(z?"Object is not iterable.":"Symbol.iterator is not defined.")},N2=function(J,z){var V=typeof Symbol==="function"&&J[Symbol.iterator];if(!V)return J;var F=V.call(J),L,R=[],U;try{while((z===void 0||z-- >0)&&!(L=F.next()).done)R.push(L.value)}catch(q){U={error:q}}finally{try{if(L&&!L.done&&(V=F.return))V.call(F)}finally{if(U)throw U.error}}return R},S$=function(){for(var J=[],z=0;z<arguments.length;z++)J=J.concat(N2(arguments[z]));return J},y$=function(){for(var J=0,z=0,V=arguments.length;z<V;z++)J+=arguments[z].length;for(var F=Array(J),L=0,z=0;z<V;z++)for(var R=arguments[z],U=0,q=R.length;U<q;U++,L++)F[L]=R[U];return F},g$=function(J,z,V){if(V||arguments.length===2){for(var F=0,L=z.length,R;F<L;F++)if(R||!(F in z)){if(!R)R=Array.prototype.slice.call(z,0,F);R[F]=z[F]}}return J.concat(R||Array.prototype.slice.call(z))},m3=function(J){return this instanceof m3?(this.v=J,this):new m3(J)},u$=function(J,z,V){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var F=V.apply(J,z||[]),L,R=[];return L=Object.create((typeof AsyncIterator==="function"?AsyncIterator:Object).prototype),q("next"),q("throw"),q("return",U),L[Symbol.asyncIterator]=function(){return this},L;function U(D){return function(h){return Promise.resolve(h).then(D,j)}}function q(D,h){if(F[D]){if(L[D]=function(y){return new Promise(function(n,$0){R.push([D,y,n,$0])>1||f(D,y)})},h)L[D]=h(L[D])}}function f(D,h){try{C(F[D](h))}catch(y){w(R[0][3],y)}}function C(D){D.value instanceof m3?Promise.resolve(D.value.v).then(A,j):w(R[0][2],D)}function A(D){f("next",D)}function j(D){f("throw",D)}function w(D,h){if(D(h),R.shift(),R.length)f(R[0][0],R[0][1])}},h$=function(J){var z,V;return z={},F("next"),F("throw",function(L){throw L}),F("return"),z[Symbol.iterator]=function(){return this},z;function F(L,R){z[L]=J[L]?function(U){return(V=!V)?{value:m3(J[L](U)),done:!1}:R?R(U):U}:R}},p$=function(J){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var z=J[Symbol.asyncIterator],V;return z?z.call(J):(J=typeof p1==="function"?p1(J):J[Symbol.iterator](),V={},F("next"),F("throw"),F("return"),V[Symbol.asyncIterator]=function(){return this},V);function F(R){V[R]=J[R]&&function(U){return new Promise(function(q,f){U=J[R](U),L(q,f,U.done,U.value)})}}function L(R,U,q,f){Promise.resolve(f).then(function(C){R({value:C,done:q})},U)}},b$=function(J,z){if(Object.defineProperty)Object.defineProperty(J,"raw",{value:z});else J.raw=z;return J};var $=Object.create?function(J,z){Object.defineProperty(J,"default",{enumerable:!0,value:z})}:function(J,z){J.default=z},X=function(J){return X=Object.getOwnPropertyNames||function(z){var V=[];for(var F in z)if(Object.prototype.hasOwnProperty.call(z,F))V[V.length]=F;return V},X(J)};m$=function(J){if(J&&J.__esModule)return J;var z={};if(J!=null){for(var V=X(J),F=0;F<V.length;F++)if(V[F]!=="default")b1(z,J,V[F])}return $(z,J),z},c$=function(J){return J&&J.__esModule?J:{default:J}},d$=function(J,z,V,F){if(V==="a"&&!F)throw TypeError("Private accessor was defined without a getter");if(typeof z==="function"?J!==z||!F:!z.has(J))throw TypeError("Cannot read private member from an object whose class did not declare it");return V==="m"?F:V==="a"?F.call(J):F?F.value:z.get(J)},i$=function(J,z,V,F,L){if(F==="m")throw TypeError("Private method is not writable");if(F==="a"&&!L)throw TypeError("Private accessor was defined without a setter");if(typeof z==="function"?J!==z||!L:!z.has(J))throw TypeError("Cannot write private member to an object whose class did not declare it");return F==="a"?L.call(J,V):L?L.value=V:z.set(J,V),V},n$=function(J,z){if(z===null||typeof z!=="object"&&typeof z!=="function")throw TypeError("Cannot use 'in' operator on non-object");return typeof J==="function"?z===J:J.has(z)},l$=function(J,z,V){if(z!==null&&z!==void 0){if(typeof z!=="object"&&typeof z!=="function")throw TypeError("Object expected.");var F,L;if(V){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");F=z[Symbol.asyncDispose]}if(F===void 0){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");if(F=z[Symbol.dispose],V)L=F}if(typeof F!=="function")throw TypeError("Object not disposable.");if(L)F=function(){try{L.call(this)}catch(R){return Promise.reject(R)}};J.stack.push({value:z,dispose:F,async:V})}else if(V)J.stack.push({async:!0});return z};var O=typeof SuppressedError==="function"?SuppressedError:function(J,z,V){var F=Error(V);return F.name="SuppressedError",F.error=J,F.suppressed=z,F};o$=function(J){function z(R){J.error=J.hasError?new O(R,J.error,"An error was suppressed during disposal."):R,J.hasError=!0}var V,F=0;function L(){while(V=J.stack.pop())try{if(!V.async&&F===1)return F=0,J.stack.push(V),Promise.resolve().then(L);if(V.dispose){var R=V.dispose.call(V.value);if(V.async)return F|=2,Promise.resolve(R).then(L,function(U){return z(U),L()})}else F|=1}catch(U){z(U)}if(F===1)return J.hasError?Promise.reject(J.error):Promise.resolve();if(J.hasError)throw J.error}return L()},s$=function(J,z){if(typeof J==="string"&&/^\.\.?\//.test(J))return J.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(V,F,L,R,U){return F?z?".jsx":".js":L&&(!R||!U)?V:L+R+"."+U.toLowerCase()+"js"});return J},Y("__extends",P$),Y("__assign",f$),Y("__rest",j$),Y("__decorate",T$),Y("__param",E$),Y("__esDecorate",k$),Y("__runInitializers",D$),Y("__propKey",v$),Y("__setFunctionName",H$),Y("__metadata",I$),Y("__awaiter",x$),Y("__generator",_$),Y("__exportStar",w$),Y("__createBinding",b1),Y("__values",p1),Y("__read",N2),Y("__spread",S$),Y("__spreadArrays",y$),Y("__spreadArray",g$),Y("__await",m3),Y("__asyncGenerator",u$),Y("__asyncDelegator",h$),Y("__asyncValues",p$),Y("__makeTemplateObject",b$),Y("__importStar",m$),Y("__importDefault",c$),Y("__classPrivateFieldGet",d$),Y("__classPrivateFieldSet",i$),Y("__classPrivateFieldIn",n$),Y("__addDisposableResource",l$),Y("__disposeResources",o$),Y("__rewriteRelativeImportExtension",s$)})});var n1=y0((oY,$6)=>{var f2=Object.prototype.hasOwnProperty,l3=Array.isArray,R0=function(){var Y=[];for(var M=0;M<256;++M)Y.push("%"+((M<16?"0":"")+M.toString(16)).toUpperCase());return Y}(),p9=function(M){while(M.length>1){var $=M.pop(),X=$.obj[$.prop];if(l3(X)){var O=[];for(var J=0;J<X.length;++J)if(typeof X[J]<"u")O.push(X[J]);$.obj[$.prop]=O}}},M6=function(M,$){var X=$&&$.plainObjects?Object.create(null):{};for(var O=0;O<M.length;++O)if(typeof M[O]<"u")X[O]=M[O];return X},b9=function Y(M,$,X){if(!$)return M;if(typeof $!=="object"){if(l3(M))M.push($);else if(M&&typeof M==="object"){if(X&&(X.plainObjects||X.allowPrototypes)||!f2.call(Object.prototype,$))M[$]=!0}else return[M,$];return M}if(!M||typeof M!=="object")return[M].concat($);var O=M;if(l3(M)&&!l3($))O=M6(M,X);if(l3(M)&&l3($))return $.forEach(function(J,z){if(f2.call(M,z)){var V=M[z];if(V&&typeof V==="object"&&J&&typeof J==="object")M[z]=Y(V,J,X);else M.push(J)}else M[z]=J}),M;return Object.keys($).reduce(function(J,z){var V=$[z];if(f2.call(J,z))J[z]=Y(J[z],V,X);else J[z]=V;return J},O)},m9=function(M,$){return Object.keys($).reduce(function(X,O){return X[O]=$[O],X},M)},c9=function(Y,M,$){var X=Y.replace(/\+/g," ");if($==="iso-8859-1")return X.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(X)}catch(O){return X}},d9=function(M,$,X){if(M.length===0)return M;var O=M;if(typeof M==="symbol")O=Symbol.prototype.toString.call(M);else if(typeof M!=="string")O=String(M);if(X==="iso-8859-1")return escape(O).replace(/%u[0-9a-f]{4}/gi,function(F){return"%26%23"+parseInt(F.slice(2),16)+"%3B"});var J="";for(var z=0;z<O.length;++z){var V=O.charCodeAt(z);if(V===45||V===46||V===95||V===126||V>=48&&V<=57||V>=65&&V<=90||V>=97&&V<=122){J+=O.charAt(z);continue}if(V<128){J=J+R0[V];continue}if(V<2048){J=J+(R0[192|V>>6]+R0[128|V&63]);continue}if(V<55296||V>=57344){J=J+(R0[224|V>>12]+R0[128|V>>6&63]+R0[128|V&63]);continue}z+=1,V=65536+((V&1023)<<10|O.charCodeAt(z)&1023),J+=R0[240|V>>18]+R0[128|V>>12&63]+R0[128|V>>6&63]+R0[128|V&63]}return J},i9=function(M){var $=[{obj:{o:M},prop:"o"}],X=[];for(var O=0;O<$.length;++O){var J=$[O],z=J.obj[J.prop],V=Object.keys(z);for(var F=0;F<V.length;++F){var L=V[F],R=z[L];if(typeof R==="object"&&R!==null&&X.indexOf(R)===-1)$.push({obj:z,prop:L}),X.push(R)}}return p9($),M},n9=function(M){return Object.prototype.toString.call(M)==="[object RegExp]"},l9=function(M){if(!M||typeof M!=="object")return!1;return!!(M.constructor&&M.constructor.isBuffer&&M.constructor.isBuffer(M))},o9=function(M,$){return[].concat(M,$)};$6.exports={arrayToObject:M6,assign:m9,combine:o9,compact:i9,decode:c9,encode:d9,isBuffer:l9,isRegExp:n9,merge:b9}});var j2=y0((sY,X6)=>{var s9=String.prototype.replace,r9=/%20/g,t9=n1(),Y6={RFC1738:"RFC1738",RFC3986:"RFC3986"};X6.exports=t9.assign({default:Y6.RFC3986,formatters:{RFC1738:function(Y){return s9.call(Y,r9,"+")},RFC3986:function(Y){return String(Y)}}},Y6)});var z6=y0((rY,W6)=>{var J6=n1(),oM=j2(),a9=Object.prototype.hasOwnProperty,Z6={brackets:function(M){return M+"[]"},comma:"comma",indices:function(M,$){return M+"["+$+"]"},repeat:function(M){return M}},o3=Array.isArray,e9=Array.prototype.push,T2=function(Y,M){e9.apply(Y,o3(M)?M:[M])},M8=Date.prototype.toISOString,O6=oM.default,o={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:J6.encode,encodeValuesOnly:!1,format:O6,formatter:oM.formatters[O6],indices:!1,serializeDate:function(M){return M8.call(M)},skipNulls:!1,strictNullHandling:!1},$8=function(M){return typeof M==="string"||typeof M==="number"||typeof M==="boolean"||typeof M==="symbol"||typeof M==="bigint"},Y8=function Y(M,$,X,O,J,z,V,F,L,R,U,q,f){var C=M;if(typeof V==="function")C=V($,C);else if(C instanceof Date)C=R(C);else if(X==="comma"&&o3(C))C=C.join(",");if(C===null){if(O)return z&&!q?z($,o.encoder,f,"key"):$;C=""}if($8(C)||J6.isBuffer(C)){if(z){var A=q?$:z($,o.encoder,f,"key");return[U(A)+"="+U(z(C,o.encoder,f,"value"))]}return[U($)+"="+U(String(C))]}var j=[];if(typeof C>"u")return j;var w;if(o3(V))w=V;else{var D=Object.keys(C);w=F?D.sort(F):D}for(var h=0;h<w.length;++h){var y=w[h];if(J&&C[y]===null)continue;if(o3(C))T2(j,Y(C[y],typeof X==="function"?X($,y):$,X,O,J,z,V,F,L,R,U,q,f));else T2(j,Y(C[y],$+(L?"."+y:"["+y+"]"),X,O,J,z,V,F,L,R,U,q,f))}return j},X8=function(M){if(!M)return o;if(M.encoder!==null&&M.encoder!==void 0&&typeof M.encoder!=="function")throw TypeError("Encoder has to be a function.");var $=M.charset||o.charset;if(typeof M.charset<"u"&&M.charset!=="utf-8"&&M.charset!=="iso-8859-1")throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var X=oM.default;if(typeof M.format<"u"){if(!a9.call(oM.formatters,M.format))throw TypeError("Unknown format option provided.");X=M.format}var O=oM.formatters[X],J=o.filter;if(typeof M.filter==="function"||o3(M.filter))J=M.filter;return{addQueryPrefix:typeof M.addQueryPrefix==="boolean"?M.addQueryPrefix:o.addQueryPrefix,allowDots:typeof M.allowDots>"u"?o.allowDots:!!M.allowDots,charset:$,charsetSentinel:typeof M.charsetSentinel==="boolean"?M.charsetSentinel:o.charsetSentinel,delimiter:typeof M.delimiter>"u"?o.delimiter:M.delimiter,encode:typeof M.encode==="boolean"?M.encode:o.encode,encoder:typeof M.encoder==="function"?M.encoder:o.encoder,encodeValuesOnly:typeof M.encodeValuesOnly==="boolean"?M.encodeValuesOnly:o.encodeValuesOnly,filter:J,formatter:O,serializeDate:typeof M.serializeDate==="function"?M.serializeDate:o.serializeDate,skipNulls:typeof M.skipNulls==="boolean"?M.skipNulls:o.skipNulls,sort:typeof M.sort==="function"?M.sort:null,strictNullHandling:typeof M.strictNullHandling==="boolean"?M.strictNullHandling:o.strictNullHandling}};W6.exports=function(Y,M){var $=Y,X=X8(M),O,J;if(typeof X.filter==="function")J=X.filter,$=J("",$);else if(o3(X.filter))J=X.filter,O=J;var z=[];if(typeof $!=="object"||$===null)return"";var V;if(M&&M.arrayFormat in Z6)V=M.arrayFormat;else if(M&&"indices"in M)V=M.indices?"indices":"repeat";else V="indices";var F=Z6[V];if(!O)O=Object.keys($);if(X.sort)O.sort(X.sort);for(var L=0;L<O.length;++L){var R=O[L];if(X.skipNulls&&$[R]===null)continue;T2(z,Y8($[R],R,F,X.strictNullHandling,X.skipNulls,X.encode?X.encoder:null,X.filter,X.sort,X.allowDots,X.serializeDate,X.formatter,X.encodeValuesOnly,X.charset))}var U=z.join(X.delimiter),q=X.addQueryPrefix===!0?"?":"";if(X.charsetSentinel)if(X.charset==="iso-8859-1")q+="utf8=%26%2310003%3B&";else q+="utf8=%E2%9C%93&";return U.length>0?q+U:""}});var F6=y0((tY,Q6)=>{var sM=n1(),E2=Object.prototype.hasOwnProperty,V6=Array.isArray,l={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:sM.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1000,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Z8=function(Y){return Y.replace(/&#(\d+);/g,function(M,$){return String.fromCharCode(parseInt($,10))})},K6=function(Y,M){if(Y&&typeof Y==="string"&&M.comma&&Y.indexOf(",")>-1)return Y.split(",");return Y},O8=function(M,$){if(V6(M)){var X=[];for(var O=0;O<M.length;O+=1)X.push($(M[O]));return X}return $(M)},J8="utf8=%26%2310003%3B",W8="utf8=%E2%9C%93",z8=function(M,$){var X={},O=$.ignoreQueryPrefix?M.replace(/^\?/,""):M,J=$.parameterLimit===1/0?void 0:$.parameterLimit,z=O.split($.delimiter,J),V=-1,F,L=$.charset;if($.charsetSentinel){for(F=0;F<z.length;++F)if(z[F].indexOf("utf8=")===0){if(z[F]===W8)L="utf-8";else if(z[F]===J8)L="iso-8859-1";V=F,F=z.length}}for(F=0;F<z.length;++F){if(F===V)continue;var R=z[F],U=R.indexOf("]="),q=U===-1?R.indexOf("="):U+1,f,C;if(q===-1)f=$.decoder(R,l.decoder,L,"key"),C=$.strictNullHandling?null:"";else f=$.decoder(R.slice(0,q),l.decoder,L,"key"),C=O8(K6(R.slice(q+1),$),function(A){return $.decoder(A,l.decoder,L,"value")});if(C&&$.interpretNumericEntities&&L==="iso-8859-1")C=Z8(C);if(R.indexOf("[]=")>-1)C=V6(C)?[C]:C;if(E2.call(X,f))X[f]=sM.combine(X[f],C);else X[f]=C}return X},V8=function(Y,M,$,X){var O=X?M:K6(M,$);for(var J=Y.length-1;J>=0;--J){var z,V=Y[J];if(V==="[]"&&$.parseArrays)z=[].concat(O);else{z=$.plainObjects?Object.create(null):{};var F=V.charAt(0)==="["&&V.charAt(V.length-1)==="]"?V.slice(1,-1):V,L=parseInt(F,10);if(!$.parseArrays&&F==="")z={0:O};else if(!isNaN(L)&&V!==F&&String(L)===F&&L>=0&&($.parseArrays&&L<=$.arrayLimit))z=[],z[L]=O;else z[F]=O}O=z}return O},K8=function(M,$,X,O){if(!M)return;var J=X.allowDots?M.replace(/\.([^.[]+)/g,"[$1]"):M,z=/(\[[^[\]]*])/,V=/(\[[^[\]]*])/g,F=X.depth>0&&z.exec(J),L=F?J.slice(0,F.index):J,R=[];if(L){if(!X.plainObjects&&E2.call(Object.prototype,L)){if(!X.allowPrototypes)return}R.push(L)}var U=0;while(X.depth>0&&(F=V.exec(J))!==null&&U<X.depth){if(U+=1,!X.plainObjects&&E2.call(Object.prototype,F[1].slice(1,-1))){if(!X.allowPrototypes)return}R.push(F[1])}if(F)R.push("["+J.slice(F.index)+"]");return V8(R,$,X,O)},Q8=function(M){if(!M)return l;if(M.decoder!==null&&M.decoder!==void 0&&typeof M.decoder!=="function")throw TypeError("Decoder has to be a function.");if(typeof M.charset<"u"&&M.charset!=="utf-8"&&M.charset!=="iso-8859-1")throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var $=typeof M.charset>"u"?l.charset:M.charset;return{allowDots:typeof M.allowDots>"u"?l.allowDots:!!M.allowDots,allowPrototypes:typeof M.allowPrototypes==="boolean"?M.allowPrototypes:l.allowPrototypes,arrayLimit:typeof M.arrayLimit==="number"?M.arrayLimit:l.arrayLimit,charset:$,charsetSentinel:typeof M.charsetSentinel==="boolean"?M.charsetSentinel:l.charsetSentinel,comma:typeof M.comma==="boolean"?M.comma:l.comma,decoder:typeof M.decoder==="function"?M.decoder:l.decoder,delimiter:typeof M.delimiter==="string"||sM.isRegExp(M.delimiter)?M.delimiter:l.delimiter,depth:typeof M.depth==="number"||M.depth===!1?+M.depth:l.depth,ignoreQueryPrefix:M.ignoreQueryPrefix===!0,interpretNumericEntities:typeof M.interpretNumericEntities==="boolean"?M.interpretNumericEntities:l.interpretNumericEntities,parameterLimit:typeof M.parameterLimit==="number"?M.parameterLimit:l.parameterLimit,parseArrays:M.parseArrays!==!1,plainObjects:typeof M.plainObjects==="boolean"?M.plainObjects:l.plainObjects,strictNullHandling:typeof M.strictNullHandling==="boolean"?M.strictNullHandling:l.strictNullHandling}};Q6.exports=function(Y,M){var $=Q8(M);if(Y===""||Y===null||typeof Y>"u")return $.plainObjects?Object.create(null):{};var X=typeof Y==="string"?z8(Y,$):Y,O=$.plainObjects?Object.create(null):{},J=Object.keys(X);for(var z=0;z<J.length;++z){var V=J[z],F=K8(V,X[V],$,typeof Y==="string");O=sM.merge(O,F,$)}return sM.compact(O)}});var T6=y0((QJ,j6)=>{function X0(Y,M){if(typeof M==="boolean")M={forever:M};if(this._originalTimeouts=JSON.parse(JSON.stringify(Y)),this._timeouts=Y,this._options=M||{},this._maxRetryTime=M&&M.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever)this._cachedTimeouts=this._timeouts.slice(0)}j6.exports=X0;X0.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};X0.prototype.stop=function(){if(this._timeout)clearTimeout(this._timeout);if(this._timer)clearTimeout(this._timer);this._timeouts=[],this._cachedTimeouts=null};X0.prototype.retry=function(Y){if(this._timeout)clearTimeout(this._timeout);if(!Y)return!1;var M=new Date().getTime();if(Y&&M-this._operationStart>=this._maxRetryTime)return this._errors.push(Y),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(Y);var $=this._timeouts.shift();if($===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),$=this._cachedTimeouts.slice(-1);else return!1;var X=this;if(this._timer=setTimeout(function(){if(X._attempts++,X._operationTimeoutCb){if(X._timeout=setTimeout(function(){X._operationTimeoutCb(X._attempts)},X._operationTimeout),X._options.unref)X._timeout.unref()}X._fn(X._attempts)},$),this._options.unref)this._timer.unref();return!0};X0.prototype.attempt=function(Y,M){if(this._fn=Y,M){if(M.timeout)this._operationTimeout=M.timeout;if(M.cb)this._operationTimeoutCb=M.cb}var $=this;if(this._operationTimeoutCb)this._timeout=setTimeout(function(){$._operationTimeoutCb()},$._operationTimeout);this._operationStart=new Date().getTime(),this._fn(this._attempts)};X0.prototype.try=function(Y){console.log("Using RetryOperation.try() is deprecated"),this.attempt(Y)};X0.prototype.start=function(Y){console.log("Using RetryOperation.start() is deprecated"),this.attempt(Y)};X0.prototype.start=X0.prototype.try;X0.prototype.errors=function(){return this._errors};X0.prototype.attempts=function(){return this._attempts};X0.prototype.mainError=function(){if(this._errors.length===0)return null;var Y={},M=null,$=0;for(var X=0;X<this._errors.length;X++){var O=this._errors[X],J=O.message,z=(Y[J]||0)+1;if(Y[J]=z,z>=$)M=O,$=z}return M}});var k6=y0((T8)=>{var j8=T6();T8.operation=function(Y){var M=T8.timeouts(Y);return new j8(M,{forever:Y&&(Y.forever||Y.retries===1/0),unref:Y&&Y.unref,maxRetryTime:Y&&Y.maxRetryTime})};T8.timeouts=function(Y){if(Y instanceof Array)return[].concat(Y);var M={retries:10,factor:2,minTimeout:1000,maxTimeout:1/0,randomize:!1};for(var $ in Y)M[$]=Y[$];if(M.minTimeout>M.maxTimeout)throw Error("minTimeout is greater than maxTimeout");var X=[];for(var O=0;O<M.retries;O++)X.push(this.createTimeout(O,M));if(Y&&Y.forever&&!X.length)X.push(this.createTimeout(O,M));return X.sort(function(J,z){return J-z}),X};T8.createTimeout=function(Y,M){var $=M.randomize?Math.random()+1:1,X=Math.round($*Math.max(M.minTimeout,1)*Math.pow(M.factor,Y));return X=Math.min(X,M.maxTimeout),X};T8.wrap=function(Y,M,$){if(M instanceof Array)$=M,M=null;if(!$){$=[];for(var X in Y)if(typeof Y[X]==="function")$.push(X)}for(var O=0;O<$.length;O++){var J=$[O],z=Y[J];Y[J]=function(F){var L=T8.operation(M),R=Array.prototype.slice.call(arguments,1),U=R.pop();R.push(function(q){if(L.retry(q))return;if(q)arguments[0]=L.mainError();U.apply(this,arguments)}),L.attempt(function(){F.apply(Y,R)})}.bind(Y,z),Y[J].options=M}}});var q9=y0((sN,c4)=>{c4.exports=(Y)=>{if(typeof Y!=="string")throw TypeError("Expected a string");return Y.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")};c4.exports.default=c4.exports});function U$(){let M=["TWITCH_CLIENT_ID","TWITCH_CLIENT_SECRET","TWITCH_ACCESS_TOKEN","TWITCH_REFRESH_TOKEN","TWITCH_CHANNELS"].filter((X)=>!process.env[X]);if(M.length>0)throw Error(`Missing required environment variables: ${M.join(", ")}`);let $=process.env.TWITCH_CHANNELS.split(",").map((X)=>X.trim()).filter((X)=>X.length>0);if($.length===0)throw Error("TWITCH_CHANNELS must contain at least one channel name");return{clientId:process.env.TWITCH_CLIENT_ID,clientSecret:process.env.TWITCH_CLIENT_SECRET,accessToken:process.env.TWITCH_ACCESS_TOKEN,refreshToken:process.env.TWITCH_REFRESH_TOKEN,channels:$}}function G(Y){if(Y===void 0)Y=!0;return function(M,$){Object.defineProperty(M,$,{get:function(){return},set:function(X){Object.defineProperty(this,$,{value:X,writable:!0,enumerable:Y})},enumerable:Y})}}var t$=b3(r$(),1),{__extends:c1,__assign:p8,__rest:b8,__decorate:W,__param:m8,__esDecorate:c8,__runInitializers:d8,__propKey:i8,__setFunctionName:n8,__metadata:l8,__awaiter:d1,__generator:c3,__exportStar:o8,__createBinding:s8,__values:r8,__read:L0,__spread:t8,__spreadArrays:a8,__spreadArray:V3,__await:e8,__asyncGenerator:MY,__asyncDelegator:$Y,__asyncValues:YY,__makeTemplateObject:XY,__importStar:ZY,__importDefault:OY,__classPrivateFieldGet:JY,__classPrivateFieldSet:WY,__classPrivateFieldIn:zY,__addDisposableResource:VY,__disposeResources:KY,__rewriteRelativeImportExtension:QY}=t$.default;function i1(Y){var M;return(M=[]).concat.apply(M,V3([],L0(Y),!1))}function d3(Y){return d1(this,void 0,Promise,function(){return c3(this,function(M){switch(M.label){case 0:if(typeof Y!=="function")return[3,2];return[4,Y()];case 1:return[2,M.sent()];case 2:return[2,Y]}})})}function C2(Y){if(typeof Y==="function")return Y();return Y}function nM(Y){var M,$,X;return c3(this,function(O){switch(O.label){case 0:M=0,$=1,O.label=1;case 1:if(!(M<Y))return[3,3];return[4,M];case 2:return O.sent(),X=L0([$,M+$],2),M=X[0],$=X[1],[3,1];case 3:return[4,Y];case 4:return O.sent(),[3,3];case 5:return[2]}})}function g0(Y,M){return Object.assign.apply(Object,V3([{}],L0(Y.map(M)),!1))}function i3(Y,M){Object.entries(Y).forEach(function($){var X=L0($,2),O=X[0],J=X[1];return M(J,O)})}function lM(Y,M){if(typeof M!=="function"){var $=M;M=function(X){return X[$].toString()}}return g0(Y,function(X){var O;return O={},O[M(X)]=X,O})}function A2(Y){return Y==null}function p(Y,M){return A2(Y)?null:M(Y)}function i(Y,M){return A2(Y)?void 0:M(Y)}function U2(Y){return d1(this,void 0,Promise,function(){return c3(this,function(M){switch(M.label){case 0:return[4,new Promise(function($){return setTimeout($,Y)})];case 1:return M.sent(),[2]}})})}function q0(){var Y,M,$=new Promise(function(X,O){Y=X,M=O});return{promise:$,resolve:Y,reject:M}}function P2(Y,M,$){if(typeof Y==="number")Y=Y.toString();if(M=M-Y.length,M<=0)return Y;if($===void 0)$=" ";var X="";do{if((M&1)===1)X+=$;if(M>>=1,M)$+=$}while(M);return X+Y}function J0(Y,M,$){var X=Y.split(M);if(X.length<=$)return X;return V3(V3([],L0(X.slice(0,$-1)),!1),[X.slice($-1).join(M)],!1)}var g9=60000;function u9(Y){return p(Y.expiresIn,(M)=>Y.obtainmentTimestamp+M*1000-g9)}function B0(Y){var M;return(M=p(u9(Y),($)=>Date.now()>$))!==null&&M!==void 0?M:!1}import*as n3 from"node-fetch";var h9=function(Y,M){if(/^\/\//.test(Y))Y="https:"+Y;return n3.default.call(this,Y,M)},e$=h9;var a$=n3.Headers;var rM=b3(z6(),1),F8=b3(F6(),1),G8=b3(j2(),1);var Z=Symbol("twurpleRawData");class P{constructor(Y){this[Z]=Y}}class b extends Error{constructor(Y,M){var $;super(Y,M);Object.setPrototypeOf(this,new.target.prototype),($=Error.captureStackTrace)===null||$===void 0||$.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}class k2 extends b{constructor(){super("Relation returned null - this may be a library bug or a race condition in your own code")}}function N(Y){if(Y==null)throw new k2;return Y}function Q(Y,M,$){return(X)=>{let O=$?function(){return`[${M}#${this[$]} - please check https://twurple.js.org/reference/${Y}/classes/${M}.html for available properties]`}:function(){return`[${M} - please check https://twurple.js.org/reference/${Y}/classes/${M}.html for available properties]`};Object.defineProperty(X.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:O,enumerable:!1})}}var tM=class extends P{get authorName(){return this[Z].author_name}get bitsEnabled(){return this[Z].bits_enabled}get installable(){return this[Z].can_install}get configurationLocation(){return this[Z].configuration_location}get description(){return this[Z].description}get tosUrl(){return this[Z].eula_tos_url}get hasChatSupport(){return this[Z].has_chat_support}get iconUrl(){return this[Z].icon_url}getIconUrl(M){return this[Z].icon_urls[M]}get id(){return this[Z].id}get name(){return this[Z].name}get privacyPolicyUrl(){return this[Z].privacy_policy_url}get requestsIdentityLink(){return this[Z].request_identity_link}get screenshotUrls(){return this[Z].screenshot_urls}get state(){return this[Z].state}get subscriptionsSupportLevel(){return this[Z].subscriptions_support_level}get summary(){return this[Z].summary}get supportEmail(){return this[Z].support_email}get version(){return this[Z].version}get viewerSummary(){return this[Z].viewer_summary}get viewerSummery(){return this[Z].viewer_summary}get allowedConfigUrls(){return this[Z].allowlisted_config_urls}get allowedPanelUrls(){return this[Z].allowlisted_panel_urls}get mobileViewerUrl(){var M,$;return($=(M=this[Z].views.mobile)===null||M===void 0?void 0:M.viewer_url)!==null&&$!==void 0?$:null}get panelViewerUrl(){var M,$;return($=(M=this[Z].views.panel)===null||M===void 0?void 0:M.viewer_url)!==null&&$!==void 0?$:null}get panelHeight(){var M,$;return($=(M=this[Z].views.panel)===null||M===void 0?void 0:M.height)!==null&&$!==void 0?$:null}get panelCanLinkExternalContent(){var M,$;return($=(M=this[Z].views.panel)===null||M===void 0?void 0:M.can_link_external_content)!==null&&$!==void 0?$:null}get overlayViewerUrl(){var M,$;return($=(M=this[Z].views.video_overlay)===null||M===void 0?void 0:M.viewer_url)!==null&&$!==void 0?$:null}get overlayCanLinkExternalContent(){var M,$;return($=(M=this[Z].views.video_overlay)===null||M===void 0?void 0:M.can_link_external_content)!==null&&$!==void 0?$:null}get componentViewerUrl(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.viewer_url)!==null&&$!==void 0?$:null}get componentAspectWidth(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.aspect_width)!==null&&$!==void 0?$:null}get componentAspectHeight(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.aspect_height)!==null&&$!==void 0?$:null}get componentAspectRatioX(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.aspect_ratio_x)!==null&&$!==void 0?$:null}get componentAspectRatioY(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.aspect_ratio_y)!==null&&$!==void 0?$:null}get componentAutoScales(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.autoscale)!==null&&$!==void 0?$:null}get componentScalePixels(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.scale_pixels)!==null&&$!==void 0?$:null}get componentTargetHeight(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.target_height)!==null&&$!==void 0?$:null}get componentSize(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.size)!==null&&$!==void 0?$:null}get componentZoom(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.zoom)!==null&&$!==void 0?$:null}get componentZoomPixels(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.zoom_pixels)!==null&&$!==void 0?$:null}get componentCanLinkExternalContent(){var M,$;return($=(M=this[Z].views.component)===null||M===void 0?void 0:M.can_link_external_content)!==null&&$!==void 0?$:null}get configViewerUrl(){var M,$;return($=(M=this[Z].views.config)===null||M===void 0?void 0:M.viewer_url)!==null&&$!==void 0?$:null}get configCanLinkExternalContent(){var M,$;return($=(M=this[Z].views.config)===null||M===void 0?void 0:M.can_link_external_content)!==null&&$!==void 0?$:null}};tM=W([Q("api","HelixExtension","id")],tM);class m extends b{constructor(Y){super(`${Y} - this should never happen, please file a bug in the GitHub issue tracker`)}}function K(Y){if(typeof Y==="string")return Y;if(typeof Y==="number")return Y.toString(10);return Y.id}function u0(Y){return typeof Y==="string"?Y:Y.name}class r extends b{constructor(Y,M,$,X,O,J){super(`Encountered HTTP status code ${Y}: ${M}

URL: ${$}
Method: ${X}
Body:
${!J&&O.length>150?`${O.slice(0,147)}...`:O}`);this._statusCode=Y,this._url=$,this._method=X,this._body=O}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function s3(Y,M){var $;if(!Y.ok){let X=Y.headers.get("Content-Type")==="application/json",O=X?JSON.stringify(await Y.json(),null,2):await Y.text(),J=rM.default(M.query,{arrayFormat:"repeat",addQueryPrefix:!0}),z=`${M.url}${J}`;throw new r(Y.status,Y.statusText,z,($=M.method)!==null&&$!==void 0?$:"GET",O,X)}}async function aM(Y){if(Y.status===204)return;let M=await Y.text();if(!M)return;return JSON.parse(M)}function G6(Y,M,$){switch(M){case"helix":{let X=Y.replace(/^\//,"");if($){if(X==="eventsub/subscriptions")return`http://localhost:${$}/${X}`;return`http://localhost:${$}/mock/${X}`}return`https://api.twitch.tv/helix/${X}`}case"auth":return`https://id.twitch.tv/oauth2/${Y.replace(/^\//,"")}`;case"custom":return Y;default:return Y}}async function h0(Y,M,$,X,O={},J){var z,V;let F=(z=Y.type)!==null&&z!==void 0?z:"helix",L=G6(Y.url,F,J),R=rM.default(Y.query,{arrayFormat:"repeat",addQueryPrefix:!0}),U=new a$({Accept:"application/json"}),q=void 0;if(Y.jsonBody)q=JSON.stringify(Y.jsonBody),U.append("Content-Type","application/json");if(M&&F!=="auth")U.append("Client-ID",M);if($)U.append("Authorization",`${F==="helix"?X!==null&&X!==void 0?X:"Bearer":"OAuth"} ${$}`);let f={...O,method:(V=Y.method)!==null&&V!==void 0?V:"GET",headers:U,body:q};return await e$(`${L}${R}`,f)}async function p0(Y,M,$,X,O={}){let J=await h0(Y,M,$,X,O);return await s3(J,Y),await aM(J)}function H(Y){return{broadcaster_id:K(Y)}}class a extends b{constructor(Y){super("Invalid token supplied",Y)}}class b0 extends b{}function L6(Y,M,$,X){return{grant_type:"authorization_code",client_id:Y,client_secret:M,code:$,redirect_uri:X}}function q6(Y,M){return{grant_type:"client_credentials",client_id:Y,client_secret:M}}function B6(Y,M,$){return{grant_type:"refresh_token",client_id:Y,client_secret:M,refresh_token:$}}var K3=class extends P{constructor(M){super(M);this._obtainmentDate=new Date}get clientId(){return this[Z].client_id}get userId(){var M;return(M=this[Z].user_id)!==null&&M!==void 0?M:null}get userName(){var M;return(M=this[Z].login)!==null&&M!==void 0?M:null}get scopes(){return this[Z].scopes}get expiryDate(){return p(this[Z].expires_in,(M)=>new Date(this._obtainmentDate.getTime()+M*1000))}};K3=W([Q("auth","TokenInfo","clientId")],K3);function D2(Y){var M,$;return{accessToken:Y.access_token,refreshToken:Y.refresh_token||null,scope:(M=Y.scope)!==null&&M!==void 0?M:[],expiresIn:($=Y.expires_in)!==null&&$!==void 0?$:null,obtainmentTimestamp:Date.now()}}async function v2(Y,M,$,X){return D2(await p0({type:"auth",url:"token",method:"POST",query:L6(Y,M,$,X)}))}async function H2(Y,M){return D2(await p0({type:"auth",url:"token",method:"POST",query:q6(Y,M)}))}async function l1(Y,M,$){return D2(await p0({type:"auth",url:"token",method:"POST",query:B6(Y,M,$)}))}async function m0(Y,M){try{let $=await p0({type:"auth",url:"validate"},M,Y);return new K3($)}catch($){if($ instanceof r&&$.statusCode===401)throw new a({cause:$});throw $}}var L8=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function q8(Y,M){if(M===null||M===void 0?void 0:M.length){let $=new Set(Y.flatMap((X)=>{var O;return[X,...(O=L8.get(X))!==null&&O!==void 0?O:[]]}));if(M.every((X)=>!$.has(X))){let X=M.join(", ");throw Error(`This token does not have any of the requested scopes (${X}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function eM(Y,M){for(let $ of M)q8(Y,$)}async function R6(Y,M,$,X,O){if((O===null||O===void 0?void 0:O.length)||!$){let J=await m0(M,Y);if(!J.userId)throw Error("Trying to use an app access token as a user access token");let z=X!==null&&X!==void 0?X:J.scopes;if(O)eM(z,O.filter((V)=>Boolean(V)));return[z,J.userId]}return[X,$]}class o1{constructor(Y){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=Y}async fetch(...Y){var M;let $=Y.filter((z)=>Boolean(z));if(this._newTokenPromise){if(!$.length)return await this._newTokenPromise;if(this._queueExecutor)this._queuedScopeSets.push(...$);else this._queuedScopeSets=[...$];if(!this._queuePromise){let{promise:z,resolve:V,reject:F}=q0();this._queuePromise=z,this._queueExecutor=async()=>{var L;if(!this._queuePromise)return;this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{V(await this._executor(this._newTokenScopeSets))}catch(R){F(R)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(L=this._queueExecutor)===null||L===void 0||L.call(this)}}}return await this._queuePromise}this._newTokenScopeSets=[...$];let{promise:X,resolve:O,reject:J}=q0();this._newTokenPromise=X;try{O(await this._executor(this._newTokenScopeSets))}catch(z){J(z)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(M=this._queueExecutor)===null||M===void 0||M.call(this)}return await X}}class I2{constructor(Y,M,$,X=!1){this.owner=Y,this.event=M,this.listener=$,this._internal=X}unbind(){this.owner.removeListener(this)}}class s{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(Y,M){return this._addListener(!1,Y,M)}addListener(Y,M){return this._addListener(!1,Y,M)}removeListener(Y,M){this._removeListener(!1,Y,M)}registerEvent(){let Y=(M)=>this.addListener(Y,M);return Y}emit(Y,...M){if(this._eventListeners.has(Y))for(let $ of this._eventListeners.get(Y))$(...M);if(this._internalEventListeners.has(Y))for(let $ of this._internalEventListeners.get(Y))$(...M)}registerInternalEvent(){let Y=(M)=>this.addInternalListener(Y,M);return Y}addInternalListener(Y,M){return this._addListener(!0,Y,M)}removeInternalListener(Y,M){this._removeListener(!0,Y,M)}_addListener(Y,M,$){let X=Y?this._eventListeners:this._internalEventListeners;if(X.has(M))X.get(M).push($);else X.set(M,[$]);return new I2(this,M,$,Y)}_removeListener(Y,M,$){let X=Y?this._eventListeners:this._internalEventListeners;if(!M)X.clear();else if(typeof M==="object"){let O=M;this._removeListener(O._internal,O.event,O.listener)}else{let O=M;if(X.has(O))if($){let J=X.get(O),z=0;while((z=J.indexOf($))!==-1)J.splice(z,1)}else X.delete(O)}}}class s1 extends b{constructor(Y){super(`The user context for the user ${Y} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`);this.userId=Y}}class x2 extends b{constructor(Y){super(`User ${Y} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`);this.userId=Y}}class _2 extends b{constructor(Y){super(`Unknown intent: ${Y}`);this.intent=Y}}var Y0=class extends s{constructor(M){var $;super();this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=M.clientId,this._clientSecret=M.clientSecret,this._redirectUri=M.redirectUri,this._appImpliedScopes=($=M.appImpliedScopes)!==null&&$!==void 0?$:[],this._appTokenFetcher=new o1(async(X)=>await this._fetchAppToken(X))}addUser(M,$,X){let O=K(M);if(!$.refreshToken)throw Error(`Trying to add user ${O} without refresh token`);if(this._cachedRefreshFailures.delete(O),this._userAccessTokens.set(O,{...$,userId:O}),!this._userTokenFetchers.has(O))this._userTokenFetchers.set(O,new o1(async(J)=>await this._fetchUserToken(O,J)));if(X)this.addIntentsToUser(M,X)}async addUserForToken(M,$){let X=null;if(M.accessToken&&!B0(M))try{let V=await m0(M.accessToken);X=[M,V]}catch(V){if(!(V instanceof a))throw V}if(!X){if(!M.refreshToken)throw new a;let V=await l1(this._clientId,this._clientSecret,M.refreshToken),F=await m0(V.accessToken);this.emit(this.onRefresh,F.userId,V),X=[V,F]}let[O,J]=X;if(!J.userId)throw new b0("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");let z=O.scope?O:{...O,scope:J.scopes};return this.addUser(J.userId,z,$),J.userId}async addUserForCode(M,$){if(!this._redirectUri)throw Error("This method requires you to pass a `redirectUri` as a configuration property");let X=await v2(this._clientId,this._clientSecret,M,this._redirectUri);return await this.addUserForToken(X,$)}hasUser(M){return this._userTokenFetchers.has(K(M))}removeUser(M){let $=K(M);if(this._userIdToIntents.has($)){let X=this._userIdToIntents.get($);for(let O of X)this._intentToUserId.delete(O);this._userIdToIntents.delete($)}this._userAccessTokens.delete($),this._userTokenFetchers.delete($),this._cachedRefreshFailures.delete($)}addIntentsToUser(M,$){let X=K(M);if(!this._userAccessTokens.has(X))throw Error("Trying to add intents to a user that was not added to this provider");for(let O of $){if(this._intentToUserId.has(O))this._userIdToIntents.get(this._intentToUserId.get(O)).delete(O);if(this._intentToUserId.set(O,X),this._userIdToIntents.has(X))this._userIdToIntents.get(X).add(O);else this._userIdToIntents.set(X,new Set([O]))}}getIntentsForUser(M){let $=K(M);return this._userIdToIntents.has($)?Array.from(this._userIdToIntents.get($)):[]}removeIntents(M){var $;for(let X of M)if(this._intentToUserId.has(X)){let O=this._intentToUserId.get(X);($=this._userIdToIntents.get(O))===null||$===void 0||$.delete(X),this._intentToUserId.delete(X)}}async refreshAccessTokenForUser(M){let $=K(M);if(this._cachedRefreshFailures.has($))throw new s1($);let X=this._userAccessTokens.get($);if(!X)throw Error("Trying to refresh token for user that was not added to the provider");let O=await this._refreshUserTokenWithCallback($,X.refreshToken);return this._checkIntermediateUserRemoval($),this._userAccessTokens.set($,{...O,userId:$}),this.emit(this.onRefresh,$,O),{...O,userId:$}}async refreshAccessTokenForIntent(M){if(!this._intentToUserId.has(M))throw new _2(M);let $=this._intentToUserId.get(M);return await this.refreshAccessTokenForUser($)}get clientId(){return this._clientId}getCurrentScopesForUser(M){var $;let X=this._userAccessTokens.get(K(M));if(!X)throw Error("Trying to get scopes for user that was not added to the provider");return($=X.scope)!==null&&$!==void 0?$:[]}async getAccessTokenForUser(M,...$){let X=K(M),O=this._userTokenFetchers.get(X);if(!O)return null;if(this._cachedRefreshFailures.has(X))throw new s1(X);return eM(this.getCurrentScopesForUser(X),$.filter(Boolean)),await O.fetch(...$)}async getAccessTokenForIntent(M,...$){if(!this._intentToUserId.has(M))return null;let X=this._intentToUserId.get(M),O=await this.getAccessTokenForUser(X,...$);if(!O)throw new m(`Found intent ${M} corresponding to user ID ${X} but no token was found`);return{...O,userId:X}}async getAnyAccessToken(M){if(M){let $=K(M);if(this._userAccessTokens.has($)){let X=await this.getAccessTokenForUser($);if(!X)throw new m(`Token for user ID ${$} exists but nothing was returned by getAccessTokenForUser`);return{...X,userId:$}}}return await this.getAppAccessToken()}async getAppAccessToken(M=!1){if(M)this._appAccessToken=void 0;return await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(($)=>[$]))}_checkIntermediateUserRemoval(M){if(!this._userTokenFetchers.has(M))throw this._cachedRefreshFailures.delete(M),new x2(M)}async _fetchUserToken(M,$){let X=this._userAccessTokens.get(M);if(!X)throw Error("Trying to get token for user that was not added to the provider");if(X.accessToken&&!B0(X))try{if(X.scope)return eM(X.scope,$),X;let[J=[]]=await R6(this._clientId,X.accessToken,M,X.scope,$),z={...X,scope:J};return this._checkIntermediateUserRemoval(M),this._userAccessTokens.set(M,z),z}catch(J){if(!(J instanceof a))throw J}this._checkIntermediateUserRemoval(M);let O=await this.refreshAccessTokenForUser(M);return eM(O.scope,$),O}async _refreshUserTokenWithCallback(M,$){try{return await l1(this.clientId,this._clientSecret,$)}catch(X){throw this._cachedRefreshFailures.add(M),this.emit(this.onRefreshFailure,M,X),X}}async _fetchAppToken(M){if(M.length>0)for(let $ of M)if(this._appImpliedScopes.length){if($.every((X)=>!this._appImpliedScopes.includes(X)))throw Error(`One of the scopes ${$.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw Error(`One of the scopes ${$.join(", ")} requested but the client credentials flow does not support scopes`);if(!this._appAccessToken||B0(this._appAccessToken))return await this._refreshAppToken();return this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await H2(this._clientId,this._clientSecret)}};W([G(!1)],Y0.prototype,"_clientSecret",void 0);W([G(!1)],Y0.prototype,"_userAccessTokens",void 0);W([G(!1)],Y0.prototype,"_userTokenFetchers",void 0);W([G(!1)],Y0.prototype,"_appAccessToken",void 0);W([G(!1)],Y0.prototype,"_appTokenFetcher",void 0);Y0=W([Q("auth","RefreshingAuthProvider","clientId")],Y0);import{promises as N6}from"fs";import B8 from"path";class r1{tokenDir="./data/tokens";async createAuthProvider(Y,M,$){await N6.mkdir(this.tokenDir,{recursive:!0});let X=new Y0({clientId:Y,clientSecret:M});return X.onRefresh(async(O,J)=>{await this.saveToken(O,J),console.log(`[TokenManager] Tokens refreshed for user ${O}`)}),await X.addUserForToken($,["chat"]),X}async saveToken(Y,M){let $=B8.join(this.tokenDir,`tokens.${Y}.json`);await N6.writeFile($,JSON.stringify(M,null,2),"utf-8")}static createInitialToken(Y,M){return{accessToken:Y,refreshToken:M,scope:["chat"],expiresIn:0,obtainmentTimestamp:Date.now()}}}var c0=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";var d0,E;(function(Y){Y[Y.CRITICAL=0]="CRITICAL",Y[Y.ERROR=1]="ERROR",Y[Y.WARNING=2]="WARNING",Y[Y.INFO=3]="INFO",Y[Y.DEBUG=4]="DEBUG",Y[Y.TRACE=7]="TRACE"})(E||(E={}));function r3(Y){if(typeof Y==="number"){if(Object.prototype.hasOwnProperty.call(E,Y))return Y;var M=Object.keys(E).map(function(X){return parseInt(X,10)}).filter(function(X){return!isNaN(X)&&X<Y});if(!M.length)return E.WARNING;return Math.max.apply(Math,M)}var $=Y.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(E,$))throw Error("Unknown log level string: ".concat(Y));return E[$]}var R8=c0?console.log.bind(console):console.debug.bind(console),t1=(d0={},d0[E.CRITICAL]=console.error.bind(console),d0[E.ERROR]=console.error.bind(console),d0[E.WARNING]=console.warn.bind(console),d0[E.INFO]=console.info.bind(console),d0[E.DEBUG]=R8.bind(console),d0[E.TRACE]=console.trace.bind(console),d0);var w2,S2,a1=typeof process>"u"?[]:(S2=(w2=process.env.LOGGING)===null||w2===void 0?void 0:w2.split(";").map(function(Y){var M=Y.split("=",2),$=M[0],X=M[1];if(X)return[$==="default"?void 0:$.split(":"),r3(X)];return null}).filter(function(Y){return!!Y}).sort(function(Y,M){var $,X,O=Y[0],J=M[0];return(($=J===null||J===void 0?void 0:J.length)!==null&&$!==void 0?$:0)-((X=O===null||O===void 0?void 0:O.length)!==null&&X!==void 0?X:0)}))!==null&&S2!==void 0?S2:[],y2=a1.findIndex(function(Y){var M=Y[0];return!M}),C6=void 0;if(y2!==-1)C6=a1[y2][1],a1.splice(y2);function N8(Y,M){return M.length<=Y.length&&M.every(function($,X){return $===Y[X]})}function e1(Y){var M=Y.split(":");for(var $=0,X=a1;$<X.length;$++){var O=X[$],J=O[0],z=O[1];if(N8(M,J))return z}return C6}var M4=function(){function Y(M){var{name:$,minLevel:X,emoji:O}=M,J=O===void 0?!1:O,z=M.colors,V=M.timestamps,F=V===void 0?c0:V,L,R;this._name=$,this._minLevel=(R=(L=i(X,function(U){return r3(U)}))!==null&&L!==void 0?L:e1($))!==null&&R!==void 0?R:E.WARNING,this._emoji=J,this._colors=z,this._timestamps=F}return Y.prototype.crit=function(M){this.log(E.CRITICAL,M)},Y.prototype.error=function(M){this.log(E.ERROR,M)},Y.prototype.warn=function(M){this.log(E.WARNING,M)},Y.prototype.info=function(M){this.log(E.INFO,M)},Y.prototype.debug=function(M){this.log(E.DEBUG,M)},Y.prototype.trace=function(M){this.log(E.TRACE,M)},Y}();var A6=function(Y){c1(M,Y);function M(){return Y!==null&&Y.apply(this,arguments)||this}return M.prototype.log=function($,X){if($>this._minLevel)return;var O=t1[$],J="[".concat(this._name,"] ").concat(X);if(this._timestamps)J="[".concat(new Date().toISOString(),"] ").concat(X);O(J)},M}(M4);var U6=function(){function Y(M){var{name:$,minLevel:X,custom:O}=M,J;this._minLevel=(J=i(X,function(z){return r3(z)}))!==null&&J!==void 0?J:e1($),this._override=typeof O==="function"?{log:O}:O}return Y.prototype.log=function(M,$){if(this._shouldLog(M))this._override.log(M,$)},Y.prototype.crit=function(M){if(!this._override.crit)this.log(E.CRITICAL,M);else if(this._shouldLog(E.CRITICAL))this._override.crit(M)},Y.prototype.error=function(M){if(!this._override.error)this.log(E.ERROR,M);else if(this._shouldLog(E.ERROR))this._override.error(M)},Y.prototype.warn=function(M){if(!this._override.warn)this.log(E.WARNING,M);else if(this._shouldLog(E.WARNING))this._override.warn(M)},Y.prototype.info=function(M){if(!this._override.info)this.log(E.INFO,M);else if(this._shouldLog(E.INFO))this._override.info(M)},Y.prototype.debug=function(M){if(!this._override.debug)this.log(E.DEBUG,M);else if(this._shouldLog(E.DEBUG))this._override.debug(M)},Y.prototype.trace=function(M){if(!this._override.trace)this.log(E.TRACE,M);else if(this._shouldLog(E.TRACE))this._override.trace(M)},Y.prototype._shouldLog=function(M){return this._minLevel===void 0||this._minLevel>=M},Y}();var i0,n0,l0,C8=(i0={},i0[E.CRITICAL]="\uD83D\uDED1",i0[E.ERROR]="\u274C",i0[E.WARNING]="\u26A0\uFE0F ",i0[E.INFO]="\u2139\uFE0F ",i0[E.DEBUG]="\uD83D\uDC1E",i0[E.TRACE]="\uD83D\uDC3E",i0),A8={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},U8={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function $4(Y,M,$){return function(X){return"\x1B[".concat(Y,"m").concat($?$(X):X,"\x1B[").concat(M,"m")}}function N0(Y){return $4(A8[Y],39)}function M1(Y,M){return $4(U8[Y],49,M)}var P8=(n0={},n0[E.CRITICAL]=N0("red"),n0[E.ERROR]=N0("redBright"),n0[E.WARNING]=N0("yellow"),n0[E.INFO]=N0("blue"),n0[E.DEBUG]=N0("magenta"),n0[E.TRACE]=$4(0,0),n0),P6=(l0={},l0[E.CRITICAL]=M1("bgRed",N0("white")),l0[E.ERROR]=M1("bgRedBright",N0("white")),l0[E.WARNING]=M1("bgYellow",N0("black")),l0[E.INFO]=M1("bgBlue",N0("white")),l0[E.DEBUG]=M1("bgMagenta",N0("black")),l0[E.TRACE]=$4(7,27),l0),f6=function(Y){c1(M,Y);function M(){return Y!==null&&Y.apply(this,arguments)||this}return M.prototype.log=function($,X){var O,J,z;if($>this._minLevel)return;var V=t1[$],F="";if(this._timestamps)F+="[".concat(new Date().toISOString(),"] ");if(this._emoji){var L=C8[$];F+="".concat(L," ")}var R=(z=(O=this._colors)!==null&&O!==void 0?O:(J=process.stdout)===null||J===void 0?void 0:J.isTTY)!==null&&z!==void 0?z:!0;if(R)F+="".concat(P6[$](this._name)," ").concat(P6[$](E[$])," ").concat(P8[$](X));else F+="[".concat(this._name,":").concat(E[$].toLowerCase(),"] ").concat(X);V(F)},M}(M4);function e(Y){if(Y.custom)return new U6(Y);if(c0)return new f6(Y);return new A6(Y)}class Q3 extends Error{constructor(...Y){var M;super(...Y);Object.setPrototypeOf(this,new.target.prototype),(M=Error.captureStackTrace)===null||M===void 0||M.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}class F3 extends Q3{}class G3 extends Q3{}class Y4 extends Q3{constructor(Y){super(`Need to retry after ${Y} ms`);this._retryAt=Date.now()+Y}get retryAt(){return this._retryAt}}class o0{constructor({logger:Y}){this._queue=[],this._batchRunning=!1,this._paused=!1,this._logger=e({name:"rate-limiter",emoji:!0,...Y})}async request(Y,M){return this._logger.trace("request start"),await new Promise(($,X)=>{var O;let J={req:Y,resolve:$,reject:X,limitReachedBehavior:(O=M===null||M===void 0?void 0:M.limitReachedBehavior)!==null&&O!==void 0?O:"enqueue"};if(this._batchRunning||!!this._nextBatchTimer||this._paused)this._logger.trace(`request queued batchRunning:${this._batchRunning.toString()} hasNextBatchTimer:${(!!this._nextBatchTimer).toString()} paused:${this._paused.toString()}`),this._queue.push(J);else this._runRequestBatch([J])})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextBatch()}get stats(){var Y,M,$,X,O;return{lastKnownLimit:(M=(Y=this._parameters)===null||Y===void 0?void 0:Y.limit)!==null&&M!==void 0?M:null,lastKnownRemainingRequests:(X=($=this._parameters)===null||$===void 0?void 0:$.remaining)!==null&&X!==void 0?X:null,lastKnownResetDate:p((O=this._parameters)===null||O===void 0?void 0:O.resetsAt,(J)=>new Date(J))}}async _runRequestBatch(Y){if(this._logger.trace(`runRequestBatch start specs:${Y.length}`),this._batchRunning=!0,this._parameters)this._logger.debug(`Remaining requests: ${this._parameters.remaining}`);this._logger.debug(`Doing ${Y.length} requests, new queue length is ${this._queue.length}`);let M=Y.map(async(J)=>{let{req:z,resolve:V,reject:F}=J;try{let L=await this.doRequest(z),R=this.needsToRetryAfter(L);if(R!==null)throw this._queue.unshift(J),this._logger.info(`Retrying after ${R} ms`),new Y4(R);let U=this.getParametersFromResponse(L);return V(L),U}catch(L){if(L instanceof Y4)throw L;F(L);return}}),$=await Promise.allSettled(M),X=$.filter((J)=>J.status==="rejected"),O=Date.now();if(X.length){this._logger.trace("runRequestBatch some rejected");let z=Math.max(O,...X.map((V)=>V.reason.retryAt))-O;this._logger.warn(`Waiting for ${z} ms because the rate limit was exceeded`),this._nextBatchTimer=setTimeout(()=>{this._parameters=void 0,this._runNextBatch()},z)}else{this._logger.trace("runRequestBatch none rejected");let J=$.filter((z)=>z.status==="fulfilled"&&z.value!==void 0).map((z)=>z.value).reduce((z,V)=>{if(!z)return V;return V.remaining<z.remaining?V:z},void 0);if(this._batchRunning=!1,J)if(this._parameters=J,J.resetsAt<O||J.remaining>0)this._logger.trace("runRequestBatch canRunMore"),this._runNextBatch();else{let z=J.resetsAt-O;this._logger.trace(`runRequestBatch delay:${z}`),this._logger.warn(`Waiting for ${z} ms because the rate limit was reached`),this._queue=this._queue.filter((V)=>{switch(V.limitReachedBehavior){case"enqueue":return!0;case"null":return V.resolve(null),!1;case"throw":return V.reject(new G3("Request removed from queue because the rate limit was reached")),!1;default:throw Error("this should never happen")}}),this._nextBatchTimer=setTimeout(()=>{this._parameters=void 0,this._runNextBatch()},z)}}this._logger.trace("runRequestBatch end")}_runNextBatch(){if(this._paused)return;if(this._logger.trace("runNextBatch start"),this._nextBatchTimer)clearTimeout(this._nextBatchTimer),this._nextBatchTimer=void 0;let Y=this._parameters?Math.min(this._parameters.remaining,this._parameters.limit/10):1,M=this._queue.splice(0,Y);if(M.length)this._runRequestBatch(M);this._logger.trace("runNextBatch end")}}class X4{constructor(Y){this._children=new Map,this._paused=!1,this._partitionKeyCallback=Y.getPartitionKey,this._createChildCallback=Y.createChild}async request(Y,M){let $=this._partitionKeyCallback(Y);return await this._getChild($).request(Y,M)}clear(){for(let Y of this._children.values())Y.clear()}pause(){this._paused=!0;for(let Y of this._children.values())Y.pause()}resume(){this._paused=!1;for(let Y of this._children.values())Y.resume()}getChildStats(Y){if(!this._children.has(Y))return null;let M=this._children.get(Y);if(!(M instanceof o0))return null;return M.stats}_getChild(Y){if(this._children.has(Y))return this._children.get(Y);let M=this._createChildCallback(Y);if(this._paused)M.pause();return this._children.set(Y,M),M}}class t3{constructor({logger:Y,bucketSize:M,timeFrame:$,doRequest:X,getPartitionKey:O}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=e({name:"rate-limiter",emoji:!0,...Y}),this._bucketSize=M,this._timeFrame=$,this._callback=X,this._partitionKeyCallback=O}async request(Y,M){return await new Promise(($,X)=>{var O,J;if(this._destroyed){X(new F3("Rate limiter was destroyed"));return}let z={req:Y,resolve:$,reject:X,limitReachedBehavior:(O=M===null||M===void 0?void 0:M.limitReachedBehavior)!==null&&O!==void 0?O:"enqueue"},V=this._partitionKeyCallback(Y),F=(J=this._usedFromBucket.get(V))!==null&&J!==void 0?J:0;if(F>=this._bucketSize||this._paused)switch(z.limitReachedBehavior){case"enqueue":{let L=this._getPartitionedQueue(V);if(L.push(z),F+L.length>=this._bucketSize)this._logger.warn(`Rate limit of ${this._bucketSize} for ${V?`partition ${V}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${L.length}`);else this._logger.info(`Enqueueing request for ${V?`partition ${V}`:"default partition"} because the rate limiter is paused; queue size is ${L.length}`);break}case"null":{if(z.resolve(null),this._paused)this._logger.info(`Returning null for request for ${V?`partition ${V}`:"default partition"} because the rate limiter is paused`);else this._logger.warn(`Rate limit of ${this._bucketSize} for ${V?`partition ${V}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{z.reject(new G3(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${V?`partition ${V}`:"default partition"} was reached`}`));break}default:throw Error("this should never happen")}else this._runRequest(z,V)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(let Y of this._partitionedQueue.keys())this._runNextRequest(Y)}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach((Y)=>{clearTimeout(Y)});for(let Y of this._partitionedQueue.values())for(let M of Y)M.reject(new F3("Rate limiter was destroyed"));this._partitionedQueue.clear()}_getPartitionedQueue(Y){if(this._partitionedQueue.has(Y))return this._partitionedQueue.get(Y);let M=[];return this._partitionedQueue.set(Y,M),M}async _runRequest(Y,M){var $;let X=this._getPartitionedQueue(M);this._logger.debug(`doing a request for ${M?`partition ${M}`:"default partition"}, new queue length is ${X.length}`),this._usedFromBucket.set(M,(($=this._usedFromBucket.get(M))!==null&&$!==void 0?$:0)+1);let{req:O,resolve:J,reject:z}=Y;try{J(await this._callback(O))}catch(V){z(V)}finally{let V=setTimeout(()=>{this._counterTimers.delete(V);let F=this._usedFromBucket.get(M)-1;if(this._usedFromBucket.set(M,F),X.length&&F<this._bucketSize)this._runNextRequest(M)},this._timeFrame);this._counterTimers.add(V)}}_runNextRequest(Y){if(this._paused)return;let $=this._getPartitionedQueue(Y).shift();if($)this._runRequest($,Y)}}class L3{constructor({logger:Y,bucketSize:M,timeFrame:$,doRequest:X}){this._queue=[],this._usedFromBucket=0,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=e({name:"rate-limiter",emoji:!0,...Y}),this._bucketSize=M,this._timeFrame=$,this._callback=X}async request(Y,M){return await new Promise(($,X)=>{var O;if(this._destroyed){X(new F3("Rate limiter was destroyed"));return}let J={req:Y,resolve:$,reject:X,limitReachedBehavior:(O=M===null||M===void 0?void 0:M.limitReachedBehavior)!==null&&O!==void 0?O:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(J.limitReachedBehavior){case"enqueue":{if(this._queue.push(J),this._usedFromBucket+this._queue.length>=this._bucketSize)this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`);else this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{if(J.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused)this._logger.info("Returning null for request because the rate limiter is paused");else this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{J.reject(new G3(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw Error("this should never happen")}else this._runRequest(J)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach((Y)=>{clearTimeout(Y)});for(let Y of this._queue)Y.reject(new F3("Rate limiter was destroyed"));this._queue=[]}async _runRequest(Y){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;let{req:M,resolve:$,reject:X}=Y;try{$(await this._callback(M))}catch(O){X(O)}finally{let O=setTimeout(()=>{if(this._counterTimers.delete(O),this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize)this._runNextRequest()},this._timeFrame);this._counterTimers.add(O)}}_runNextRequest(){if(this._paused)return;let Y=this._queue.shift();if(Y)this._runRequest(Y)}}class Z4 extends L3{constructor(Y,M){super({...M,async doRequest($,X){return await Y.request($,X)}})}}class g2 extends b{}class u2 extends o0{async doRequest({options:Y,clientId:M,accessToken:$,authorizationType:X,fetchOptions:O,mockServerPort:J}){return await h0(Y,M,$,X,O,J)}needsToRetryAfter(Y){if(Y.status===429&&(!Y.headers.has("ratelimit-remaining")||Number(Y.headers.get("ratelimit-remaining"))===0))return+Y.headers.get("ratelimit-reset")*1000-Date.now();return null}getParametersFromResponse(Y){let{headers:M}=Y;return{limit:+M.get("ratelimit-limit"),remaining:+M.get("ratelimit-remaining"),resetsAt:+M.get("ratelimit-reset")*1000}}}function f8(Y){switch(typeof Y){case"undefined":return"";case"object":{if(Y===null)return"";if("cacheKey"in Y)return Y.cacheKey;let M=JSON.stringify(Y);if(M!=="{}")return M}default:return Y.toString()}}function O4(Y,M,$){return[Y,...M.map(f8)].join("/")+($?"/":"")}var f0=Symbol("cache");function W0(Y){var M,$;return $=class extends Y{constructor(){super(...arguments);this[M]=new Map}getFromCache(X){if(this._cleanCache(),this[f0].has(X)){let O=this[f0].get(X);if(O)return O.value}return}setCache(X,O,J){this[f0].set(X,{value:O,expires:Date.now()+J*1000})}removeFromCache(X,O){let J=this._getInternalCacheKey(X,O);if(O)this[f0].forEach((z,V)=>{if(V.startsWith(J))this[f0].delete(V)});else this[f0].delete(J)}_cleanCache(){let X=Date.now();this[f0].forEach((O,J)=>{if(O.expires<X)this[f0].delete(J)})}_getInternalCacheKey(X,O){if(typeof X==="string"){let J=X;if(!J.endsWith("/"))J+="/";return J}else{let J=X.shift();return O4(J,X,O)}}},M=f0,$}function g(Y=1/0){return function(M,$,X){if(X.get){let O=X.get;X.get=function(){let J=O4($,[]),z=this.getFromCache(J);if(z)return z;let V=O.call(this);return this.setCache(J,V,Y),V}}return X}}var Q9=b3(k6(),1);function D6(Y={}){let{count:M=10,period:$="all",startDate:X,contextUserId:O}=Y;return{count:M.toString(),period:$,started_at:X===null||X===void 0?void 0:X.toISOString(),user_id:O}}class v{constructor(Y){this._client=Y}_getUserContextIdWithDefault(Y){var M;return(M=this._client._getUserIdFromRequestContext(Y))!==null&&M!==void 0?M:Y}}W([G(!1)],v.prototype,"_client",void 0);var $1=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}get rank(){return this[Z].rank}get amount(){return this[Z].score}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};W([G(!1)],$1.prototype,"_client",void 0);$1=W([Q("api","HelixBitsLeaderboardEntry","userId")],$1);var a3=class extends P{constructor(M,$){super(M);this._client=$}get entries(){return this[Z].data.map((M)=>new $1(M,this._client))}get totalCount(){return this[Z].total}};W([G(!1)],a3.prototype,"_client",void 0);W([g()],a3.prototype,"entries",null);a3=W([W0,Q("api","HelixBitsLeaderboard")],a3);var J4=class extends P{constructor(M){super(lM(M,($)=>$.prefix.toLowerCase()))}getCheermoteDisplayInfo(M,$,X){M=M.toLowerCase();let{background:O,state:J,scale:z}=X,{tiers:V}=this[Z][M],F=V.sort((L,R)=>R.min_bits-L.min_bits).find((L)=>L.min_bits<=$);if(!F)throw new m(`Cheermote "${M}" does not have an applicable tier for ${$} bits`);return{url:F.images[O][J][z],color:F.color}}getPossibleNames(){return Object.keys(this[Z])}};J4=W([Q("api","HelixCheermoteList")],J4);var W4=class extends v{async getLeaderboard(M,$={}){let X=await this._client.callApi({type:"helix",url:"bits/leaderboard",userId:K(M),scopes:["bits:read"],query:D6($)});return new a3(X,this._client)}async getCheermotes(M){let $=await this._client.callApi({type:"helix",url:"bits/cheermotes",userId:i(M,K),query:i(M,H)});return new J4($.data)}};W4=W([Q("api","HelixBitsApi")],W4);function v6(Y){var M;return{game_id:Y.gameId,broadcaster_language:Y.language,title:Y.title,delay:(M=Y.delay)===null||M===void 0?void 0:M.toString(),tags:Y.tags,content_classification_labels:Y.contentClassificationLabels,is_branded_content:Y.isBrandedContent}}function H6(Y,M){return{broadcaster_id:K(Y),length:M}}function h2(Y,M){return{broadcaster_id:K(Y),user_id:K(M)}}function z4(Y,M){return{broadcaster_id:K(Y),user_id:i(M,K)}}function p2(Y,M){return{broadcaster_id:i(M,K),user_id:K(Y)}}function S(Y,M){return{[Y]:M}}function b2(Y){return{user_id:K(Y)}}function V4(Y,M){return{broadcaster_id:Y,moderator_id:M}}function s0(Y,M){return{broadcaster_id:K(Y),id:M}}function K4(Y,M){return{broadcaster_id:K(Y),user_id:M.map(K)}}var j0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].user_id}get name(){return this[Z].user_login}get displayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};W([G(!1)],j0.prototype,"_client",void 0);j0=W([Q("api","HelixUserRelation","id")],j0);class c{constructor(Y,M,$,X,O,J=100){this._callOptions=Y,this._queryParamName=M,this._matchKey=$,this._mapper=O,this._limitPerRequest=J,this._requestedIds=[],this._requestResolversById=new Map,this._waitTimer=null,this._client=X,this._delay=X._batchDelay}async request(Y){let{promise:M,resolve:$,reject:X}=q0();if(!this._requestedIds.includes(Y))this._requestedIds.push(Y);if(this._requestResolversById.has(Y))this._requestResolversById.get(Y).push({resolve:$,reject:X});else this._requestResolversById.set(Y,[{resolve:$,reject:X}]);if(this._waitTimer)clearTimeout(this._waitTimer),this._waitTimer=null;if(this._requestedIds.length>=this._limitPerRequest)this._handleBatch(this._requestedIds.splice(0,this._limitPerRequest));else this._waitTimer=setTimeout(()=>{this._handleBatch(this._requestedIds.splice(0,this._limitPerRequest))},this._delay);return await M}async _handleBatch(Y){var M;try{let{data:$}=await this._doRequest(Y),X=lM($,this._matchKey);for(let O of Y){for(let J of(M=this._requestResolversById.get(O))!==null&&M!==void 0?M:[])if(Object.prototype.hasOwnProperty.call(X,O))J.resolve(this._mapper(X[O]));else J.resolve(null);this._requestResolversById.delete(O)}}catch($){await Promise.all(Y.map(async(X)=>{var O,J;try{let z=await this._doRequest([X]);for(let V of(O=this._requestResolversById.get(X))!==null&&O!==void 0?O:[])V.resolve(z.data.length?this._mapper(z.data[0]):null)}catch(z){for(let V of(J=this._requestResolversById.get(X))!==null&&J!==void 0?J:[])V.reject(z)}this._requestResolversById.delete(X)}))}}async _doRequest(Y){return await this._client.callApi({type:"helix",...this._callOptions,query:{...this._callOptions.query,[this._queryParamName]:Y}})}}W([G(!1)],c.prototype,"_client",void 0);var m2;if(!Object.prototype.hasOwnProperty.call(Symbol,"asyncIterator"))Symbol.asyncIterator=(m2=Symbol.asyncIterator)!==null&&m2!==void 0?m2:Symbol.for("Symbol.asyncIterator");var I=class{constructor(M,$,X,O=100){this._callOptions=M,this._mapper=X,this._limitPerPage=O,this._isFinished=!1,this._client=$}get current(){var M;return(M=this._currentData)===null||M===void 0?void 0:M.data}async getNext(){var M;if(this._isFinished)return[];let $=await this._fetchData();if(!((M=$.data)===null||M===void 0?void 0:M.length))return this._isFinished=!0,[];return this._processResult($)}async getAll(){this.reset();let M=[];do{let $=await this.getNext();if(!$.length)break;M.push(...$)}while(this._currentCursor);return this.reset(),M}get currentCursor(){return this._currentCursor}reset(){this._currentCursor=void 0,this._isFinished=!1,this._currentData=void 0}async*[Symbol.asyncIterator](){this.reset();while(!0){let M=await this.getNext();if(!M.length)break;yield*M[Symbol.iterator]()}}async _fetchData(M={}){return await this._client.callApi({type:"helix",...this._callOptions,...M,query:{...this._callOptions.query,after:this._currentCursor,first:this._limitPerPage.toString(),...M.query}})}_processResult(M){var $;if(this._currentCursor=typeof M.pagination==="string"?M.pagination:($=M.pagination)===null||$===void 0?void 0:$.cursor,this._currentCursor===void 0)this._isFinished=!0;return this._currentData=M,M.data.reduce((X,O)=>{let J=this._mapper(O);return Array.isArray(J)?[...X,...J]:[...X,J]},[])}};W([G(!1)],I.prototype,"_client",void 0);I=W([Q("api","HelixPaginatedRequest")],I);var z0=class extends I{async getTotalCount(){var M;return((M=this._currentData)!==null&&M!==void 0?M:await this._fetchData({query:{after:void 0}})).total}};z0=W([Q("api","HelixPaginatedRequestWithTotal")],z0);function _(Y,M,$){var X;let O=void 0;return{get data(){var J,z;return O!==null&&O!==void 0?O:O=(z=(J=Y.data)===null||J===void 0?void 0:J.map((V)=>new M(V,$)))!==null&&z!==void 0?z:[]},cursor:typeof Y.pagination==="string"?Y.pagination:(X=Y.pagination)===null||X===void 0?void 0:X.cursor}}function Z0(Y,M,$){let X=void 0;return{get data(){var O,J;return X!==null&&X!==void 0?X:X=(J=(O=Y.data)===null||O===void 0?void 0:O.map((z)=>new M(z,$)))!==null&&J!==void 0?J:[]},cursor:Y.pagination.cursor,total:Y.total}}function k({after:Y,before:M,limit:$}={}){return{after:Y,before:M,first:$===null||$===void 0?void 0:$.toString()}}var q3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].broadcaster_id}get name(){return this[Z].broadcaster_login}get displayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get language(){return this[Z].broadcaster_language}get gameId(){return this[Z].game_id}get gameName(){return this[Z].game_name}async getGame(){return this[Z].game_id?N(await this._client.games.getGameById(this[Z].game_id)):null}get title(){return this[Z].title}get delay(){return this[Z].delay}get tags(){return this[Z].tags}get contentClassificationLabels(){return this[Z].content_classification_labels}get isBrandedContent(){return this[Z].is_branded_content}};W([G(!1)],q3.prototype,"_client",void 0);q3=W([Q("api","HelixChannel","id")],q3);var Y1=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get creationDate(){return new Date(this[Z].created_at)}};W([G(!1)],Y1.prototype,"_client",void 0);Y1=W([Q("api","HelixChannelEditor","userId")],Y1);var e3=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get followDate(){return new Date(this[Z].followed_at)}};W([G(!1)],e3.prototype,"_client",void 0);e3=W([Q("api","HelixChannelFollower","userId")],e3);var MM=class extends P{constructor(M,$){super(M);this._client=$}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get followDate(){return new Date(this[Z].followed_at)}};W([G(!1)],MM.prototype,"_client",void 0);MM=W([Q("api","HelixFollowedChannel","broadcasterId")],MM);var Q4=class extends P{get snoozeCount(){return this[Z].snooze_count}get snoozeRefreshDate(){return this[Z].snooze_refresh_at?new Date(this[Z].snooze_refresh_at*1000):null}get nextAdDate(){return this[Z].next_ad_at?new Date(this[Z].next_ad_at*1000):null}get duration(){return this[Z].duration}get lastAdDate(){return this[Z].last_ad_at?new Date(this[Z].last_ad_at*1000):null}get prerollFreeTime(){return this[Z].preroll_free_time}};Q4=W([Q("api","HelixAdSchedule")],Q4);var F4=class extends P{get snoozeCount(){return this[Z].snooze_count}get snoozeRefreshDate(){return new Date(this[Z].snooze_refresh_at*1000)}get nextAdDate(){return new Date(this[Z].next_ad_at*1000)}};F4=W([Q("api","HelixSnoozeNextAdResult")],F4);var X1=class extends v{constructor(){super(...arguments);this._getChannelByIdBatcher=new c({url:"channels"},"broadcaster_id","broadcaster_id",this._client,(M)=>new q3(M,this._client))}async getChannelInfoById(M){let $=K(M),X=await this._client.callApi({type:"helix",url:"channels",userId:$,query:H($)});return p(X.data[0],(O)=>new q3(O,this._client))}async getChannelInfoByIdBatched(M){return await this._getChannelByIdBatcher.request(K(M))}async getChannelInfoByIds(M){let $=M.map(K);return(await this._client.callApi({type:"helix",url:"channels",query:S("broadcaster_id",$)})).data.map((O)=>new q3(O,this._client))}async updateChannelInfo(M,$){await this._client.callApi({type:"helix",url:"channels",method:"PATCH",userId:K(M),scopes:["channel:manage:broadcast"],query:H(M),jsonBody:v6($)})}async startChannelCommercial(M,$){await this._client.callApi({type:"helix",url:"channels/commercial",method:"POST",userId:K(M),scopes:["channel:edit:commercial"],jsonBody:H6(M,$)})}async getChannelEditors(M){return(await this._client.callApi({type:"helix",url:"channels/editors",userId:K(M),scopes:["channel:read:editors"],query:H(M)})).data.map((X)=>new Y1(X,this._client))}async getVips(M,$){let X=await this._client.callApi({type:"helix",url:"channels/vips",userId:K(M),scopes:["channel:read:vips","channel:manage:vips"],query:{...H(M),...k($)}});return _(X,j0,this._client)}getVipsPaginated(M){return new I({url:"channels/vips",userId:K(M),scopes:["channel:read:vips","channel:manage:vips"],query:H(M)},this._client,($)=>new j0($,this._client))}async checkVipForUsers(M,$){return(await this._client.callApi({type:"helix",url:"channels/vips",userId:K(M),scopes:["channel:read:vips","channel:manage:vips"],query:K4(M,$)})).data.map((O)=>new j0(O,this._client))}async checkVipForUser(M,$){let X=K($);return(await this.checkVipForUsers(M,[X])).some((J)=>J.id===X)}async addVip(M,$){await this._client.callApi({type:"helix",url:"channels/vips",method:"POST",userId:K(M),scopes:["channel:manage:vips"],query:h2(M,$)})}async removeVip(M,$){await this._client.callApi({type:"helix",url:"channels/vips",method:"DELETE",userId:K(M),scopes:["channel:manage:vips"],query:h2(M,$)})}async getChannelFollowerCount(M){return(await this._client.callApi({type:"helix",url:"channels/followers",method:"GET",userId:K(M),query:{...z4(M),...k({limit:1})}})).total}async getChannelFollowers(M,$,X){let O=await this._client.callApi({type:"helix",url:"channels/followers",method:"GET",userId:K(M),canOverrideScopedUserContext:!0,scopes:["moderator:read:followers"],query:{...z4(M,$),...k(X)}});return Z0(O,e3,this._client)}getChannelFollowersPaginated(M){return new z0({url:"channels/followers",method:"GET",userId:K(M),canOverrideScopedUserContext:!0,scopes:["moderator:read:followers"],query:z4(M)},this._client,($)=>new e3($,this._client))}async getFollowedChannels(M,$,X){let O=await this._client.callApi({type:"helix",url:"channels/followed",method:"GET",userId:K(M),scopes:["user:read:follows"],query:{...p2(M,$),...k(X)}});return Z0(O,MM,this._client)}getFollowedChannelsPaginated(M,$){return new z0({url:"channels/followed",method:"GET",userId:K(M),scopes:["user:read:follows"],query:p2(M,$)},this._client,(X)=>new MM(X,this._client))}async getAdSchedule(M){let $=await this._client.callApi({type:"helix",url:"channels/ads",method:"GET",userId:K(M),scopes:["channel:read:ads"],query:H(M)});return new Q4($.data[0])}async snoozeNextAd(M){let $=await this._client.callApi({type:"helix",url:"channels/ads/schedule/snooze",method:"POST",userId:K(M),scopes:["channel:manage:ads"],query:H(M)});return new F4($.data[0])}};W([G(!1)],X1.prototype,"_getChannelByIdBatcher",void 0);X1=W([Q("api","HelixChannelApi")],X1);function I6(Y,M){return{broadcaster_id:K(Y),only_manageable_rewards:M===null||M===void 0?void 0:M.toString()}}function c2(Y,M){return{broadcaster_id:K(Y),id:M}}function d2(Y){var M,$,X;let O={title:Y.title,cost:Y.cost,prompt:Y.prompt,background_color:Y.backgroundColor,is_enabled:Y.isEnabled,is_user_input_required:Y.userInputRequired,should_redemptions_skip_request_queue:Y.autoFulfill};if(Y.maxRedemptionsPerStream!==void 0)O.is_max_per_stream_enabled=!!Y.maxRedemptionsPerStream,O.max_per_stream=(M=Y.maxRedemptionsPerStream)!==null&&M!==void 0?M:0;if(Y.maxRedemptionsPerUserPerStream!==void 0)O.is_max_per_user_per_stream_enabled=!!Y.maxRedemptionsPerUserPerStream,O.max_per_user_per_stream=($=Y.maxRedemptionsPerUserPerStream)!==null&&$!==void 0?$:0;if(Y.globalCooldown!==void 0)O.is_global_cooldown_enabled=!!Y.globalCooldown,O.global_cooldown_seconds=(X=Y.globalCooldown)!==null&&X!==void 0?X:0;if("isPaused"in Y)O.is_paused=Y.isPaused;return O}function i2(Y,M,$){return{broadcaster_id:K(Y),reward_id:M,id:$}}function n2(Y,M,$,X){return{broadcaster_id:K(Y),reward_id:M,status:$,sort:X.newestFirst?"NEWEST":"OLDEST"}}var r0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}getImageUrl(M){var $,X;let O=`url_${M}x`;return(X=($=this[Z].image)===null||$===void 0?void 0:$[O])!==null&&X!==void 0?X:this[Z].default_image[O]}get backgroundColor(){return this[Z].background_color}get isEnabled(){return this[Z].is_enabled}get cost(){return this[Z].cost}get title(){return this[Z].title}get prompt(){return this[Z].prompt}get userInputRequired(){return this[Z].is_user_input_required}get maxRedemptionsPerStream(){return this[Z].max_per_stream_setting.is_enabled?this[Z].max_per_stream_setting.max_per_stream:null}get maxRedemptionsPerUserPerStream(){return this[Z].max_per_user_per_stream_setting.is_enabled?this[Z].max_per_user_per_stream_setting.max_per_user_per_stream:null}get globalCooldown(){return this[Z].global_cooldown_setting.is_enabled?this[Z].global_cooldown_setting.global_cooldown_seconds:null}get isPaused(){return this[Z].is_paused}get isInStock(){return this[Z].is_in_stock}get redemptionsThisStream(){return this[Z].redemptions_redeemed_current_stream}get autoFulfill(){return this[Z].should_redemptions_skip_request_queue}get cooldownExpiryDate(){return this[Z].cooldown_expires_at?new Date(this[Z].cooldown_expires_at):null}};W([G(!1)],r0.prototype,"_client",void 0);r0=W([Q("api","HelixCustomReward","id")],r0);var t0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get userInput(){return this[Z].user_input}get isFulfilled(){return this[Z].status==="FULFILLED"}get isCanceled(){return this[Z].status==="CANCELED"}get redemptionDate(){return new Date(this[Z].redeemed_at)}get rewardId(){return this[Z].reward.id}get rewardTitle(){return this[Z].reward.title}get rewardPrompt(){return this[Z].reward.prompt}get rewardCost(){return this[Z].reward.cost}async getReward(){return N(await this._client.channelPoints.getCustomRewardById(this[Z].broadcaster_id,this[Z].reward.id))}async updateStatus(M){return(await this._client.channelPoints.updateRedemptionStatusByIds(this[Z].broadcaster_id,this[Z].reward.id,[this[Z].id],M))[0]}};W([G(!1)],t0.prototype,"_client",void 0);t0=W([Q("api","HelixCustomRewardRedemption","id")],t0);var G4=class extends v{async getCustomRewards(M,$){return(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",userId:K(M),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:I6(M,$)})).data.map((O)=>new r0(O,this._client))}async getCustomRewardsByIds(M,$){if(!$.length)return[];return(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",userId:K(M),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:s0(M,$)})).data.map((O)=>new r0(O,this._client))}async getCustomRewardById(M,$){let X=await this.getCustomRewardsByIds(M,[$]);return X.length?X[0]:null}async createCustomReward(M,$){let X=await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",method:"POST",userId:K(M),scopes:["channel:manage:redemptions"],query:H(M),jsonBody:d2($)});return new r0(X.data[0],this._client)}async updateCustomReward(M,$,X){let O=await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",method:"PATCH",userId:K(M),scopes:["channel:manage:redemptions"],query:c2(M,$),jsonBody:d2(X)});return new r0(O.data[0],this._client)}async deleteCustomReward(M,$){await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",method:"DELETE",userId:K(M),scopes:["channel:manage:redemptions"],query:c2(M,$)})}async getRedemptionsByIds(M,$,X){if(!X.length)return[];return(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards/redemptions",userId:K(M),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:i2(M,$,X)})).data.map((J)=>new t0(J,this._client))}async getRedemptionById(M,$,X){let O=await this.getRedemptionsByIds(M,$,[X]);return O.length?O[0]:null}async getRedemptionsForBroadcaster(M,$,X,O){let J=await this._client.callApi({type:"helix",url:"channel_points/custom_rewards/redemptions",userId:K(M),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:{...n2(M,$,X,O),...k(O)}});return _(J,t0,this._client)}getRedemptionsForBroadcasterPaginated(M,$,X,O){return new I({url:"channel_points/custom_rewards/redemptions",userId:K(M),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:n2(M,$,X,O)},this._client,(J)=>new t0(J,this._client),50)}async updateRedemptionStatusByIds(M,$,X,O){if(!X.length)return[];return(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards/redemptions",method:"PATCH",userId:K(M),scopes:["channel:manage:redemptions"],query:i2(M,$,X),jsonBody:{status:O}})).data.map((z)=>new t0(z,this._client))}};G4=W([Q("api","HelixChannelPointsApi")],G4);var B3=class extends P{get value(){return this[Z].value}get decimalPlaces(){return this[Z].decimal_places}get localizedValue(){return this.value/10**this.decimalPlaces}get currency(){return this[Z].currency}};B3=W([Q("api","HelixCharityCampaignAmount")],B3);var Z1=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get charityName(){return this[Z].charity_name}get charityDescription(){return this[Z].charity_description}get charityLogo(){return this[Z].charity_logo}get charityWebsite(){return this[Z].charity_website}get currentAmount(){return new B3(this[Z].current_amount)}get targetAmount(){return new B3(this[Z].target_amount)}};W([G(!1)],Z1.prototype,"_client",void 0);Z1=W([Q("api","HelixCharityCampaign","id")],Z1);var O1=class extends P{constructor(M,$){super(M);this._client=$}get campaignId(){return this[Z].campaign_id}get donorId(){return this[Z].user_id}get donorName(){return this[Z].user_login}get donorDisplayName(){return this[Z].user_name}async getDonor(){return N(await this._client.users.getUserById(this[Z].user_id))}get amount(){return new B3(this[Z].amount)}};W([G(!1)],O1.prototype,"_client",void 0);O1=W([Q("api","HelixCharityCampaignDonation")],O1);var L4=class extends v{async getCharityCampaign(M){let $=await this._client.callApi({type:"helix",url:"charity/campaigns",method:"GET",userId:K(M),scopes:["channel:read:charity"],query:H(M)});return new Z1($.data[0],this._client)}async getCharityCampaignDonations(M,$){let X=await this._client.callApi({type:"helix",url:"charity/donations",userId:K(M),scopes:["channel:read:charity"],query:{...H(M),...k($)}});return _(X,O1,this._client)}};L4=W([Q("api","HelixCharityApi")],L4);function x6(Y){return{slow_mode:Y.slowModeEnabled,slow_mode_wait_time:Y.slowModeDelay,follower_mode:Y.followerOnlyModeEnabled,follower_mode_duration:Y.followerOnlyModeDelay,subscriber_mode:Y.subscriberOnlyModeEnabled,emote_mode:Y.emoteOnlyModeEnabled,unique_chat_mode:Y.uniqueChatModeEnabled,non_moderator_chat_delay:Y.nonModeratorChatDelayEnabled,non_moderator_chat_delay_duration:Y.nonModeratorChatDelay}}function _6(Y,M){return{user_id:K(Y),color:M}}function w6(Y,M,$){return{from_broadcaster_id:K(Y),to_broadcaster_id:K(M),moderator_id:$}}function l2(Y,M){return{broadcaster_id:Y,sender_id:M}}function S6(Y,M){return{message:Y,reply_parent_message_id:M===null||M===void 0?void 0:M.replyParentMessageId}}function y6(Y,M){return{message:Y,reply_parent_message_id:M===null||M===void 0?void 0:M.replyParentMessageId,for_source_only:M===null||M===void 0?void 0:M.forSourceOnly}}class J1 extends P{get id(){return this[Z].id}get name(){return this[Z].name}get formats(){return this[Z].format}get scales(){return this[Z].scale}get themeModes(){return this[Z].theme_mode}getStaticImageUrl(Y="1.0",M="light"){if(this[Z].format.includes("static")&&this[Z].scale.includes(Y))return this.getFormattedImageUrl(Y,"static",M);return null}getAnimatedImageUrl(Y="1.0",M="light"){if(this[Z].format.includes("animated")&&this[Z].scale.includes(Y))return this.getFormattedImageUrl(Y,"animated",M);return null}getFormattedImageUrl(Y="1.0",M="static",$="light"){return`https://static-cdn.jtvnw.net/emoticons/v2/${this[Z].id}/${M}/${$}/${Y}`}}var a0=class extends J1{getImageUrl(M){return this[Z].images[`url_${M}x`]}};a0=W([Q("api","HelixEmote","id")],a0);var W1=class extends a0{constructor(M,$){super(M);this._client=$}get tier(){return this[Z].tier||null}get type(){return this[Z].emote_type}get emoteSetId(){return this[Z].emote_set_id}async getAllEmotesFromSet(){return await this._client.chat.getEmotesFromSets([this[Z].emote_set_id])}};W([G(!1)],W1.prototype,"_client",void 0);W1=W([Q("api","HelixChannelEmote","id")],W1);var q4=class extends P{get id(){return this[Z].id}getImageUrl(M){return this[Z][`image_url_${M}x`]}get title(){return this[Z].title}get description(){return this[Z].description}get clickAction(){return this[Z].click_action}get clickUrl(){return this[Z].click_url}};q4=W([Q("api","HelixChatBadgeVersion","id")],q4);var $M=class extends P{get id(){return this[Z].set_id}get versions(){return this[Z].versions.map((M)=>new q4(M))}getVersion(M){var $;return($=this.versions.find((X)=>X.id===M))!==null&&$!==void 0?$:null}};W([g()],$M.prototype,"versions",null);$M=W([W0,Q("api","HelixChatBadgeSet","id")],$M);var YM=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};W([G(!1)],YM.prototype,"_client",void 0);YM=W([Q("api","HelixChatChatter")],YM);var XM=class extends P{get broadcasterId(){return this[Z].broadcaster_id}get slowModeEnabled(){return this[Z].slow_mode}get slowModeDelay(){return this[Z].slow_mode_wait_time}get followerOnlyModeEnabled(){return this[Z].follower_mode}get followerOnlyModeDelay(){return this[Z].follower_mode_duration}get subscriberOnlyModeEnabled(){return this[Z].subscriber_mode}get emoteOnlyModeEnabled(){return this[Z].emote_mode}get uniqueChatModeEnabled(){return this[Z].unique_chat_mode}};XM=W([Q("api","HelixChatSettings","broadcasterId")],XM);var z1=class extends a0{constructor(M,$){super(M);this._client=$}get type(){return this[Z].emote_type}get emoteSetId(){return this[Z].emote_set_id}get ownerId(){switch(this[Z].owner_id){case"0":case"twitch":return null;default:return this[Z].owner_id}}async getOwner(){switch(this[Z].owner_id){case"0":case"twitch":return null;default:return await this._client.users.getUserById(this[Z].owner_id)}}};W([G(!1)],z1.prototype,"_client",void 0);z1=W([Q("api","HelixEmoteFromSet","id")],z1);var ZM=class extends J1{constructor(M,$){super(M);this._client=$}get type(){return this[Z].emote_type}get emoteSetId(){return this[Z].emote_set_id||null}get ownerId(){return this[Z].owner_id||null}async getAllEmotesFromSet(){return this[Z].emote_set_id?await this._client.chat.getEmotesFromSets([this[Z].emote_set_id]):null}async getOwner(){return this[Z].owner_id?await this._client.users.getUserById(this[Z].owner_id):null}};W([G(!1)],ZM.prototype,"_client",void 0);ZM=W([Q("api","HelixUserEmote","id")],ZM);var V1=class extends XM{get nonModeratorChatDelayEnabled(){return this[Z].non_moderator_chat_delay}get nonModeratorChatDelay(){return this[Z].non_moderator_chat_delay_duration}};V1=W([Q("api","HelixPrivilegedChatSettings","broadcasterId")],V1);var K1=class extends P{get id(){return this[Z].message_id}get isSent(){return this[Z].is_sent}get dropReasonCode(){var M;return(M=this[Z].drop_reason)===null||M===void 0?void 0:M.code}get dropReasonMessage(){var M;return(M=this[Z].drop_reason)===null||M===void 0?void 0:M.message}};K1=W([Q("api","HelixSentChatMessage","id")],K1);function g6(Y){return{broadcaster_id:K(Y)}}var Q1=class extends P{constructor(M,$){super(M);this._client=$}get broadcasterId(){return this[Z].broadcaster_id}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}};W([G(!1)],Q1.prototype,"_client",void 0);Q1=W([Q("api","HelixSharedChatSessionParticipant","broadcasterId")],Q1);var F1=class extends P{constructor(M,$){super(M);this._client=$}get sessionId(){return this[Z].session_id}get hostBroadcasterId(){return this[Z].host_broadcaster_id}async getHostBroadcaster(){return N(await this._client.users.getUserById(this[Z].host_broadcaster_id))}get participants(){return this[Z].participants.map((M)=>new Q1(M,this._client))}get createdDate(){return new Date(this[Z].created_at)}get updatedDate(){return new Date(this[Z].updated_at)}};W([G(!1)],F1.prototype,"_client",void 0);F1=W([Q("api","HelixSharedChatSession","sessionId")],F1);var B4=class extends v{async getChatters(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"chat/chatters",userId:X,canOverrideScopedUserContext:!0,scopes:["moderator:read:chatters"],query:{...this._createModeratorActionQuery(X),...k($)}});return Z0(O,YM,this._client)}getChattersPaginated(M){let $=K(M);return new z0({url:"chat/chatters",userId:$,canOverrideScopedUserContext:!0,scopes:["moderator:read:chatters"],query:this._createModeratorActionQuery($)},this._client,(X)=>new YM(X,this._client),1000)}async getGlobalBadges(){return(await this._client.callApi({type:"helix",url:"chat/badges/global"})).data.map(($)=>new $M($))}async getChannelBadges(M){return(await this._client.callApi({type:"helix",url:"chat/badges",userId:K(M),query:H(M)})).data.map((X)=>new $M(X))}async getGlobalEmotes(){return(await this._client.callApi({type:"helix",url:"chat/emotes/global"})).data.map(($)=>new a0($))}async getChannelEmotes(M){return(await this._client.callApi({type:"helix",url:"chat/emotes",userId:K(M),query:H(M)})).data.map((X)=>new W1(X,this._client))}async getEmotesFromSets(M){return(await this._client.callApi({type:"helix",url:"chat/emotes/set",query:S("emote_set_id",M)})).data.map((X)=>new z1(X,this._client))}async getUserEmotes(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"chat/emotes/user",userId:K(M),scopes:["user:read:emotes"],query:{...S("user_id",X),...S("broadcasterId",($===null||$===void 0?void 0:$.broadcaster)?K($.broadcaster):void 0),...k($)}});return _(O,ZM,this._client)}getUserEmotesPaginated(M,$){let X=K(M);return new I({url:"chat/emotes/user",userId:X,scopes:["user:read:emotes"],query:{...S("user_id",X),...S("broadcasterId",$?K($):void 0)}},this._client,(O)=>new ZM(O,this._client))}async getSettings(M){let $=await this._client.callApi({type:"helix",url:"chat/settings",userId:K(M),query:H(M)});return new XM($.data[0])}async getSettingsPrivileged(M){let $=K(M),X=await this._client.callApi({type:"helix",url:"chat/settings",userId:$,canOverrideScopedUserContext:!0,scopes:["moderator:read:chat_settings"],query:this._createModeratorActionQuery($)});return new V1(X.data[0])}async updateSettings(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"chat/settings",method:"PATCH",userId:X,canOverrideScopedUserContext:!0,scopes:["moderator:manage:chat_settings"],query:this._createModeratorActionQuery(X),jsonBody:x6($)});return new V1(O.data[0])}async sendChatMessage(M,$,X){let O=K(M),J=await this._client.callApi({type:"helix",url:"chat/messages",method:"POST",userId:O,canOverrideScopedUserContext:!0,scopes:["user:write:chat"],query:l2(O,this._getUserContextIdWithDefault(O)),jsonBody:S6($,X)});return new K1(J.data[0])}async sendChatMessageAsApp(M,$,X,O){let J=K(M),z=K($),V=await this._client.callApi({type:"helix",url:"chat/messages",method:"POST",forceType:"app",query:l2(z,J),jsonBody:y6(X,O)});return new K1(V.data[0])}async sendAnnouncement(M,$){let X=K(M);await this._client.callApi({type:"helix",url:"chat/announcements",method:"POST",userId:X,canOverrideScopedUserContext:!0,scopes:["moderator:manage:announcements"],query:this._createModeratorActionQuery(X),jsonBody:{message:$.message,color:$.color}})}async getColorsForUsers(M){let $=await this._client.callApi({type:"helix",url:"chat/color",query:S("user_id",M.map(K))});return new Map($.data.map((X)=>[X.user_id,X.color||null]))}async getColorForUser(M){let $=await this._client.callApi({type:"helix",url:"chat/color",userId:K(M),query:S("user_id",K(M))});if(!$.data.length)return;return $.data[0].color||null}async setColorForUser(M,$){await this._client.callApi({type:"helix",url:"chat/color",method:"PUT",userId:K(M),scopes:["user:manage:chat_color"],query:_6(M,$)})}async shoutoutUser(M,$){let X=K(M);await this._client.callApi({type:"helix",url:"chat/shoutouts",method:"POST",userId:X,canOverrideScopedUserContext:!0,scopes:["moderator:manage:shoutouts"],query:w6(M,$,this._getUserContextIdWithDefault(X))})}async getSharedChatSession(M){let $=K(M),X=await this._client.callApi({type:"helix",url:"shared_chat/session",userId:$,query:g6($)});if(X.data.length===0)return null;return new F1(X.data[0],this._client)}_createModeratorActionQuery(M){return V4(M,this._getUserContextIdWithDefault(M))}};B4=W([Q("api","HelixChatApi")],B4);function u6(Y,M){return{broadcaster_id:K(Y),has_delay:M.toString()}}function o2(Y){let{filterType:M,ids:$,startDate:X,endDate:O,isFeatured:J}=Y;return{[M]:$,started_at:X,ended_at:O,is_featured:J===null||J===void 0?void 0:J.toString()}}var R3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get url(){return this[Z].url}get embedUrl(){return this[Z].embed_url}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get creatorId(){return this[Z].creator_id}get creatorDisplayName(){return this[Z].creator_name}async getCreator(){return N(await this._client.users.getUserById(this[Z].creator_id))}get videoId(){return this[Z].video_id}async getVideo(){return N(await this._client.videos.getVideoById(this[Z].video_id))}get gameId(){return this[Z].game_id}async getGame(){return this[Z].game_id?N(await this._client.games.getGameById(this[Z].game_id)):null}get language(){return this[Z].language}get title(){return this[Z].title}get views(){return this[Z].view_count}get creationDate(){return new Date(this[Z].created_at)}get thumbnailUrl(){return this[Z].thumbnail_url}get duration(){return this[Z].duration}get vodOffset(){return this[Z].vod_offset}get isFeatured(){return this[Z].is_featured}};W([G(!1)],R3.prototype,"_client",void 0);R3=W([Q("api","HelixClip","id")],R3);var G1=class extends v{constructor(){super(...arguments);this._getClipByIdBatcher=new c({url:"clips"},"id","id",this._client,(M)=>new R3(M,this._client))}async getClipsForBroadcaster(M,$={}){return await this._getClips({...$,filterType:"broadcaster_id",ids:K(M),userId:K(M)})}getClipsForBroadcasterPaginated(M,$={}){return this._getClipsPaginated({...$,filterType:"broadcaster_id",ids:K(M),userId:K(M)})}async getClipsForGame(M,$={}){return await this._getClips({...$,filterType:"game_id",ids:M})}getClipsForGamePaginated(M,$={}){return this._getClipsPaginated({...$,filterType:"game_id",ids:M})}async getClipsByIds(M){return(await this._getClips({filterType:"id",ids:M})).data}async getClipById(M){let $=await this.getClipsByIds([M]);return $.length?$[0]:null}async getClipByIdBatched(M){return await this._getClipByIdBatcher.request(M)}async createClip(M){let{channel:$,createAfterDelay:X=!1}=M;return(await this._client.callApi({type:"helix",url:"clips",method:"POST",userId:K($),scopes:["clips:edit"],canOverrideScopedUserContext:!0,query:u6($,X)})).data[0].id}async _getClips(M){if(!M.ids.length)return{data:[]};let $=await this._client.callApi({type:"helix",url:"clips",userId:M.userId,query:{...o2(M),...k(M)}});return _($,R3,this._client)}_getClipsPaginated(M){return new I({url:"clips",userId:M.userId,query:o2(M)},this._client,($)=>new R3($,this._client))}};W([G(!1)],G1.prototype,"_getClipByIdBatcher",void 0);G1=W([Q("api","HelixClipApi")],G1);class s2 extends P{get id(){return this[Z].id}get name(){return this[Z].name}get description(){return this[Z].description}}var R4=class extends v{async getAll(M){return(await this._client.callApi({url:"content_classification_labels",query:{locale:M}})).data.map((X)=>new s2(X))}};R4=W([Q("api","HelixContentClassificationLabelApi")],R4);function r2(Y,M){return{user_id:M?i(Y.user,K):void 0,game_id:Y.gameId,fulfillment_status:Y.fulfillmentStatus}}function h6(Y,M){return{fulfillment_status:M,entitlement_ids:Y}}var e0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get rewardId(){return this[Z].benefit_id}get grantDate(){return new Date(this[Z].timestamp)}get userId(){return this[Z].user_id}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get gameId(){return this[Z].game_id}async getGame(){return N(await this._client.games.getGameById(this[Z].game_id))}get fulfillmentStatus(){return this[Z].fulfillment_status}get updateDate(){return new Date(this[Z].last_updated)}};W([G(!1)],e0.prototype,"_client",void 0);e0=W([Q("api","HelixDropsEntitlement")],e0);var L1=class extends v{constructor(){super(...arguments);this._getDropsEntitlementByIdBatcher=new c({url:"entitlements/drops"},"id","id",this._client,(M)=>new e0(M,this._client))}async getDropsEntitlements(M,$=!1){let X=await this._client.callApi({type:"helix",url:"entitlements/drops",userId:i(M.user,K),forceType:M.user&&$?"app":void 0,query:{...r2(M,$),...k(M)}});return _(X,e0,this._client)}getDropsEntitlementsPaginated(M,$=!1){return new I({url:"entitlements/drops",userId:i(M.user,K),forceType:M.user&&$?"app":void 0,query:r2(M,$)},this._client,(X)=>new e0(X,this._client))}async getDropsEntitlementsByIds(M){return(await this._client.callApi({type:"helix",url:"entitlements/drops",query:{id:M}})).data.map((X)=>new e0(X,this._client))}async getDropsEntitlementById(M){var $;return($=(await this.getDropsEntitlementsByIds([M]))[0])!==null&&$!==void 0?$:null}async getDropsEntitlementByIdBatched(M){return await this._getDropsEntitlementByIdBatcher.request(M)}async updateDropsEntitlements(M,$){let X=await this._client.callApi({type:"helix",url:"entitlements/drops",method:"PATCH",jsonBody:h6(M,$)});return new Map(X.data.flatMap((O)=>O.ids.map((J)=>[J,O.status])))}};W([G(!1)],L1.prototype,"_getDropsEntitlementByIdBatcher",void 0);L1=W([Q("api","HelixEntitlementApi")],L1);function x(Y){return{broadcaster_user_id:K(Y)}}function q1(Y,M){return{broadcaster_user_id:K(Y),reward_id:M}}function d(Y,M){return{broadcaster_user_id:Y,moderator_user_id:M}}function T0(Y,M){return{broadcaster_user_id:Y,user_id:M}}function p6(Y){return{organization_id:Y.organizationId,category_id:Y.categoryId,campaign_id:Y.campaignId}}function t2(Y,M){return{conduit_id:Y,status:M}}function b6(Y,M){return{id:Y,shard_count:M.toString()}}function m6(Y,M){return{conduit_id:Y,shards:M}}var V0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get status(){return this[Z].status}get type(){return this[Z].type}get cost(){return this[Z].cost}get condition(){return this[Z].condition}get creationDate(){return new Date(this[Z].created_at)}get transportMethod(){return this[Z].transport.method}async unsubscribe(){await this._client.eventSub.deleteSubscription(this[Z].id)}get _transport(){return this[Z].transport}set _status(M){this[Z].status=M}};W([G(!1)],V0.prototype,"_client",void 0);V0=W([Q("api","HelixEventSubSubscription","id")],V0);var N3=class extends z0{constructor(M,$,X){super({url:"eventsub/subscriptions",userId:$,query:M},X,(O)=>new V0(O,X))}async getTotalCost(){var M;return((M=this._currentData)!==null&&M!==void 0?M:await this._fetchData({query:{after:void 0}})).total_cost}async getMaxTotalCost(){var M;return((M=this._currentData)!==null&&M!==void 0?M:await this._fetchData({query:{after:void 0}})).max_total_cost}};N3=W([Q("api","HelixPaginatedEventSubSubscriptionsRequest")],N3);var C3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get shardCount(){return this[Z].shard_count}async update(M){return await this._client.eventSub.updateConduit(this[Z].id,M)}async delete(){await this._client.eventSub.deleteConduit(this[Z].id)}async getShards(){return await this._client.eventSub.getConduitShards(this[Z].id)}};W([G(!1)],C3.prototype,"_client",void 0);C3=W([Q("api","HelixEventSubConduit")],C3);var OM=class extends P{get id(){return this[Z].id}get status(){return this[Z].status}get transportMethod(){return this[Z].transport.method}};OM=W([Q("api","HelixEventSubConduitShard")],OM);var N4=class extends v{async getSubscriptions(M){let $=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",query:k(M)});return{...Z0($,V0,this._client),totalCost:$.total_cost,maxTotalCost:$.max_total_cost}}getSubscriptionsPaginated(){return new N3({},void 0,this._client)}async getSubscriptionsForStatus(M,$){let X=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",query:{...k($),status:M}});return{...Z0(X,V0,this._client),totalCost:X.total_cost,maxTotalCost:X.max_total_cost}}getSubscriptionsForStatusPaginated(M){return new N3({status:M},void 0,this._client)}async getSubscriptionsForType(M,$){let X=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",query:{...k($),type:M}});return{...Z0(X,V0,this._client),totalCost:X.total_cost,maxTotalCost:X.max_total_cost}}getSubscriptionsForTypePaginated(M){return new N3({type:M},void 0,this._client)}async getSubscriptionsForUser(M,$){let X=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",userId:K(M),query:{...S("user_id",K(M)),...k($)}});return{...Z0(X,V0,this._client),totalCost:X.total_cost,maxTotalCost:X.max_total_cost}}getSubscriptionsForUserPaginated(M){let $=K(M);return new N3(S("user_id",$),$,this._client)}async createSubscription(M,$,X,O,J,z,V,F){let L=O.method==="webhook"||O.method==="conduit",R=L?void 0:z;if(!L&&!J)throw Error(`Transport ${O.method} can only handle subscriptions with user context`);let U={type:M,version:$,condition:X,transport:O};if(F)U.is_batching_enabled=!0;let q=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",method:"POST",scopes:R,userId:i(J,K),canOverrideScopedUserContext:V,forceType:L?"app":"user",jsonBody:U});return new V0(q.data[0],this._client)}async deleteSubscription(M){await this._client.callApi({type:"helix",url:"eventsub/subscriptions",method:"DELETE",query:{id:M}})}async deleteAllSubscriptions(){await this._deleteSubscriptionsWithCondition()}async deleteBrokenSubscriptions(){await this._deleteSubscriptionsWithCondition((M)=>M.status!=="enabled"&&M.status!=="webhook_callback_verification_pending")}async subscribeToStreamOnlineEvents(M,$){return await this.createSubscription("stream.online","1",x(M),$,M)}async subscribeToStreamOfflineEvents(M,$){return await this.createSubscription("stream.offline","1",x(M),$,M)}async subscribeToChannelUpdateEvents(M,$){return await this.createSubscription("channel.update","2",x(M),$,M)}async subscribeToChannelFollowEvents(M,$){let X=K(M);return await this.createSubscription("channel.follow","2",d(X,this._getUserContextIdWithDefault(X)),$,X,["moderator:read:followers"],!0)}async subscribeToChannelSubscriptionEvents(M,$){return await this.createSubscription("channel.subscribe","1",x(M),$,M,["channel:read:subscriptions"])}async subscribeToChannelSubscriptionGiftEvents(M,$){return await this.createSubscription("channel.subscription.gift","1",x(M),$,M,["channel:read:subscriptions"])}async subscribeToChannelSubscriptionMessageEvents(M,$){return await this.createSubscription("channel.subscription.message","1",x(M),$,M,["channel:read:subscriptions"])}async subscribeToChannelSubscriptionEndEvents(M,$){return await this.createSubscription("channel.subscription.end","1",x(M),$,M,["channel:read:subscriptions"])}async subscribeToChannelCheerEvents(M,$){return await this.createSubscription("channel.cheer","1",x(M),$,M,["bits:read"])}async subscribeToChannelCharityCampaignStartEvents(M,$){return await this.createSubscription("channel.charity_campaign.start","1",x(M),$,M,["channel:read:charity"])}async subscribeToChannelCharityCampaignStopEvents(M,$){return await this.createSubscription("channel.charity_campaign.stop","1",x(M),$,M,["channel:read:charity"])}async subscribeToChannelCharityDonationEvents(M,$){return await this.createSubscription("channel.charity_campaign.donate","1",x(M),$,M,["channel:read:charity"])}async subscribeToChannelCharityCampaignProgressEvents(M,$){return await this.createSubscription("channel.charity_campaign.progress","1",x(M),$,M,["channel:read:charity"])}async subscribeToChannelBanEvents(M,$){return await this.createSubscription("channel.ban","1",x(M),$,M,["channel:moderate"])}async subscribeToChannelUnbanEvents(M,$){return await this.createSubscription("channel.unban","1",x(M),$,M,["channel:moderate"])}async subscribeToChannelShieldModeBeginEvents(M,$){let X=K(M);return await this.createSubscription("channel.shield_mode.begin","1",d(X,this._getUserContextIdWithDefault(X)),$,X,["moderator:read:shield_mode","moderator:manage:shield_mode"],!0)}async subscribeToChannelShieldModeEndEvents(M,$){let X=K(M);return await this.createSubscription("channel.shield_mode.end","1",d(X,this._getUserContextIdWithDefault(X)),$,X,["moderator:read:shield_mode","moderator:manage:shield_mode"],!0)}async subscribeToChannelModeratorAddEvents(M,$){return await this.createSubscription("channel.moderator.add","1",x(M),$,M,["moderation:read"])}async subscribeToChannelModeratorRemoveEvents(M,$){return await this.createSubscription("channel.moderator.remove","1",x(M),$,M,["moderation:read"])}async subscribeToChannelRaidEventsFrom(M,$){return await this.createSubscription("channel.raid","1",S("from_broadcaster_user_id",K(M)),$,M)}async subscribeToChannelRaidEventsTo(M,$){return await this.createSubscription("channel.raid","1",S("to_broadcaster_user_id",K(M)),$,M)}async subscribeToChannelRewardAddEvents(M,$){return await this.createSubscription("channel.channel_points_custom_reward.add","1",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardUpdateEvents(M,$){return await this.createSubscription("channel.channel_points_custom_reward.update","1",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardUpdateEventsForReward(M,$,X){return await this.createSubscription("channel.channel_points_custom_reward.update","1",q1(M,$),X,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardRemoveEvents(M,$){return await this.createSubscription("channel.channel_points_custom_reward.remove","1",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardRemoveEventsForReward(M,$,X){return await this.createSubscription("channel.channel_points_custom_reward.remove","1",q1(M,$),X,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionAddEvents(M,$){return await this.createSubscription("channel.channel_points_custom_reward_redemption.add","1",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionAddEventsForReward(M,$,X){return await this.createSubscription("channel.channel_points_custom_reward_redemption.add","1",q1(M,$),X,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionUpdateEvents(M,$){return await this.createSubscription("channel.channel_points_custom_reward_redemption.update","1",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionUpdateEventsForReward(M,$,X){return await this.createSubscription("channel.channel_points_custom_reward_redemption.update","1",q1(M,$),X,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelAutomaticRewardRedemptionAddEvents(M,$){return await this.createSubscription("channel.channel_points_automatic_reward_redemption.add","1",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelAutomaticRewardRedemptionAddV2Events(M,$){return await this.createSubscription("channel.channel_points_automatic_reward_redemption.add","2",x(M),$,M,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelPollBeginEvents(M,$){return await this.createSubscription("channel.poll.begin","1",x(M),$,M,["channel:read:polls","channel:manage:polls"])}async subscribeToChannelPollProgressEvents(M,$){return await this.createSubscription("channel.poll.progress","1",x(M),$,M,["channel:read:polls","channel:manage:polls"])}async subscribeToChannelPollEndEvents(M,$){return await this.createSubscription("channel.poll.end","1",x(M),$,M,["channel:read:polls","channel:manage:polls"])}async subscribeToChannelPredictionBeginEvents(M,$){return await this.createSubscription("channel.prediction.begin","1",x(M),$,M,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelPredictionProgressEvents(M,$){return await this.createSubscription("channel.prediction.progress","1",x(M),$,M,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelPredictionLockEvents(M,$){return await this.createSubscription("channel.prediction.lock","1",x(M),$,M,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelPredictionEndEvents(M,$){return await this.createSubscription("channel.prediction.end","1",x(M),$,M,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelGoalBeginEvents(M,$){return await this.createSubscription("channel.goal.begin","1",x(M),$,M,["channel:read:goals"])}async subscribeToChannelGoalProgressEvents(M,$){return await this.createSubscription("channel.goal.progress","1",x(M),$,M,["channel:read:goals"])}async subscribeToChannelGoalEndEvents(M,$){return await this.createSubscription("channel.goal.end","1",x(M),$,M,["channel:read:goals"])}async subscribeToChannelHypeTrainBeginEvents(M,$){return await this.createSubscription("channel.hype_train.begin","1",x(M),$,M,["channel:read:hype_train"])}async subscribeToChannelHypeTrainProgressEvents(M,$){return await this.createSubscription("channel.hype_train.progress","1",x(M),$,M,["channel:read:hype_train"])}async subscribeToChannelHypeTrainEndEvents(M,$){return await this.createSubscription("channel.hype_train.end","1",x(M),$,M,["channel:read:hype_train"])}async subscribeToChannelHypeTrainBeginV2Events(M,$){return await this.createSubscription("channel.hype_train.begin","2",x(M),$,M,["channel:read:hype_train"])}async subscribeToChannelHypeTrainProgressV2Events(M,$){return await this.createSubscription("channel.hype_train.progress","2",x(M),$,M,["channel:read:hype_train"])}async subscribeToChannelHypeTrainEndV2Events(M,$){return await this.createSubscription("channel.hype_train.end","2",x(M),$,M,["channel:read:hype_train"])}async subscribeToChannelShoutoutCreateEvents(M,$){let X=K(M);return await this.createSubscription("channel.shoutout.create","1",d(X,this._getUserContextIdWithDefault(X)),$,X,["moderator:read:shoutouts","moderator:manage:shoutouts"],!0)}async subscribeToChannelShoutoutReceiveEvents(M,$){let X=K(M);return await this.createSubscription("channel.shoutout.receive","1",d(X,this._getUserContextIdWithDefault(X)),$,X,["moderator:read:shoutouts","moderator:manage:shoutouts"],!0)}async subscribeToChannelAdBreakBeginEvents(M,$){return await this.createSubscription("channel.ad_break.begin","1",x(M),$,M,["channel:read:ads"])}async subscribeToChannelChatClearEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.clear","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelChatClearUserMessagesEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.clear_user_messages","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelChatMessageDeleteEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.message_delete","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelChatNotificationEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.notification","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelChatMessageEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.message","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelChatSettingsUpdateEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat_settings.update","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelUnbanRequestCreateEvents(M,$){let X=K(M);return await this.createSubscription("channel.unban_request.create","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:unban_requests","moderator:manage:unban_requests"],!0)}async subscribeToChannelUnbanRequestResolveEvents(M,$){let X=K(M);return await this.createSubscription("channel.unban_request.resolve","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:unban_requests","moderator:manage:unban_requests"],!0)}async subscribeToChannelModerateEvents(M,$){let X=K(M);return await this.createSubscription("channel.moderate","2",d(X,this._getUserContextIdWithDefault(X)),$,M,[],!0)}async subscribeToChannelWarningAcknowledgeEvents(M,$){let X=K(M);return await this.createSubscription("channel.warning.acknowledge","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:warnings","moderator:manage:warnings"],!0)}async subscribeToChannelWarningSendEvents(M,$){let X=K(M);return await this.createSubscription("channel.warning.send","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:warnings","moderator:manage:warnings"],!0)}async subscribeToChannelVipAddEvents(M,$){return await this.createSubscription("channel.vip.add","1",x(M),$,M,["channel:read:vips","channel:manage:vips"])}async subscribeToChannelVipRemoveEvents(M,$){return await this.createSubscription("channel.vip.remove","1",x(M),$,M,["channel:read:vips","channel:manage:vips"])}async subscribeToExtensionBitsTransactionCreateEvents(M,$){return await this.createSubscription("extension.bits_transaction.create","1",S("extension_client_id",M),$)}async subscribeToUserAuthorizationGrantEvents(M,$){return await this.createSubscription("user.authorization.grant","1",S("client_id",M),$)}async subscribeToUserAuthorizationRevokeEvents(M,$){return await this.createSubscription("user.authorization.revoke","1",S("client_id",M),$)}async subscribeToUserUpdateEvents(M,$,X){return await this.createSubscription("user.update","1",S("user_id",K(M)),$,M,X?["user:read:email"]:void 0)}async subscribeToUserWhisperMessageEvents(M,$){return await this.createSubscription("user.whisper.message","1",S("user_id",K(M)),$,M,["user:read:whispers","user:manage:whispers"])}async subscribeToDropEntitlementGrantEvents(M,$){return await this.createSubscription("drop.entitlement.grant","1",p6(M),$,void 0,void 0,!1,!0)}async subscribeToAutoModMessageHoldEvents(M,$){let X=K(M);return await this.createSubscription("automod.message.hold","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:manage:automod"],!0)}async subscribeToAutoModMessageUpdateEvents(M,$){let X=K(M);return await this.createSubscription("automod.message.update","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:manage:automod"],!0)}async subscribeToAutoModMessageHoldV2Events(M,$){let X=K(M);return await this.createSubscription("automod.message.hold","2",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:manage:automod"],!0)}async subscribeToAutoModMessageUpdateV2Events(M,$){let X=K(M);return await this.createSubscription("automod.message.update","2",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:manage:automod"],!0)}async subscribeToAutoModSettingsUpdateEvents(M,$){let X=K(M);return await this.createSubscription("automod.settings.update","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:automod_settings"],!0)}async subscribeToAutoModTermsUpdateEvents(M,$){let X=K(M);return await this.createSubscription("automod.terms.update","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:manage:automod"],!0)}async subscribeToChannelChatUserMessageHoldEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.user_message_hold","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelChatUserMessageUpdateEvents(M,$){let X=K(M);return await this.createSubscription("channel.chat.user_message_update","1",T0(X,this._getUserContextIdWithDefault(X)),$,M,["user:read:chat"],!0)}async subscribeToChannelSuspiciousUserUpdateEvents(M,$){let X=K(M);return await this.createSubscription("channel.suspicious_user.update","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:suspicious_users"],!0)}async subscribeToChannelSuspiciousUserMessageEvents(M,$){let X=K(M);return await this.createSubscription("channel.suspicious_user.message","1",d(X,this._getUserContextIdWithDefault(X)),$,M,["moderator:read:suspicious_users"],!0)}async subscribeToChannelSharedChatSessionBeginEvents(M,$){let X=K(M);return await this.createSubscription("channel.shared_chat.begin","1",x(X),$,X)}async subscribeToChannelSharedChatSessionUpdateEvents(M,$){let X=K(M);return await this.createSubscription("channel.shared_chat.update","1",x(X),$,X)}async subscribeToChannelSharedChatSessionEndEvents(M,$){let X=K(M);return await this.createSubscription("channel.shared_chat.end","1",x(X),$,X)}async subscribeToChannelBitsUseEvents(M,$){let X=K(M);return await this.createSubscription("channel.bits.use","1",x(X),$,X,["bits:read"])}async getConduits(){return(await this._client.callApi({type:"helix",url:"eventsub/conduits"})).data.map(($)=>new C3($,this._client))}async createConduit(M){let $=await this._client.callApi({type:"helix",url:"eventsub/conduits",method:"POST",query:{...S("shard_count",M.toString())}});return new C3($.data[0],this._client)}async updateConduit(M,$){let X=await this._client.callApi({type:"helix",url:"eventsub/conduits",method:"PATCH",query:b6(M,$)});return new C3(X.data[0],this._client)}async deleteConduit(M){await this._client.callApi({type:"helix",url:"eventsub/conduits",method:"DELETE",query:{...S("id",M)}})}async getConduitShards(M,$,X){let O=await this._client.callApi({type:"helix",url:"eventsub/conduits/shards",query:{...t2(M,$),...k(X)}});return{..._(O,OM,this._client)}}getConduitShardsPaginated(M,$){return new I({url:"eventsub/conduits/shards",query:t2(M,$)},this._client,(X)=>new OM(X))}async updateConduitShards(M,$){return(await this._client.callApi({type:"helix",url:"eventsub/conduits/shards",method:"PATCH",jsonBody:m6(M,$)})).data.map((O)=>new OM(O))}async _deleteSubscriptionsWithCondition(M){let $=this.getSubscriptionsPaginated();for await(let X of $)if(!M||M(X))await X.unsubscribe()}};N4=W([Q("api","HelixEventSubApi")],N4);function c6(Y,M){return{extension_id:Y,extension_version:M}}function d6(Y){return{sku:Y.sku,cost:{amount:Y.cost,type:"bits"},display_name:Y.displayName,in_development:Y.inDevelopment,expiration:Y.expirationDate,is_broadcast:Y.broadcast}}function a2(Y,M){return{extension_id:Y,id:M.transactionIds}}var JM=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].broadcaster_id}get displayName(){return this[Z].broadcaster_name}async getChannel(){return N(await this._client.channels.getChannelInfoById(this[Z].broadcaster_id))}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get gameId(){return this[Z].game_id}get gameName(){return this[Z].game_name}async getGame(){return this[Z].game_id?N(await this._client.games.getGameById(this[Z].game_id)):null}get title(){return this[Z].title}};W([G(!1)],JM.prototype,"_client",void 0);JM=W([Q("api","HelixChannelReference","id")],JM);var B1=class extends P{get sku(){return this[Z].sku}get cost(){return this[Z].cost.amount}get displayName(){return this[Z].display_name}get inDevelopment(){return this[Z].in_development}get isBroadcast(){return this[Z].is_broadcast}get expirationDate(){return p(this[Z].expiration,(M)=>new Date(M))}};B1=W([Q("api","HelixExtensionBitsProduct","sku")],B1);var WM=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get transactionDate(){return new Date(this[Z].timestamp)}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_name}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get productType(){return this[Z].product_type}get productSku(){return this[Z].product_data.sku}get productCost(){return this[Z].product_data.cost.amount}get productDisplayName(){return this[Z].product_data.displayName}get productInDevelopment(){return this[Z].product_data.inDevelopment}};W([G(!1)],WM.prototype,"_client",void 0);WM=W([Q("api","HelixExtensionTransaction","id")],WM);var C4=class extends v{async getReleasedExtension(M,$){let X=await this._client.callApi({type:"helix",url:"extensions/released",query:c6(M,$)});return new tM(X.data[0])}async getLiveChannelsWithExtension(M,$){let X=await this._client.callApi({type:"helix",url:"extensions/live",query:{...S("extension_id",M),...k($)}});return _(X,JM,this._client)}getLiveChannelsWithExtensionPaginated(M){return new I({url:"extensions/live",query:S("extension_id",M)},this._client,($)=>new JM($,this._client))}async getExtensionBitsProducts(M){return(await this._client.callApi({type:"helix",url:"bits/extensions",forceType:"app",query:S("should_include_all",M===null||M===void 0?void 0:M.toString())})).data.map((X)=>new B1(X))}async putExtensionBitsProduct(M){let $=await this._client.callApi({type:"helix",url:"bits/extensions",method:"PUT",forceType:"app",jsonBody:d6(M)});return new B1($.data[0])}async getExtensionTransactions(M,$={}){let X=await this._client.callApi({type:"helix",url:"extensions/transactions",forceType:"app",query:{...a2(M,$),...k($)}});return _(X,WM,this._client)}getExtensionTransactionsPaginated(M,$={}){return new I({url:"extensions/transactions",forceType:"app",query:a2(M,$)},this._client,(X)=>new WM(X,this._client))}};C4=W([Q("api","HelixExtensionsApi")],C4);var M0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get name(){return this[Z].name}get boxArtUrl(){return this[Z].box_art_url}get igdbId(){return this[Z].igdb_id||null}getBoxArtUrl(M,$){return this[Z].box_art_url.replace("{width}",M.toString()).replace("{height}",$.toString())}async getStreams(M){return await this._client.streams.getStreams({...M,game:this[Z].id})}getStreamsPaginated(){return this._client.streams.getStreamsPaginated({game:this[Z].id})}};W([G(!1)],M0.prototype,"_client",void 0);M0=W([Q("api","HelixGame","id")],M0);var A3=class extends v{constructor(){super(...arguments);this._getGameByIdBatcher=new c({url:"games"},"id","id",this._client,(M)=>new M0(M,this._client)),this._getGameByNameBatcher=new c({url:"games"},"name","name",this._client,(M)=>new M0(M,this._client)),this._getGameByIgdbIdBatcher=new c({url:"games"},"igdb_id","igdb_id",this._client,(M)=>new M0(M,this._client))}async getGamesByIds(M){return await this._getGames("id",M)}async getGamesByNames(M){return await this._getGames("name",M)}async getGamesByIgdbIds(M){return await this._getGames("igdb_id",M)}async getGameById(M){var $;return($=(await this._getGames("id",[M]))[0])!==null&&$!==void 0?$:null}async getGameByName(M){var $;return($=(await this._getGames("name",[M]))[0])!==null&&$!==void 0?$:null}async getGameByIgdbId(M){var $;return($=(await this._getGames("igdb_id",[M]))[0])!==null&&$!==void 0?$:null}async getGameByIdBatched(M){return await this._getGameByIdBatcher.request(M)}async getGameByNameBatched(M){return await this._getGameByNameBatcher.request(M)}async getGameByIgdbIdBatched(M){return await this._getGameByIgdbIdBatcher.request(M)}async getTopGames(M){let $=await this._client.callApi({type:"helix",url:"games/top",query:k(M)});return _($,M0,this._client)}getTopGamesPaginated(){return new I({url:"games/top"},this._client,(M)=>new M0(M,this._client))}async _getGames(M,$){if(!$.length)return[];return(await this._client.callApi({type:"helix",url:"games",query:{[M]:$}})).data.map((O)=>new M0(O,this._client))}};W([G(!1)],A3.prototype,"_getGameByIdBatcher",void 0);W([G(!1)],A3.prototype,"_getGameByNameBatcher",void 0);W([G(!1)],A3.prototype,"_getGameByIgdbIdBatcher",void 0);A3=W([Q("api","HelixGameApi")],A3);var R1=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterDisplayName(){return this[Z].broadcaster_name}get broadcasterName(){return this[Z].broadcaster_login}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get type(){return this[Z].type}get description(){return this[Z].description}get currentAmount(){return this[Z].current_amount}get targetAmount(){return this[Z].target_amount}get creationDate(){return this[Z].created_at}};W([G(!1)],R1.prototype,"_client",void 0);R1=W([Q("api","HelixGoal","id")],R1);var A4=class extends v{async getGoals(M){return(await this._client.callApi({type:"helix",url:"goals",userId:K(M),scopes:["channel:read:goals"],query:H(M)})).data.map((X)=>new R1(X,this._client))}};A4=W([Q("api","HelixGoalApi")],A4);var zM=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user}async getUser(){return N(await this._client.users.getUserById(this[Z].user))}get type(){return this[Z].type}get total(){return this[Z].total}};W([G(!1)],zM.prototype,"_client",void 0);zM=W([Q("api","HelixHypeTrainContribution","userId")],zM);var VM=class extends P{constructor(M,$){super(M);this._client=$}get eventId(){return this[Z].id}get eventType(){return this[Z].event_type}get eventDate(){return new Date(this[Z].event_timestamp)}get eventVersion(){return this[Z].version}get id(){return this[Z].event_data.id}get broadcasterId(){return this[Z].event_data.broadcaster_id}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].event_data.broadcaster_id))}get level(){return this[Z].event_data.level}get startDate(){return new Date(this[Z].event_data.started_at)}get expiryDate(){return new Date(this[Z].event_data.expires_at)}get cooldownDate(){return new Date(this[Z].event_data.cooldown_end_time)}get total(){return this[Z].event_data.total}get goal(){return this[Z].event_data.goal}get lastContribution(){return new zM(this[Z].event_data.last_contribution,this._client)}get topContributions(){return this[Z].event_data.top_contributions.map((M)=>new zM(M,this._client))}};W([G(!1)],VM.prototype,"_client",void 0);VM=W([Q("api","HelixHypeTrainEvent","id")],VM);class e2 extends v{async getHypeTrainEventsForBroadcaster(Y,M){let $=await this._client.callApi({type:"helix",url:"hypetrain/events",userId:K(Y),scopes:["channel:read:hype_train"],query:{...H(Y),...k(M)}});return _($,VM,this._client)}getHypeTrainEventsForBroadcasterPaginated(Y){return new I({url:"hypetrain/events",userId:K(Y),scopes:["channel:read:hype_train"],query:H(Y)},this._client,(M)=>new VM(M,this._client))}}function M$(Y,M){return{broadcaster_id:K(Y),user_id:M===null||M===void 0?void 0:M.userId}}function $$(Y,M){return{broadcaster_id:K(Y),user_id:K(M)}}function i6(Y,M,$,X,O){return{unban_request_id:$,broadcaster_id:K(Y),moderator_id:K(M),status:X?"approved":"denied",resolution_text:O}}function n6(Y,M,$){return{user_id:K(Y),msg_id:M,action:$?"ALLOW":"DENY"}}function l6(Y){return{overall_level:Y.overallLevel,aggression:Y.aggression,bullying:Y.bullying,disability:Y.disability,misogyny:Y.misogyny,race_ethnicity_or_religion:Y.raceEthnicityOrReligion,sex_based_terms:Y.sexBasedTerms,sexuality_sex_or_gender:Y.sexualitySexOrGender,swearing:Y.swearing}}function o6(Y){return{data:{duration:Y.duration,reason:Y.reason,user_id:K(Y.user)}}}function s6(Y){return{is_active:Y}}function r6(Y){return{data:Y.map((M)=>({msg_id:M.messageId,msg_text:M.messageText}))}}function t6(Y,M){return{data:{user_id:K(Y),reason:M}}}var N1=class extends P{get broadcasterId(){return this[Z].broadcaster_id}get moderatorId(){return this[Z].moderator_id}get overallLevel(){return this[Z].overall_level?this[Z].overall_level:null}get disability(){return this[Z].disability}get aggression(){return this[Z].aggression}get sexualitySexOrGender(){return this[Z].sexuality_sex_or_gender}get misogyny(){return this[Z].misogyny}get bullying(){return this[Z].bullying}get swearing(){return this[Z].swearing}get raceEthnicityOrReligion(){return this[Z].race_ethnicity_or_religion}get sexBasedTerms(){return this[Z].sex_based_terms}};N1=W([Q("api","HelixAutoModSettings","broadcasterId")],N1);var U4=class extends P{get messageId(){return this[Z].msg_id}get isPermitted(){return this[Z].is_permitted}};U4=W([Q("api","HelixAutoModStatus","messageId")],U4);var M3=class extends P{constructor(M,$,X){super(M);this._expiryTimestamp=$,this._client=X}get creationDate(){return new Date(this[Z].created_at)}get expiryDate(){return p(this._expiryTimestamp,(M)=>new Date(M))}get moderatorId(){return this[Z].moderator_id}async getModerator(){return N(await this._client.users.getUserById(this[Z].moderator_id))}get userId(){return this[Z].user_id}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};W([G(!1)],M3.prototype,"_client",void 0);W([G(!1)],M3.prototype,"_expiryTimestamp",void 0);M3=W([Q("api","HelixBanUser","userId")],M3);var C1=class extends M3{constructor(M,$){super(M,M.expires_at||null,$)}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}get moderatorName(){return this[Z].moderator_login}get moderatorDisplayName(){return this[Z].moderator_name}get reason(){return this[Z].reason||null}};C1=W([Q("api","HelixBan","userId")],C1);var A1=class extends P{get broadcasterId(){return this[Z].broadcaster_id}get creationDate(){return new Date(this[Z].created_at)}get expirationDate(){return this[Z].expires_at?new Date(this[Z].expires_at):null}get id(){return this[Z].id}get moderatorId(){return this[Z].moderator_id}get text(){return this[Z].text}get updatedDate(){return new Date(this[Z].updated_at)}};A1=W([Q("api","HelixBlockedTerm","id")],A1);var KM=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].broadcaster_id}get name(){return this[Z].broadcaster_login}get displayName(){return this[Z].broadcaster_name}async getChannel(){return N(await this._client.channels.getChannelInfoById(this[Z].broadcaster_id))}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}};W([G(!1)],KM.prototype,"_client",void 0);KM=W([Q("api","HelixModeratedChannel","id")],KM);var QM=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};W([G(!1)],QM.prototype,"_client",void 0);QM=W([Q("api","HelixModerator","userId")],QM);var FM=class extends P{constructor(M,$){super(M);this._client=$}get isActive(){return this[Z].is_active}get moderatorId(){return this[Z].moderator_id}get moderatorName(){return this[Z].moderator_login}get moderatorDisplayName(){return this[Z].moderator_name}async getModerator(){return N(await this._client.users.getUserById(this[Z].moderator_id))}get lastActivationDate(){return this[Z].last_activated_at===""?null:new Date(this[Z].last_activated_at)}};W([G(!1)],FM.prototype,"_client",void 0);FM=W([Q("api","HelixShieldModeStatus")],FM);var U3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_id}get broadcasterDisplayName(){return this[Z].broadcaster_id}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get moderatorId(){return this[Z].moderator_id}get moderatorName(){return this[Z].moderator_login}get moderatorDisplayName(){return this[Z].moderator_name}async getModerator(){return N(await this._client.users.getUserById(this[Z].moderator_id))}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get message(){return this[Z].text}get creationDate(){return new Date(this[Z].created_at)}get resolutionMessage(){return this[Z].resolution_text||null}get resolutionDate(){return p(this[Z].resolved_at,(M)=>new Date(M))}};W([G(!1)],U3.prototype,"_client",void 0);U3=W([Q("api","HelixUnbanRequest","id")],U3);var U1=class extends P{constructor(M,$){super(M);this._client=$}get broadcasterId(){return this[Z].user_id}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get moderatorId(){return this[Z].moderator_id}async getModerator(){return N(await this._client.users.getUserById(this[Z].moderator_id))}get userId(){return this[Z].user_id}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get reason(){return this[Z].reason}};W([G(!1)],U1.prototype,"_client",void 0);U1=W([Q("api","HelixWarning","userId")],U1);var P4=class extends v{async getBannedUsers(M,$){let X=await this._client.callApi({type:"helix",url:"moderation/banned",userId:K(M),scopes:["moderation:read"],query:{...M$(M,$),...k($)}});return _(X,C1,this._client)}getBannedUsersPaginated(M){return new I({url:"moderation/banned",userId:K(M),scopes:["moderation:read"],query:H(M)},this._client,($)=>new C1($,this._client),50)}async checkUserBan(M,$){let X=K($);return(await this.getBannedUsers(M,{userId:X})).data.some((J)=>J.userId===X)}async getModerators(M,$){let X=await this._client.callApi({type:"helix",url:"moderation/moderators",userId:K(M),scopes:["moderation:read","channel:manage:moderators"],query:{...M$(M,$),...k($)}});return _(X,QM,this._client)}getModeratorsPaginated(M){return new I({url:"moderation/moderators",userId:K(M),scopes:["moderation:read","channel:manage:moderators"],query:H(M)},this._client,($)=>new QM($,this._client))}async getModeratedChannels(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"moderation/channels",userId:X,scopes:["user:read:moderated_channels"],query:{...S("user_id",X),...k($)}});return _(O,KM,this._client)}getModeratedChannelsPaginated(M){let $=K(M);return new I({url:"moderation/channels",userId:$,scopes:["user:read:moderated_channels"],query:S("user_id",$)},this._client,(X)=>new KM(X,this._client))}async checkUserMod(M,$){let X=K($);return(await this.getModerators(M,{userId:X})).data.some((J)=>J.userId===X)}async addModerator(M,$){await this._client.callApi({type:"helix",url:"moderation/moderators",method:"POST",userId:K(M),scopes:["channel:manage:moderators"],query:$$(M,$)})}async removeModerator(M,$){await this._client.callApi({type:"helix",url:"moderation/moderators",method:"DELETE",userId:K(M),scopes:["channel:manage:moderators"],query:$$(M,$)})}async checkAutoModStatus(M,$){return(await this._client.callApi({type:"helix",url:"moderation/enforcements/status",method:"POST",userId:K(M),scopes:["moderation:read"],query:H(M),jsonBody:r6($)})).data.map((O)=>new U4(O))}async processHeldAutoModMessage(M,$,X){await this._client.callApi({type:"helix",url:"moderation/automod/message",method:"POST",userId:K(M),scopes:["moderator:manage:automod"],jsonBody:n6(M,$,X)})}async getAutoModSettings(M){let $=K(M);return(await this._client.callApi({type:"helix",url:"moderation/automod/settings",userId:$,scopes:["moderator:read:automod_settings"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery($)})).data.map((O)=>new N1(O))}async updateAutoModSettings(M,$){let X=K(M);return(await this._client.callApi({type:"helix",url:"moderation/automod/settings",method:"PUT",userId:X,scopes:["moderator:manage:automod_settings"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(X),jsonBody:l6($)})).data.map((J)=>new N1(J))}async banUser(M,$){let X=K(M);return(await this._client.callApi({type:"helix",url:"moderation/bans",method:"POST",userId:X,scopes:["moderator:manage:banned_users"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(X),jsonBody:o6($)})).data.map((J)=>new M3(J,J.end_time,this._client))}async unbanUser(M,$){let X=K(M);await this._client.callApi({type:"helix",url:"moderation/bans",method:"DELETE",userId:X,scopes:["moderator:manage:banned_users"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(X),...S("user_id",K($))}})}async getBlockedTerms(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"moderation/blocked_terms",userId:X,scopes:["moderator:read:blocked_terms"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(X),...k($)}});return _(O,A1,this._client)}async addBlockedTerm(M,$){let X=K(M);return(await this._client.callApi({type:"helix",url:"moderation/blocked_terms",method:"POST",userId:X,scopes:["moderator:manage:blocked_terms"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(X),jsonBody:{text:$}})).data.map((J)=>new A1(J))}async removeBlockedTerm(M,$,X){let O=K(M);await this._client.callApi({type:"helix",url:"moderation/blocked_terms",method:"DELETE",userId:O,scopes:["moderator:manage:blocked_terms"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(O),id:X}})}async deleteChatMessages(M,$){let X=K(M);await this._client.callApi({type:"helix",url:"moderation/chat",method:"DELETE",userId:X,scopes:["moderator:manage:chat_messages"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(X),...S("message_id",$)}})}async getShieldModeStatus(M){let $=K(M),X=await this._client.callApi({type:"helix",url:"moderation/shield_mode",method:"GET",userId:$,scopes:["moderator:read:shield_mode","moderator:manage:shield_mode"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery($)});return new FM(X.data[0],this._client)}async updateShieldModeStatus(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"moderation/shield_mode",method:"PUT",userId:X,scopes:["moderator:manage:shield_mode"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(X),jsonBody:s6($)});return new FM(O.data[0],this._client)}async getUnbanRequests(M,$,X){let O=K(M),J=await this._client.callApi({type:"helix",url:"moderation/unban_requests",method:"GET",userId:O,scopes:["moderator:read:unban_requests","moderator:manage:unban_requests"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(O),...S("status",$),...k(X)}});return _(J,U3,this._client)}getUnbanRequestsPaginated(M,$){let X=K(M);return new I({url:"moderation/unban_requests",method:"GET",userId:X,scopes:["moderator:read:unban_requests","moderator:manage:unban_requests"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(X),...S("status",$)}},this._client,(O)=>new U3(O,this._client))}async resolveUnbanRequest(M,$,X,O){let J=K(M),z=await this._client.callApi({type:"helix",url:"moderation/unban_requests",method:"PATCH",userId:J,scopes:["moderator:manage:unban_requests"],canOverrideScopedUserContext:!0,query:i6(J,this._getUserContextIdWithDefault(J),$,X,O===null||O===void 0?void 0:O.slice(0,500))});return new U3(z.data[0],this._client)}async warnUser(M,$,X){let O=K(M),J=await this._client.callApi({type:"helix",url:"moderation/warnings",method:"POST",userId:O,scopes:["moderator:manage:warnings"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(O),jsonBody:t6($,X.slice(0,500))});return new U1(J.data[0],this._client)}_createModeratorActionQuery(M){return V4(M,this._getUserContextIdWithDefault(M))}};P4=W([Q("api","HelixModerationApi")],P4);function a6(Y,M){var $;return{broadcaster_id:K(Y),title:M.title,choices:M.choices.map((X)=>({title:X})),duration:M.duration,channel_points_voting_enabled:M.channelPointsPerVote!=null,channel_points_per_vote:($=M.channelPointsPerVote)!==null&&$!==void 0?$:0}}function e6(Y,M,$){return{broadcaster_id:K(Y),id:M,status:$?"TERMINATED":"ARCHIVED"}}var f4=class extends P{get id(){return this[Z].id}get title(){return this[Z].title}get totalVotes(){return this[Z].votes}get channelPointsVotes(){return this[Z].channel_points_votes}};f4=W([Q("api","HelixPollChoice","id")],f4);var E0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get title(){return this[Z].title}get isChannelPointsVotingEnabled(){return this[Z].channel_points_voting_enabled}get channelPointsPerVote(){return this[Z].channel_points_per_vote}get status(){return this[Z].status}get durationInSeconds(){return this[Z].duration}get startDate(){return new Date(this[Z].started_at)}get endDate(){return new Date(this.startDate.getTime()+this[Z].duration*1000)}get choices(){return this[Z].choices.map((M)=>new f4(M))}};W([G(!1)],E0.prototype,"_client",void 0);E0=W([Q("api","HelixPoll","id")],E0);var j4=class extends v{async getPolls(M,$){let X=await this._client.callApi({type:"helix",url:"polls",userId:K(M),scopes:["channel:read:polls","channel:manage:polls"],query:{...H(M),...k($)}});return _(X,E0,this._client)}getPollsPaginated(M){return new I({url:"polls",userId:K(M),scopes:["channel:read:polls","channel:manage:polls"],query:H(M)},this._client,($)=>new E0($,this._client),20)}async getPollsByIds(M,$){if(!$.length)return[];return(await this._client.callApi({type:"helix",url:"polls",userId:K(M),scopes:["channel:read:polls","channel:manage:polls"],query:s0(M,$)})).data.map((O)=>new E0(O,this._client))}async getPollById(M,$){let X=await this.getPollsByIds(M,[$]);return X.length?X[0]:null}async createPoll(M,$){let X=await this._client.callApi({type:"helix",url:"polls",method:"POST",userId:K(M),scopes:["channel:manage:polls"],jsonBody:a6(M,$)});return new E0(X.data[0],this._client)}async endPoll(M,$,X=!0){let O=await this._client.callApi({type:"helix",url:"polls",method:"PATCH",userId:K(M),scopes:["channel:manage:polls"],jsonBody:e6(M,$,X)});return new E0(O.data[0],this._client)}};j4=W([Q("api","HelixPollApi")],j4);function M9(Y,M){return{broadcaster_id:K(Y),title:M.title,outcomes:M.outcomes.map(($)=>({title:$})),prediction_window:M.autoLockAfter}}function $9(Y,M,$,X){return{broadcaster_id:K(Y),id:M,status:$,winning_outcome_id:X}}var P1=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return await this._client.users.getUserById(this[Z].user_id)}get channelPointsUsed(){return this[Z].channel_points_used}get channelPointsWon(){return this[Z].channel_points_won}};W([G(!1)],P1.prototype,"_client",void 0);P1=W([Q("api","HelixPredictor","userId")],P1);var GM=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get title(){return this[Z].title}get users(){return this[Z].users}get totalChannelPoints(){return this[Z].channel_points}get color(){return this[Z].color}get topPredictors(){var M,$;return($=(M=this[Z].top_predictors)===null||M===void 0?void 0:M.map((X)=>new P1(X,this._client)))!==null&&$!==void 0?$:[]}};W([G(!1)],GM.prototype,"_client",void 0);GM=W([Q("api","HelixPredictionOutcome","id")],GM);var k0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get title(){return this[Z].title}get status(){return this[Z].status}get autoLockAfter(){return this[Z].prediction_window}get creationDate(){return new Date(this[Z].created_at)}get endDate(){return this[Z].ended_at?new Date(this[Z].ended_at):null}get lockDate(){return this[Z].locked_at?new Date(this[Z].locked_at):null}get outcomes(){return this[Z].outcomes.map((M)=>new GM(M,this._client))}get winningOutcomeId(){return this[Z].winning_outcome_id||null}get winningOutcome(){if(!this[Z].winning_outcome_id)return null;let M=this[Z].outcomes.find(($)=>$.id===this[Z].winning_outcome_id);if(!M)throw new m("Winning outcome not found in outcomes array");return new GM(M,this._client)}};W([G(!1)],k0.prototype,"_client",void 0);k0=W([Q("api","HelixPrediction","id")],k0);var T4=class extends v{async getPredictions(M,$){let X=await this._client.callApi({type:"helix",url:"predictions",userId:K(M),scopes:["channel:read:predictions"],query:{...H(M),...k($)}});return _(X,k0,this._client)}getPredictionsPaginated(M){return new I({url:"predictions",userId:K(M),scopes:["channel:read:predictions"],query:H(M)},this._client,($)=>new k0($,this._client),20)}async getPredictionsByIds(M,$){if(!$.length)return[];return(await this._client.callApi({type:"helix",url:"predictions",userId:K(M),scopes:["channel:read:predictions"],query:s0(M,$)})).data.map((O)=>new k0(O,this._client))}async getPredictionById(M,$){let X=await this.getPredictionsByIds(M,[$]);return X.length?X[0]:null}async createPrediction(M,$){let X=await this._client.callApi({type:"helix",url:"predictions",method:"POST",userId:K(M),scopes:["channel:manage:predictions"],jsonBody:M9(M,$)});return new k0(X.data[0],this._client)}async lockPrediction(M,$){return await this._endPrediction(M,$,"LOCKED")}async resolvePrediction(M,$,X){return await this._endPrediction(M,$,"RESOLVED",X)}async cancelPrediction(M,$){return await this._endPrediction(M,$,"CANCELED")}async _endPrediction(M,$,X,O){let J=await this._client.callApi({type:"helix",url:"predictions",method:"PATCH",userId:K(M),scopes:["channel:manage:predictions"],jsonBody:$9(M,$,X,O)});return new k0(J.data[0],this._client)}};T4=W([Q("api","HelixPredictionApi")],T4);function Y9(Y,M){return{from_broadcaster_id:K(Y),to_broadcaster_id:K(M)}}var E4=class extends P{get creationDate(){return new Date(this[Z].created_at)}get targetIsMature(){return this[Z].is_mature}};E4=W([Q("api","HelixRaid")],E4);var k4=class extends v{async startRaid(M,$){let X=await this._client.callApi({type:"helix",url:"raids",method:"POST",userId:K(M),scopes:["channel:manage:raids"],query:Y9(M,$)});return new E4(X.data[0])}async cancelRaid(M){await this._client.callApi({type:"helix",url:"raids",method:"DELETE",userId:K(M),scopes:["channel:manage:raids"],query:H(M)})}};k4=W([Q("api","HelixRaidApi")],k4);function D4(Y,M){var $;return{broadcaster_id:K(Y),start_time:M===null||M===void 0?void 0:M.startDate,utc_offset:($=M===null||M===void 0?void 0:M.utcOffset)===null||$===void 0?void 0:$.toString()}}function X9(Y,M){if(M.vacation)return{broadcaster_id:K(Y),is_vacation_enabled:"true",vacation_start_time:M.vacation.startDate,vacation_end_time:M.vacation.endDate,timezone:M.vacation.timezone};return{broadcaster_id:K(Y),is_vacation_enabled:"false"}}function Z9(Y){return{start_time:Y.startDate,timezone:Y.timezone,is_recurring:Y.isRecurring,duration:Y.duration,category_id:Y.categoryId,title:Y.title}}function Y$(Y,M){return{broadcaster_id:K(Y),id:M}}function O9(Y){return{start_time:Y.startDate,timezone:Y.timezone,is_canceled:Y.isCanceled,duration:Y.duration,category_id:Y.categoryId,title:Y.title}}var K0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get startDate(){return new Date(this[Z].start_time)}get endDate(){return new Date(this[Z].end_time)}get title(){return this[Z].title}get cancelEndDate(){return p(this[Z].canceled_until,(M)=>new Date(M))}get categoryId(){var M,$;return($=(M=this[Z].category)===null||M===void 0?void 0:M.id)!==null&&$!==void 0?$:null}get categoryName(){var M,$;return($=(M=this[Z].category)===null||M===void 0?void 0:M.name)!==null&&$!==void 0?$:null}async getCategory(){var M;let $=(M=this[Z].category)===null||M===void 0?void 0:M.id;return $?await this._client.games.getGameById($):null}get isRecurring(){return this[Z].is_recurring}};W([G(!1)],K0.prototype,"_client",void 0);K0=W([Q("api","HelixScheduleSegment","id")],K0);var v4=class extends I{constructor(M,$,X){super({url:"schedule",query:D4(M,X)},$,(O)=>new K0(O,$),25)}async _fetchData(M={}){var $;let X=await super._fetchData(M);return{data:($=X.data.segments)!==null&&$!==void 0?$:[],pagination:X.pagination}}};v4=W([Q("api","HelixPaginatedScheduleSegmentRequest")],v4);var f1=class extends P{constructor(M,$){super(M);this._client=$}get segments(){var M,$;return($=(M=this[Z].segments)===null||M===void 0?void 0:M.map((X)=>new K0(X,this._client)))!==null&&$!==void 0?$:[]}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get vacationStartDate(){var M;let $=(M=this[Z].vacation)===null||M===void 0?void 0:M.start_time;return $?new Date($):null}get vacationEndDate(){var M;let $=(M=this[Z].vacation)===null||M===void 0?void 0:M.end_time;return $?new Date($):null}};W([G(!1)],f1.prototype,"_client",void 0);f1=W([Q("api","HelixSchedule","broadcasterId")],f1);class X$ extends v{async getSchedule(Y,M){let $=await this._client.callApi({type:"helix",url:"schedule",userId:K(Y),query:{...D4(Y,M),...k(M)}});return{data:new f1($.data,this._client),cursor:$.pagination.cursor}}getScheduleSegmentsPaginated(Y,M){return new v4(Y,this._client,M)}async getScheduleSegmentsByIds(Y,M){var $,X;return(X=($=(await this._client.callApi({type:"helix",url:"schedule",userId:K(Y),query:s0(Y,M)})).data.segments)===null||$===void 0?void 0:$.map((J)=>new K0(J,this._client)))!==null&&X!==void 0?X:[]}async getScheduleSegmentById(Y,M){let $=await this.getScheduleSegmentsByIds(Y,[M]);return $.length?$[0]:null}async getScheduleAsIcal(Y){return await this._client.callApi({type:"helix",url:"schedule/icalendar",query:H(Y)})}async updateScheduleSettings(Y,M){await this._client.callApi({type:"helix",url:"schedule/settings",method:"PATCH",userId:K(Y),scopes:["channel:manage:schedule"],query:X9(Y,M)})}async createScheduleSegment(Y,M){let $=await this._client.callApi({type:"helix",url:"schedule/segment",method:"POST",userId:K(Y),scopes:["channel:manage:schedule"],query:H(Y),jsonBody:Z9(M)});return new K0($.data.segments[0],this._client)}async updateScheduleSegment(Y,M,$){let X=await this._client.callApi({type:"helix",url:"schedule/segment",method:"PATCH",userId:K(Y),scopes:["channel:manage:schedule"],query:Y$(Y,M),jsonBody:O9($)});return new K0(X.data.segments[0],this._client)}async deleteScheduleSegment(Y,M){await this._client.callApi({type:"helix",url:"schedule/segment",method:"DELETE",userId:K(Y),scopes:["channel:manage:schedule"],query:Y$(Y,M)})}}function Z$(Y,M){var $;return{query:Y,live_only:($=M.liveOnly)===null||$===void 0?void 0:$.toString()}}var LM=class extends P{constructor(M,$){super(M);this._client=$}get language(){return this[Z].broadcaster_language}get id(){return this[Z].id}get name(){return this[Z].broadcaster_login}get displayName(){return this[Z].display_name}async getUser(){return N(await this._client.users.getUserById(this[Z].id))}get gameId(){return this[Z].game_id}get gameName(){return this[Z].game_name}async getGame(){return this[Z].game_id?N(await this._client.games.getGameById(this[Z].game_id)):null}get isLive(){return this[Z].is_live}get tags(){return this[Z].tags}get thumbnailUrl(){return this[Z].thumbnail_url}get startDate(){return this[Z].is_live?new Date(this[Z].started_at):null}};W([G(!1)],LM.prototype,"_client",void 0);LM=W([Q("api","HelixChannelSearchResult","id")],LM);var H4=class extends v{async searchCategories(M,$){let X=await this._client.callApi({type:"helix",url:"search/categories",query:{query:M,...k($)}});return _(X,M0,this._client)}searchCategoriesPaginated(M){return new I({url:"search/categories",query:{query:M}},this._client,($)=>new M0($,this._client))}async searchChannels(M,$={}){let X=await this._client.callApi({type:"helix",url:"search/channels",query:{...Z$(M,$),...k($)}});return _(X,LM,this._client)}searchChannelsPaginated(M,$={}){return new I({url:"search/channels",query:Z$(M,$)},this._client,(X)=>new LM(X,this._client))}};H4=W([Q("api","HelixSearchApi")],H4);class O$ extends b{constructor(Y){super("Your stream needs to be live to do this",Y)}}function I4(Y){return{game_id:Y.game,language:Y.language,type:Y.type,user_id:Y.userId,user_login:Y.userName}}function J9(Y,M){return{user_id:K(Y),description:M}}function J$(Y){return{video_id:Y}}var Q0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get gameId(){return this[Z].game_id}get gameName(){return this[Z].game_name}async getGame(){return this[Z].game_id?N(await this._client.games.getGameById(this[Z].game_id)):null}get type(){return this[Z].type}get title(){return this[Z].title}get viewers(){return this[Z].viewer_count}get startDate(){return new Date(this[Z].started_at)}get language(){return this[Z].language}get thumbnailUrl(){return this[Z].thumbnail_url}getThumbnailUrl(M,$){return this[Z].thumbnail_url.replace("{width}",M.toString()).replace("{height}",$.toString())}get tags(){return this[Z].tags}get isMature(){return this[Z].is_mature}};W([G(!1)],Q0.prototype,"_client",void 0);Q0=W([Q("api","HelixStream","id")],Q0);var P3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get creationDate(){return new Date(this[Z].created_at)}get description(){return this[Z].description}get positionInSeconds(){return this[Z].position_seconds}};W([G(!1)],P3.prototype,"_client",void 0);P3=W([Q("api","HelixStreamMarker","id")],P3);var x4=class extends P3{constructor(M,$,X){super(M,X);this._videoId=$}get url(){return this[Z].URL}get videoId(){return this._videoId}async getVideo(){return N(await this._client.videos.getVideoById(this._videoId))}};x4=W([Q("api","HelixStreamMarkerWithVideo","id")],x4);var qM,BM=qM=class extends v{constructor(){super(...arguments);this._getStreamByUserIdBatcher=new c({url:"streams"},"user_id","user_id",this._client,(M)=>new Q0(M,this._client)),this._getStreamByUserNameBatcher=new c({url:"streams"},"user_login","user_login",this._client,(M)=>new Q0(M,this._client))}async getStreams(M={}){let $=await this._client.callApi({url:"streams",type:"helix",query:{...I4(M),...k(M)}});return _($,Q0,this._client)}getStreamsPaginated(M={}){return new I({url:"streams",query:I4(M)},this._client,($)=>new Q0($,this._client))}async getStreamsByUserNames(M){return(await this.getStreams({userName:M.map(u0)})).data}async getStreamByUserName(M){var $;return($=(await this.getStreamsByUserNames([M]))[0])!==null&&$!==void 0?$:null}async getStreamByUserNameBatched(M){return await this._getStreamByUserNameBatcher.request(u0(M))}async getStreamsByUserIds(M){return(await this.getStreams({userId:M.map(K)})).data}async getStreamByUserId(M){let $=K(M),X=await this._client.callApi({url:"streams",type:"helix",userId:$,query:I4({userId:$})});return p(X.data[0],(O)=>new Q0(O,this._client))}async getStreamByUserIdBatched(M){return await this._getStreamByUserIdBatcher.request(K(M))}async getStreamMarkersForUser(M,$){var X;let O=await this._client.callApi({url:"streams/markers",type:"helix",query:{...b2(M),...k($)},userId:K(M),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0});return{data:i1(O.data.map((J)=>qM._mapGetStreamMarkersResult(J,this._client))),cursor:(X=O.pagination)===null||X===void 0?void 0:X.cursor}}getStreamMarkersForUserPaginated(M){return new I({url:"streams/markers",query:b2(M),userId:K(M),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0},this._client,($)=>qM._mapGetStreamMarkersResult($,this._client))}async getStreamMarkersForVideo(M,$,X){var O;let J=await this._client.callApi({url:"streams/markers",type:"helix",query:{...J$($),...k(X)},userId:K(M),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0});return{data:i1(J.data.map((z)=>qM._mapGetStreamMarkersResult(z,this._client))),cursor:(O=J.pagination)===null||O===void 0?void 0:O.cursor}}getStreamMarkersForVideoPaginated(M,$){return new I({url:"streams/markers",query:J$($),userId:K(M),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0},this._client,(X)=>qM._mapGetStreamMarkersResult(X,this._client))}async createStreamMarker(M,$){try{let X=await this._client.callApi({url:"streams/markers",method:"POST",type:"helix",userId:K(M),scopes:["channel:manage:broadcast"],canOverrideScopedUserContext:!0,jsonBody:J9(M,$)});return new P3(X.data[0],this._client)}catch(X){if(X instanceof r&&X.statusCode===404)throw new O$({cause:X});throw X}}async getStreamKey(M){let $=K(M);return(await this._client.callApi({type:"helix",url:"streams/key",userId:$,scopes:["channel:read:stream_key"],query:H(M)})).data[0].stream_key}async getFollowedStreams(M,$){let X=K(M),O=await this._client.callApi({type:"helix",url:"streams/followed",userId:X,scopes:["user:read:follows"],query:{...S("user_id",X),...k($)}});return _(O,Q0,this._client)}getFollowedStreamsPaginated(M){let $=K(M);return new I({url:"streams/followed",userId:$,scopes:["user:read:follows"],query:S("user_id",$)},this._client,(X)=>new Q0(X,this._client))}static _mapGetStreamMarkersResult(M,$){return M.videos.reduce((X,O)=>[...X,...O.markers.map((J)=>new x4(J,O.video_id,$))],[])}};W([G(!1)],BM.prototype,"_getStreamByUserIdBatcher",void 0);W([G(!1)],BM.prototype,"_getStreamByUserNameBatcher",void 0);BM=qM=W([Q("api","HelixStreamApi")],BM);function W9(Y,M){return{broadcaster_id:K(Y),user_id:K(M)}}var f3=class extends P{constructor(M,$){super(M);this._client=$}get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return await this._client.users.getUserById(this[Z].broadcaster_id)}get isGift(){return this[Z].is_gift}get tier(){return this[Z].tier}};W([G(!1)],f3.prototype,"_client",void 0);f3=W([Q("api","HelixUserSubscription","broadcasterId")],f3);var j3=class extends f3{get broadcasterId(){return this[Z].broadcaster_id}get broadcasterName(){return this[Z].broadcaster_login}get broadcasterDisplayName(){return this[Z].broadcaster_name}async getBroadcaster(){return N(await this._client.users.getUserById(this[Z].broadcaster_id))}get gifterId(){return this[Z].is_gift?this[Z].gifter_id:null}get gifterName(){return this[Z].is_gift?this[Z].gifter_login:null}get gifterDisplayName(){return this[Z].is_gift?this[Z].gifter_name:null}async getGifter(){return this[Z].is_gift?N(await this._client.users.getUserById(this[Z].gifter_id)):null}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};j3=W([Q("api","HelixSubscription","userId")],j3);var _4=class extends z0{constructor(M,$){super({url:"subscriptions",scopes:["channel:read:subscriptions"],userId:K(M),query:H(M)},$,(X)=>new j3(X,$))}async getPoints(){var M;return((M=this._currentData)!==null&&M!==void 0?M:await this._fetchData({query:{after:void 0}})).points}};_4=W([Q("api","HelixPaginatedSubscriptionsRequest")],_4);var w4=class extends v{async getSubscriptions(M,$){let X=await this._client.callApi({url:"subscriptions",scopes:["channel:read:subscriptions"],type:"helix",userId:K(M),query:{...H(M),...k($)}});return{...Z0(X,j3,this._client),points:X.points}}getSubscriptionsPaginated(M){return new _4(M,this._client)}async getSubscriptionsForUsers(M,$){return(await this._client.callApi({type:"helix",url:"subscriptions",userId:K(M),scopes:["channel:read:subscriptions"],query:K4(M,$)})).data.map((O)=>new j3(O,this._client))}async getSubscriptionForUser(M,$){let X=await this.getSubscriptionsForUsers(M,[$]);return X.length?X[0]:null}async checkUserSubscription(M,$){try{let X=await this._client.callApi({type:"helix",url:"subscriptions/user",userId:K(M),scopes:["user:read:subscriptions"],query:W9($,M)});return new f3(X.data[0],this._client)}catch(X){if(X instanceof r&&X.statusCode===404)return null;throw X}}};w4=W([Q("api","HelixSubscriptionApi")],w4);var T3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get name(){return this[Z].team_name}get displayName(){return this[Z].team_display_name}get backgroundImageUrl(){return this[Z].background_image_url}get bannerUrl(){return this[Z].banner}get creationDate(){return new Date(this[Z].created_at)}get updateDate(){return new Date(this[Z].updated_at)}get info(){return this[Z].info}get logoThumbnailUrl(){return this[Z].thumbnail_url}async getUserRelations(){return(await this._client.teams.getTeamById(this.id)).userRelations}};W([G(!1)],T3.prototype,"_client",void 0);T3=W([Q("api","HelixTeam","id")],T3);var j1=class extends T3{get userRelations(){return this[Z].users.map((M)=>new j0(M,this._client))}};j1=W([Q("api","HelixTeamWithUsers","id")],j1);var S4=class extends v{async getTeamsForBroadcaster(M){var $,X;return(X=($=(await this._client.callApi({type:"helix",url:"teams/channel",userId:K(M),query:H(M)})).data)===null||$===void 0?void 0:$.map((J)=>new T3(J,this._client)))!==null&&X!==void 0?X:[]}async getTeamById(M){try{let $=await this._client.callApi({type:"helix",url:"teams",query:{id:M}});return new j1($.data[0],this._client)}catch($){if($ instanceof r&&$.statusCode===500)return null;throw $}}async getTeamByName(M){try{let $=await this._client.callApi({type:"helix",url:"teams",query:{name:M}});return new j1($.data[0],this._client)}catch($){if($ instanceof r&&$.statusCode===404)return null;throw $}}};S4=W([Q("api","HelixTeamApi")],S4);function z9(Y,M){return{target_user_id:K(Y),source_context:M.sourceContext,reason:M.reason}}function V9(Y){return{target_user_id:K(Y)}}class T1 extends P{get id(){return this[Z].id}get version(){return this[Z].version}get name(){return this[Z].name}}var RM=class extends T1{constructor(M,$,X){super(X);this._slotType=M,this._slotId=$}get slotType(){return this._slotType}get slotId(){return this._slotId}};RM=W([Q("api","HelixInstalledExtension","id")],RM);var E1=class extends P{getExtensionAtSlot(M,$){let X=this[Z][M][$];return X.active?new RM(M,$,X):null}getExtensionsForSlotType(M){return[...Object.entries(this[Z][M])].filter(($)=>$[1].active).map(([$,X])=>new RM(M,$,X))}getAllExtensions(){return[...Object.entries(this[Z])].flatMap(([M,$])=>[...Object.entries($)].filter((X)=>X[1].active).map(([X,O])=>new RM(M,X,O)))}};E1=W([Q("api","HelixInstalledExtensionList")],E1);var y4=class extends T1{get canActivate(){return this[Z].can_activate}get types(){return this[Z].type}};y4=W([Q("api","HelixUserExtension","id")],y4);var C0=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get name(){return this[Z].login}get displayName(){return this[Z].display_name}get description(){return this[Z].description}get type(){return this[Z].type}get broadcasterType(){return this[Z].broadcaster_type}get profilePictureUrl(){return this[Z].profile_image_url}get offlinePlaceholderUrl(){return this[Z].offline_image_url}get creationDate(){return new Date(this[Z].created_at)}async getStream(){return await this._client.streams.getStreamByUserId(this)}async getFollowedChannels(){return await this._client.channels.getFollowedChannels(this)}async getFollowedChannel(M){var $;return($=(await this._client.channels.getFollowedChannels(this,M)).data[0])!==null&&$!==void 0?$:null}async follows(M){return await this.getFollowedChannel(M)!==null}async getChannelFollowers(){return await this._client.channels.getChannelFollowers(this)}async getChannelFollower(M){var $;return($=(await this._client.channels.getChannelFollowers(this,M)).data[0])!==null&&$!==void 0?$:null}async isFollowedBy(M){return await this.getChannelFollower(M)!==null}async getSubscriptionTo(M){return await this._client.subscriptions.checkUserSubscription(this,M)}async isSubscribedTo(M){return await this.getSubscriptionTo(M)!==null}async getSubscriber(M){return await this._client.subscriptions.getSubscriptionForUser(this,M)}async hasSubscriber(M){return await this.getSubscriber(M)!==null}};W([G(!1)],C0.prototype,"_client",void 0);C0=W([Q("api","HelixUser","id")],C0);var k1=class extends C0{get email(){return this[Z].email}async setDescription(M){return await this._client.users.updateAuthenticatedUser(this,{description:M})}};k1=W([Q("api","HelixPrivilegedUser","id")],k1);var NM=class extends P{constructor(M,$){super(M);this._client=$}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].display_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}};W([G(!1)],NM.prototype,"_client",void 0);NM=W([Q("api","HelixUserBlock","userId")],NM);var CM=class extends v{constructor(){super(...arguments);this._getUserByIdBatcher=new c({url:"users"},"id","id",this._client,(M)=>new C0(M,this._client)),this._getUserByNameBatcher=new c({url:"users"},"login","login",this._client,(M)=>new C0(M,this._client))}async getUsersByIds(M){return await this._getUsers("id",M.map(K))}async getUsersByNames(M){return await this._getUsers("login",M.map(u0))}async getUserById(M){let $=K(M),X=await this._client.callApi({type:"helix",url:"users",userId:$,query:{id:$}});return p(X.data[0],(O)=>new C0(O,this._client))}async getUserByIdBatched(M){return await this._getUserByIdBatcher.request(K(M))}async getUserByName(M){let $=await this._getUsers("login",[u0(M)]);return $.length?$[0]:null}async getUserByNameBatched(M){return await this._getUserByNameBatcher.request(u0(M))}async getAuthenticatedUser(M,$=!1){var X;let O=await this._client.callApi({type:"helix",url:"users",forceType:"user",userId:K(M),scopes:$?["user:read:email"]:void 0});if(!((X=O.data)===null||X===void 0?void 0:X.length))throw new m("Could not get authenticated user");return new k1(O.data[0],this._client)}async updateAuthenticatedUser(M,$){let X=await this._client.callApi({type:"helix",url:"users",method:"PUT",userId:K(M),scopes:["user:edit"],query:{description:$.description}});return new k1(X.data[0],this._client)}async getBlocks(M,$){let X=await this._client.callApi({type:"helix",url:"users/blocks",userId:K(M),scopes:["user:read:blocked_users"],query:{...H(M),...k($)}});return _(X,NM,this._client)}getBlocksPaginated(M){return new I({url:"users/blocks",userId:K(M),scopes:["user:read:blocked_users"],query:H(M)},this._client,($)=>new NM($,this._client))}async createBlock(M,$,X={}){await this._client.callApi({type:"helix",url:"users/blocks",method:"PUT",userId:K(M),scopes:["user:manage:blocked_users"],query:z9($,X)})}async deleteBlock(M,$){await this._client.callApi({type:"helix",url:"users/blocks",method:"DELETE",userId:K(M),scopes:["user:manage:blocked_users"],query:V9($)})}async getExtensionsForAuthenticatedUser(M,$=!1){return(await this._client.callApi({type:"helix",url:"users/extensions/list",userId:K(M),scopes:$?["channel:manage:extensions"]:["user:read:broadcast","channel:manage:extensions"]})).data.map((O)=>new y4(O))}async getActiveExtensions(M,$=!1){let X=K(M),O=await this._client.callApi({type:"helix",url:"users/extensions",userId:X,scopes:$?["user:read:broadcast","channel:manage:extensions"]:void 0,query:S("user_id",X)});return new E1(O.data)}async updateActiveExtensionsForAuthenticatedUser(M,$){let X=await this._client.callApi({type:"helix",url:"users/extensions",method:"PUT",userId:K(M),scopes:["channel:manage:extensions"],jsonBody:{data:$}});return new E1(X.data)}async _getUsers(M,$){if($.length===0)return[];let X={[M]:$};return(await this._client.callApi({type:"helix",url:"users",query:X})).data.map((J)=>new C0(J,this._client))}};W([G(!1)],CM.prototype,"_getUserByIdBatcher",void 0);W([G(!1)],CM.prototype,"_getUserByNameBatcher",void 0);CM=W([Q("api","HelixUserApi")],CM);var $3=class extends P{constructor(M,$){super(M);this._client=$}get id(){return this[Z].id}get userId(){return this[Z].user_id}get userName(){return this[Z].user_login}get userDisplayName(){return this[Z].user_name}async getUser(){return N(await this._client.users.getUserById(this[Z].user_id))}get title(){return this[Z].title}get description(){return this[Z].description}get creationDate(){return new Date(this[Z].created_at)}get publishDate(){return new Date(this[Z].published_at)}get url(){return this[Z].url}get thumbnailUrl(){return this[Z].thumbnail_url}getThumbnailUrl(M,$){return this[Z].thumbnail_url.replace("%{width}",M.toString()).replace("%{height}",$.toString())}get isPublic(){return this[Z].viewable==="public"}get views(){return this[Z].view_count}get language(){return this[Z].language}get type(){return this[Z].type}get duration(){return this[Z].duration}get durationInSeconds(){let M=this[Z].duration.match(/\d+[hms]/g);if(!M)throw new m(`Could not parse duration string: ${this[Z].duration}`);return M.map(($)=>{let X=/(\d+)([hms])/.exec($);if(!X)throw new m(`Could not parse partial duration string: ${$}`);let[,O,J]=X;return parseInt(O,10)*{h:3600,m:60,s:1}[J]}).reduce(($,X)=>$+X)}get streamId(){return this[Z].stream_id}get mutedSegmentData(){var M,$;return($=(M=this[Z].muted_segments)===null||M===void 0?void 0:M.slice())!==null&&$!==void 0?$:[]}isMutedAt(M,$,X=!1){if(this[Z].muted_segments===null)return!1;if($==null)return this[Z].muted_segments.some((J)=>J.offset<=M&&M<=J.offset+J.duration);let O=M+$;if(X)return this[Z].muted_segments.some((J)=>{let z=J.offset+J.duration;return M<z&&J.offset<O});return this[Z].muted_segments.some((J)=>{let z=J.offset+J.duration;return J.offset<=M&&O<=z})}};W([G(!1)],$3.prototype,"_client",void 0);W([g()],$3.prototype,"durationInSeconds",null);$3=W([W0,Q("api","HelixVideo","id")],$3);var g4,D1=g4=class extends v{constructor(){super(...arguments);this._getVideoByIdBatcher=new c({url:"videos"},"id","id",this._client,(M)=>new $3(M,this._client))}async getVideosByIds(M){return(await this._getVideos("id",M)).data}async getVideoById(M){let $=await this.getVideosByIds([M]);return $.length?$[0]:null}async getVideoByIdBatched(M){return await this._getVideoByIdBatcher.request(M)}async getVideosByUser(M,$={}){let X=K(M);return await this._getVideos("user_id",[X],$)}getVideosByUserPaginated(M,$={}){let X=K(M);return this._getVideosPaginated("user_id",[X],$)}async getVideosByGame(M,$={}){return await this._getVideos("game_id",[M],$)}getVideosByGamePaginated(M,$={}){return this._getVideosPaginated("game_id",[M],$)}async deleteVideosByIds(M,$){await this._client.callApi({type:"helix",url:"videos",method:"DELETE",scopes:["channel:manage:videos"],userId:K(M),query:{id:$}})}async _getVideos(M,$,X={}){if(!$.length)return{data:[]};let O=await this._client.callApi({type:"helix",url:"videos",userId:M==="user_id"?$[0]:void 0,query:{...g4._makeVideosQuery(M,$,X),...k(X)}});return _(O,$3,this._client)}_getVideosPaginated(M,$,X={}){return new I({url:"videos",userId:M==="user_id"?$[0]:void 0,query:g4._makeVideosQuery(M,$,X)},this._client,(O)=>new $3(O,this._client))}static _makeVideosQuery(M,$,X={}){let{language:O,period:J,orderBy:z,type:V}=X;return{[M]:$,language:O,period:J,sort:z,type:V}}};W([G(!1)],D1.prototype,"_getVideoByIdBatcher",void 0);D1=g4=W([Q("api","HelixVideoApi")],D1);function K9(Y,M){return{from_user_id:K(Y),to_user_id:K(M)}}var u4=class extends v{async sendWhisper(M,$,X){await this._client.callApi({type:"helix",url:"whispers",method:"POST",userId:K(M),scopes:["user:manage:whispers"],query:K9(M,$),jsonBody:{message:X}})}};u4=W([Q("api","HelixWhisperApi")],u4);class W${constructor(Y,M,$){this._options=Y,this._httpStatus=M,this._resolvedUserId=$}get options(){return this._options}get httpStatus(){return this._httpStatus}get resolvedUserId(){return this._resolvedUserId}}var u=class extends s{constructor(M,$,X){super();this.onRequest=this.registerEvent(),this._config=M,this._logger=$,this._rateLimiter=X}async requestScopesForUser(M,$){await this._config.authProvider.getAccessTokenForUser(M,...$.map((X)=>[X]))}async getTokenInfo(){try{let M=await this.callApi({type:"auth",url:"validate"});return new K3(M)}catch(M){if(M instanceof r&&M.statusCode===401)throw new a({cause:M});throw M}}async callApi(M){var $;let{authProvider:X}=this._config;if(!(($=M.auth)!==null&&$!==void 0?$:!0))return await p0(M,X.clientId,void 0,void 0,this._config.fetchOptions);let J=!1;if(M.forceType)switch(M.forceType){case"app":{if(!X.getAppAccessToken)throw Error("Tried to make an API call that requires an app access token but your auth provider does not support that");let F=await X.getAppAccessToken();return await this._callApiUsingInitialToken(M,F)}case"user":{J=!0;break}default:throw new m(`Unknown forced token type: ${M.forceType}`)}if(M.scopes)J=!0;if(J){let F=M.canOverrideScopedUserContext?this._getUserIdFromRequestContext(M.userId):M.userId;if(!F)throw Error("Tried to make an API call with a user context but no context user ID");let L=await X.getAccessTokenForUser(F,M.scopes);if(!L)throw Error(`Tried to make an API call with a user context for user ID ${F} but no token was found`);if(B0(L)&&X.refreshAccessTokenForUser){let R=await X.refreshAccessTokenForUser(F);return await this._callApiUsingInitialToken(M,R,!0)}return await this._callApiUsingInitialToken(M,L)}let z=this._getUserIdFromRequestContext(M.userId),V=z===null?await X.getAnyAccessToken():await X.getAnyAccessToken(z!==null&&z!==void 0?z:M.userId);if(B0(V)&&V.userId&&X.refreshAccessTokenForUser){let F=await X.refreshAccessTokenForUser(V.userId);return await this._callApiUsingInitialToken(M,F,!0)}return await this._callApiUsingInitialToken(M,V)}get bits(){return new W4(this)}get channels(){return new X1(this)}get channelPoints(){return new G4(this)}get charity(){return new L4(this)}get chat(){return new B4(this)}get clips(){return new G1(this)}get contentClassificationLabels(){return new R4(this)}get entitlements(){return new L1(this)}get eventSub(){return new N4(this)}get extensions(){return new C4(this)}get games(){return new A3(this)}get hypeTrain(){return new e2(this)}get goals(){return new A4(this)}get moderation(){return new P4(this)}get polls(){return new j4(this)}get predictions(){return new T4(this)}get raids(){return new k4(this)}get schedule(){return new X$(this)}get search(){return new H4(this)}get streams(){return new BM(this)}get subscriptions(){return new w4(this)}get teams(){return new S4(this)}get users(){return new CM(this)}get videos(){return new D1(this)}get whispers(){return new u4(this)}get rateLimiterStats(){if(this._rateLimiter instanceof o0)return this._rateLimiter.stats;return null}get _authProvider(){return this._config.authProvider}get _mockServerPort(){return this._config.mockServerPort}get _batchDelay(){var M;return(M=this._config.batchDelay)!==null&&M!==void 0?M:0}_getUserIdFromRequestContext(M){return M}async _callApiUsingInitialToken(M,$,X=!1){var O;let{authProvider:J}=this._config,{authorizationType:z}=J,V=await this._callApiInternal(M,J.clientId,$.accessToken,z);if(V.status===401&&!X){if($.userId){if(J.refreshAccessTokenForUser){let F=await J.refreshAccessTokenForUser($.userId);V=await this._callApiInternal(M,J.clientId,F.accessToken,z)}}else if(J.getAppAccessToken){let F=await J.getAppAccessToken(!0);V=await this._callApiInternal(M,J.clientId,F.accessToken,z)}}return this.emit(this.onRequest,new W$(M,V.status,(O=$.userId)!==null&&O!==void 0?O:null)),await s3(V,M),await aM(V)}async _callApiInternal(M,$,X,O){var J,z,V;let{fetchOptions:F,mockServerPort:L}=this._config,R=(J=M.type)!==null&&J!==void 0?J:"helix";if(this._logger.debug(`Calling ${R} API: ${(z=M.method)!==null&&z!==void 0?z:"GET"} ${M.url}`),this._logger.trace(`Query: ${JSON.stringify(M.query)}`),M.jsonBody)this._logger.trace(`Request body: ${JSON.stringify(M.jsonBody)}`);let U=Q9.operation({retries:3,minTimeout:500,factor:2}),{promise:q,resolve:f,reject:C}=q0();U.attempt(async()=>{try{let j=R==="helix"?await this._rateLimiter.request({options:M,clientId:$,accessToken:X,authorizationType:O,fetchOptions:F,mockServerPort:L}):await h0(M,$,X,O,F,L);if(!j.ok&&j.status>=500&&j.status<600)await s3(j,M);f(j)}catch(j){if(U.retry(j))return;C(U.mainError())}});let A=await q;return this._logger.debug(`Called ${R} API: ${(V=M.method)!==null&&V!==void 0?V:"GET"} ${M.url} - result: ${A.status}`),A}};W([g()],u.prototype,"bits",null);W([g()],u.prototype,"channels",null);W([g()],u.prototype,"channelPoints",null);W([g()],u.prototype,"charity",null);W([g()],u.prototype,"chat",null);W([g()],u.prototype,"clips",null);W([g()],u.prototype,"contentClassificationLabels",null);W([g()],u.prototype,"entitlements",null);W([g()],u.prototype,"eventSub",null);W([g()],u.prototype,"extensions",null);W([g()],u.prototype,"games",null);W([g()],u.prototype,"hypeTrain",null);W([g()],u.prototype,"goals",null);W([g()],u.prototype,"moderation",null);W([g()],u.prototype,"polls",null);W([g()],u.prototype,"predictions",null);W([g()],u.prototype,"raids",null);W([g()],u.prototype,"schedule",null);W([g()],u.prototype,"search",null);W([g()],u.prototype,"streams",null);W([g()],u.prototype,"subscriptions",null);W([g()],u.prototype,"teams",null);W([g()],u.prototype,"users",null);W([g()],u.prototype,"videos",null);W([g()],u.prototype,"whispers",null);u=W([W0,Q("api","ApiClient")],u);var h4=class extends u{_getUserIdFromRequestContext(){return null}};h4=W([Q("api","ApiClient")],h4);var v1=class extends u{constructor(M,$,X,O){super(M,$,X);this._userId=O}_getUserIdFromRequestContext(){return this._userId}};v1=W([Q("api","ApiClient")],v1);var E3=class extends u{constructor(M){if(!M.authProvider)throw new g2("No auth provider given. Please supply the `authProvider` option.");let $={name:"twurple:api:rate-limiter",...M.logger};super(M,e({name:"twurple:api:client",...M.logger}),c0?new X4({getPartitionKey:(X)=>{var O;return(O=X.userId)!==null&&O!==void 0?O:null},createChild:()=>new u2({logger:$})}):new t3({logger:$,bucketSize:800,timeFrame:64000,doRequest:async({options:X,clientId:O,accessToken:J,authorizationType:z,fetchOptions:V,mockServerPort:F})=>await h0(X,O,J,z,V,F),getPartitionKey:(X)=>{var O;return(O=X.userId)!==null&&O!==void 0?O:null}}))}async asUser(M,$){let X=new v1(this._config,this._logger,this._rateLimiter,K(M));return await $(X)}async asIntent(M,$){if(!this._authProvider.getAccessTokenForIntent)throw Error("Trying to use intents with an auth provider that does not support them");for(let X of M){let O=await this._authProvider.getAccessTokenForIntent(X);if(O){let J=new v1(this._config,this._logger,this._rateLimiter,O.userId);return await $(J)}}throw Error(`Intents [${M.join(", ")}] not found in auth provider`)}async withoutUser(M){let $=new h4(this._config,this._logger,this._rateLimiter);return await M($)}};E3=W([Q("api","ApiClient")],E3);class H1 extends s{constructor({lineBased:Y,logger:M,additionalOptions:$}={}){super();this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=Y!==null&&Y!==void 0?Y:!1,this._logger=M,this._additionalOptions=$}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(Y){if(this._connected)Y=Y.replace(/[\0\r\n]/g,""),this.sendRaw(`${Y}\r
`)}assumeExternalDisconnect(){var Y;(Y=this._logger)===null||Y===void 0||Y.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(Y){var M,$;if(!this._lineBased){this.emit(this.onReceive,Y);return}let X=Y.split(`\r
`);if(this._currentLine+=(M=X.shift())!==null&&M!==void 0?M:"",X.length){this.emit(this.onReceive,this._currentLine),this._currentLine=($=X.pop())!==null&&$!==void 0?$:"";for(let O of X)this.emit(this.onReceive,O)}}}import{Socket as v8}from"net";import*as F9 from"tls";class p4 extends H1{constructor(Y,M){var $;super(M);if(this._socket=null,this._closingOnDemand=!1,this._hadError=!1,!Y.hostName||!Y.port)throw Error("DirectConnection requires hostName and port to be set");this._host=Y.hostName,this._port=Y.port,this._secure=($=Y.secure)!==null&&$!==void 0?$:!0}get hasSocket(){return!!this._socket}sendRaw(Y){var M;(M=this._socket)===null||M===void 0||M.write(Y)}connect(){var Y;if((Y=this._logger)===null||Y===void 0||Y.trace("DirectConnection connect"),this._connecting=!0,this._secure)this._socket=F9.connect(this._port,this._host);else this._socket=new v8,this._socket.connect(this._port,this._host);this._socket.on("connect",()=>{var M;(M=this._logger)===null||M===void 0||M.trace("DirectConnection onConnect"),this._connecting=!1,this._connected=!0,this._closingOnDemand=!1,this._hadError=!1,this.emit(this.onConnect)}),this._socket.on("error",(M)=>{var $;($=this._logger)===null||$===void 0||$.trace(`DirectConnection onError message:${M.message}`),this._connected=!1,this._connecting=!1,this.emit(this.onDisconnect,!1,M),this._hadError=!0}),this._socket.on("data",(M)=>{this.receiveRaw(M.toString())}),this._socket.on("close",()=>{var M;if((M=this._logger)===null||M===void 0||M.trace(`DirectConnection onClose closingOnDemand:${this._closingOnDemand.toString()} hadError:${this._hadError.toString()}`),!this._hadError)this._connected=!1,this._connecting=!1,this.emit(this.onDisconnect,this._closingOnDemand);this._closingOnDemand=!1,this._hadError=!1,this.clearSocket()})}disconnect(){var Y,M;(Y=this._logger)===null||Y===void 0||Y.trace("DirectConnection disconnect"),this._closingOnDemand=!0,(M=this._socket)===null||M===void 0||M.end()}clearSocket(){if(this._socket)this._socket.removeAllListeners("connect"),this._socket.removeAllListeners("error"),this._socket.removeAllListeners("data"),this._socket.removeAllListeners("close"),this._socket=null}}class b4 extends s{constructor(Y,M,$={}){var X;super();this._type=Y,this._target=M,this._config=$,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(X=$.retryLimit)!==null&&X!==void 0?X:1/0,this._logger=$.logger}get isConnected(){var Y,M;return(M=(Y=this._currentConnection)===null||Y===void 0?void 0:Y.isConnected)!==null&&M!==void 0?M:!1}get isConnecting(){var Y,M;return(M=(Y=this._currentConnection)===null||Y===void 0?void 0:Y.isConnecting)!==null&&M!==void 0?M:this._connecting}get hasSocket(){var Y,M;return(M=(Y=this._currentConnection)===null||Y===void 0?void 0:Y.hasSocket)!==null&&M!==void 0?M:!1}sendLine(Y){var M;(M=this._currentConnection)===null||M===void 0||M.sendLine(Y)}connect(){if(this._currentConnection||this._connecting)throw Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var Y;if((Y=this._logger)===null||Y===void 0||Y.trace(`PersistentConnection disconnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){let M=this._currentConnection;this._currentConnection=void 0,M.disconnect()}}assumeExternalDisconnect(){var Y,M;(Y=this._logger)===null||Y===void 0||Y.trace("PersistentConnection assumeExternalDisconnect"),(M=this._currentConnection)===null||M===void 0||M.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){if(this._previousConnection)this._previousConnection.disconnect(),this._previousConnection=void 0}_startTryingToConnect(Y=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(Y)}_tryConnect(Y=!1){var M,$;(M=this._logger)===null||M===void 0||M.trace(`PersistentConnection tryConnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`);let X=Y?this._initialRetryLimit:this._retryLimit;($=this._retryTimerGenerator)!==null&&$!==void 0||(this._retryTimerGenerator=nM(120));let O=this._currentConnection=new this._type(C2(this._target),this._config);O.onReceive((J)=>this.emit(this.onReceive,J)),O.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),O.onDisconnect((J,z)=>{var V,F,L;if(this.emit(this.onDisconnect,J,z),J){if(this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,O.disconnect(),this._currentConnection===O)this._currentConnection=void 0;if(this._previousConnection===O)this._previousConnection=void 0}else if(this._connecting){if((V=this._logger)===null||V===void 0||V.debug(`Connection error caught: ${(F=z===null||z===void 0?void 0:z.message)!==null&&F!==void 0?F:"unknown error"}`),this._connectionRetryCount>=X)return;this._connectionRetryCount++;let R=this._retryTimerGenerator.next().value;if(R!==0)(L=this._logger)===null||L===void 0||L.info(`Retrying in ${R} seconds`);setTimeout(()=>{var U;if(!this._connecting)return;(U=this._logger)===null||U===void 0||U.info(Y?"Retrying connection":"Trying to reconnect"),this._tryConnect()},R*1000)}else this._reconnect()}),O.connect()}_reconnect(Y=!1){if(Y&&this._config.overlapManualReconnect)this._previousConnection=this._currentConnection,this._currentConnection=void 0;else this.disconnect();this._startTryingToConnect(Y)}}import{WebSocket as G9,WebSocketServer as SN}from"ws";class m4 extends H1{constructor(Y,M){super(M);if(this._socket=null,this._closingOnDemand=!1,Y.hostName&&Y.port)this._url=`ws${Y.secure?"s":""}://${Y.hostName}:${Y.port}`;else if(Y.url)this._url=Y.url;else throw Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(Y){var M;(M=this._socket)===null||M===void 0||M.send(Y)}connect(){var Y,M;(Y=this._logger)===null||Y===void 0||Y.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new G9(this._url,(M=this._additionalOptions)===null||M===void 0?void 0:M.wsOptions),this._socket.onopen=()=>{var $;($=this._logger)===null||$===void 0||$.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:$})=>{this.receiveRaw($.toString())},this._socket.onerror=($)=>{var X;(X=this._logger)===null||X===void 0||X.trace(`WebSocketConnection onError message:${$.message}`)},this._socket.onclose=($)=>{var X;let O=this._connected,J=this._connecting;if((X=this._logger)===null||X===void 0||X.trace(`WebSocketConnection onClose wasConnected:${O.toString()} wasConnecting:${J.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${$.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{let z=Error(`[${$.code}] ${$.reason}`);this.emit(this.onDisconnect,!1,z),this.emit(this.onEnd,!1,z)}this.clearSocket()}}disconnect(){var Y,M;(Y=this._logger)===null||Y===void 0||Y.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(M=this._socket)===null||M===void 0||M.close()}clearSocket(){if(this._socket)this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null}}function AM(Y){var M,$,X;if(Array.isArray(Y)){$=Array(M=Y.length);while(M--)$[M]=(X=Y[M])&&typeof X==="object"?AM(X):X;return $}if(Object.prototype.toString.call(Y)==="[object Object]"){$={};for(M in Y)if(M==="__proto__")Object.defineProperty($,M,{value:AM(Y[M]),configurable:!0,enumerable:!0,writable:!0});else $[M]=(X=Y[M])&&typeof X==="object"?AM(X):X;return $}return Y}var d4={};h1(d4,{MultiPrefix:()=>T9,MessageTags:()=>j9,LabeledResponse:()=>f9,InviteNotify:()=>P9,ChgHost:()=>U9,CapNotify:()=>A9,Batch:()=>C9,AwayNotify:()=>L9});var L9={name:"away-notify"};class UM extends Error{constructor(Y,M,$){super(`command "${Y}" expected ${M} or more parameters, got ${$}`);if(this._command=Y,this._expectedParams=M,this._actualParams=$,Object.setPrototypeOf(this,UM.prototype),Error.captureStackTrace)Error.captureStackTrace(this,UM)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class PM extends Error{constructor(Y,M,$,X){var O;super(`required parameter "${M}" did not validate against ${(O=$.type)!==null&&O!==void 0?O:"regex"} validation: "${X}"`);if(this._command=Y,this._paramName=M,this._paramSpec=$,this._givenValue=X,Object.setPrototypeOf(this,PM.prototype),Error.captureStackTrace)Error.captureStackTrace(this,PM)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}var A0={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var R9=b3(q9(),1);function fM(Y,M="#&"){return new RegExp(`^[${R9.default(M)}][^ \b\x00
\r,]+$`).test(Y)}var B9={0:"\x00",n:`
`,r:"\r","\x10":"\x10"};function I1(Y){if(!Y.startsWith("\x01"))return!1;if(Y=Y.substring(1),Y.endsWith("\x01"))Y=Y.slice(0,-1);if(!Y)return!1;Y=Y.replace(/\x10(.)/,(X,O)=>(O in B9)?B9[O]:"");let[M,$=""]=J0(Y," ",2);return M=M?M.toUpperCase():"",{command:M,params:$}}var H8={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function I8(Y){return Y.replace(/[\\;\n\r ]/g,(M)=>`\\${H8[M]}`)}function N9(Y){let M=`${Y.nick}`;if(Y.user)M+=`!${Y.user}`;if(Y.host)M+=`@${Y.host}`;return M}function z$(Y,M,$,X,O=A0,J=!1){let z=new Y(Y.COMMAND,void 0,{serverProperties:O}),V={};if(z._paramSpec)i3(z._paramSpec,(F,L)=>{if(J&&F.noServer)return;if(!J&&F.noClient)return;if(L in M){let R=M[L];if(R!==void 0){if(Y.checkParam(R,F,O))V[L]={value:R,trailing:Boolean(F.trailing)};else if(!F.optional)throw Error(`required parameter "${L}" did not suit requirements: "${R}"`)}}if(!(L in V)&&!F.optional)throw Error(`required parameter "${L}" not found in command "${Y.COMMAND}"`)});if(z._parsedParams=V,z._paramSpec)for(let F of Object.keys(z._paramSpec))Object.defineProperty(z,F,{get(){var L,R;return(R=(L=this._parsedParams)===null||L===void 0?void 0:L[F])===null||R===void 0?void 0:R.value}});return z._initPrefixAndTags($,X),z}class B{static checkParam(Y,M,$=A0){if(M.type==="channel"){if(!fM(Y,$.channelTypes))return!1}if(M.type==="channelList"){if(!Y.split(",").every((O)=>fM(O,$.channelTypes)))return!1}if(M.match){if(!M.match.test(Y))return!1}return!0}constructor(Y,{params:M,tags:$,prefix:X,rawLine:O}={},{serverProperties:J=A0,isServer:z=!1,shouldParseParams:V=!0}={},F){if(this._params=[],this._serverProperties=A0,this._paramSpec=F,this._command=Y,this._params=M,this._tags=$!==null&&$!==void 0?$:new Map,this._prefix=X,this._serverProperties=J,this._raw=O,V)this.parseParams(z)}getMinParamCount(Y=!1){if(!this._paramSpec)return 0;return Object.values(this._paramSpec).filter((M)=>{if(M.noServer&&Y)return!1;if(M.noClient&&!Y)return!1;return!M.optional}).length}get paramCount(){var Y,M;return(M=(Y=this._params)===null||Y===void 0?void 0:Y.length)!==null&&M!==void 0?M:0}prefixToString(){if(!this._prefix)return"";return N9(this._prefix)}tagsToString(){return[...this._tags.entries()].map(([Y,M])=>M?`${Y}=${I8(M)}`:Y).join(";")}toString(Y=!1,M=!1){let X=[M?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(Y){let J=this.prefixToString();if(J)X.unshift(`:${J}`)}let O=this.tagsToString();if(O)X.unshift(`@${O}`);return X.join(" ")}_initPrefixAndTags(Y,M){if(this._prefix=Y,M)this._tags=M}parseParams(Y=!1){if(this._params){let M=this.getMinParamCount(Y);if(M>this._params.length)throw new UM(this._command,M,this._params.length);let $=this._paramSpec;if(!$)return;let X=0,O={};for(let[J,z]of Object.entries($)){if(z.noServer&&Y)continue;if(z.noClient&&!Y)continue;if(this._params.length-X<=M){if(z.optional)continue;else if(this._params.length-X!==M)throw Error("not enough parameters left for required parameters parsing (this is a library bug)")}let V=this._params[X];if(!V){if(z.optional)break;throw Error("unexpected parameter underflow")}if(z.rest){let F=[];while(this._params[X]&&!this._params[X].trailing)F.push(this._params[X].value),++X;if(!F.length){if(z.optional)continue;throw Error(`no parameters left for required rest parameter "${J}"`)}V={value:F.join(" "),trailing:!1}}if(B.checkParam(V.value,z)){if(O[J]={...V},!z.optional)--M;if(!z.rest)++X}else if(!z.optional)throw new PM(this._command,J,z,V.value);if(z.trailing)break}if(this._parsedParams=O,this._paramSpec)for(let J of Object.keys(this._paramSpec))Object.defineProperty(this,J,{get(){var z,V;return(V=(z=this._parsedParams)===null||z===void 0?void 0:z[J])===null||V===void 0?void 0:V.value}})}}get rawParamValues(){var Y,M;return(M=(Y=this._params)===null||Y===void 0?void 0:Y.map(($)=>$.value))!==null&&M!==void 0?M:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(Y){return!1}endsResponseTo(Y){return!1}_acceptsInReplyCollection(Y){return Y.isResponseTo(this)}_buildCommandFromNamedParams(){let Y=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...Y.map((M)=>{var $;let X=($=this._parsedParams)===null||$===void 0?void 0:$[M];if(X)return(X.trailing?":":"")+X.value;return}).filter((M)=>M!==void 0)].join(" ")}_buildCommandFromRawParams(){var Y,M;return[this._command,...(M=(Y=this._params)===null||Y===void 0?void 0:Y.map(($)=>`${$.trailing?":":""}${$.value}`))!==null&&M!==void 0?M:[]].join(" ")}}B.COMMAND="";B.SUPPORTS_CAPTURE=!1;class x1 extends B{constructor(Y,M,$){super(Y,M,$,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}x1.COMMAND="BATCH";var C9={name:"batch",messageTypes:[x1],usesTags:!0};var A9={name:"cap-notify"};class _1 extends B{constructor(Y,M,$){super(Y,M,$,{newUser:{},newHost:{}})}}_1.COMMAND="CHGHOST";var U9={name:"chghost",messageTypes:[_1]};var P9={name:"invite-notify"};class w1 extends B{}w1.COMMAND="ACK";var f9={name:"labeled-response",messageTypes:[w1],usesTags:!0};var j9={name:"message-tags",usesTags:!0};var T9={name:"multi-prefix"};class V${constructor(Y,M,...$){this._client=Y,this._originalMessage=M,this._messages=[],this._endEventHandlers=new Map,this._types=new Set($)}untilEvent(Y){this._cleanEndEventHandler(Y);let M=this._client.on(Y,()=>this.end());this._endEventHandlers.set(Y,M)}async promise(){return this._promise||(this._promise=new Promise((Y)=>{this._promiseResolve=Y})),await this._promise}collect(Y){if(!this._originalMessage._acceptsInReplyCollection(Y))return!1;if(this._messages.push(Y),Y.endsResponseTo(this._originalMessage))this.end();return!0}end(){if(this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve)this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach((Y)=>{this._client.removeListener(Y)}),this._endEventHandlers.clear()}_cleanEndEventHandler(Y){if(this._endEventHandlers.has(Y))this._client.removeListener(this._endEventHandlers.get(Y)),this._endEventHandlers.delete(Y)}}var U0={};h1(U0,{all:()=>K$,Numerics:()=>yM,Commands:()=>vM});var vM={};h1(vM,{WhoWasQuery:()=>M7,WhoQuery:()=>X3,WhoIsQuery:()=>e4,Wallops:()=>J7,UserRegistration:()=>TM,UserHostQuery:()=>W7,Topic:()=>o4,Time:()=>a4,TagMessage:()=>V7,ServerQuit:()=>n4,Restart:()=>O7,Rehash:()=>Z7,PrivateMessage:()=>v3,Pong:()=>I3,Ping:()=>H3,Password:()=>jM,OperLogin:()=>i4,Notice:()=>DM,NickChange:()=>Y3,Names:()=>D0,Mode:()=>l4,Kill:()=>$7,IsOnQuery:()=>z7,ErrorMessage:()=>Y7,ClientQuit:()=>EM,ChannelPart:()=>D3,ChannelList:()=>s4,ChannelKick:()=>t4,ChannelJoin:()=>k3,ChannelInvite:()=>r4,CapabilityNegotiation:()=>t,Away:()=>X7});class jM extends B{constructor(Y,M,$){super(Y,M,$,{password:{}})}}jM.COMMAND="PASS";class Y3 extends B{constructor(Y,M,$){super(Y,M,$,{nick:{}})}}Y3.COMMAND="NICK";class TM extends B{constructor(Y,M,$){super(Y,M,$,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}TM.COMMAND="USER";class i4 extends B{constructor(Y,M,$){super(Y,M,$,{name:{},password:{}})}}i4.COMMAND="OPER";class EM extends B{constructor(Y,M,$){super(Y,M,$,{text:{trailing:!0,optional:!0}})}}EM.COMMAND="QUIT";class n4 extends B{constructor(Y,M,$){super(Y,M,$,{server:{},reason:{trailing:!0}})}}n4.COMMAND="SQUIT";class k3 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},key:{optional:!0}})}}k3.COMMAND="JOIN";class D3 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}D3.COMMAND="PART";class kM extends Error{constructor(Y){super(`Unknown channel mode character ${Y}`);if(this._char=Y,Object.setPrototypeOf(this,kM.prototype),Error.captureStackTrace)Error.captureStackTrace(this,kM)}get char(){return this._char}}class l4 extends B{constructor(Y,M,$){super(Y,M,$,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return fM(this.target,this._serverProperties.channelTypes)}separate(){let Y=[],M=this.modes;if(!M)throw Error("can't separate a channel mode request, just set actions");let $=M.split(" "),X=$.shift(),O="add";for(let J of X){let z=O;switch(J){case"+":{O="add";break}case"-":{O="remove";break}default:{let V=!1,F=!0;if(this.isChannel)if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(J)||this._serverProperties.supportedChannelModes.prefix.includes(J))V=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(J)){if(O==="add")V=!0}else if(this._serverProperties.supportedChannelModes.list.includes(J))if($.length)V=!0;else z="getList";else if(this._serverProperties.supportedChannelModes.noParam.includes(J));else throw new kM(J);else F=this._serverProperties.supportedUserModes.includes(J);if(V&&!$.length)continue;Y.push({prefix:this._prefix,action:z,letter:J,param:V?$.shift():void 0,known:F})}}}return Y}}l4.COMMAND="MODE";class o4 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}o4.COMMAND="TOPIC";class D0 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channelList",optional:!0}})}}D0.COMMAND="NAMES";D0.SUPPORTS_CAPTURE=!0;class s4 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{optional:!0},server:{optional:!0}})}}s4.COMMAND="LIST";class r4 extends B{constructor(Y,M,$){super(Y,M,$,{target:{},channel:{type:"channel"}})}}r4.COMMAND="INVITE";class t4 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}t4.COMMAND="KICK";class a4 extends B{constructor(Y,M,$){super(Y,M,$,{server:{optional:!0}})}}a4.COMMAND="TIME";class v3 extends B{constructor(Y,M,$){super(Y,M,$,{target:{},text:{trailing:!0}})}}v3.COMMAND="PRIVMSG";class DM extends B{constructor(Y,M,$){super(Y,M,$,{target:{},text:{trailing:!0}})}}DM.COMMAND="NOTICE";class X3 extends B{constructor(Y,M,$){super(Y,M,$,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}X3.COMMAND="WHO";class e4 extends B{constructor(Y,M,$){super(Y,M,$,{server:{optional:!0},nickMask:{}})}}e4.COMMAND="WHOIS";class M7 extends B{constructor(Y,M,$){super(Y,M,$,{nick:{},count:{optional:!0},server:{optional:!0}})}}M7.COMMAND="WHOWAS";class $7 extends B{constructor(Y,M,$){super(Y,M,$,{target:{},reason:{trailing:!0,optional:!0}})}}$7.COMMAND="KILL";class H3 extends B{constructor(Y,M,$){super(Y,M,$,{text:{trailing:!0}})}}H3.COMMAND="PING";class I3 extends B{constructor(Y,M,$){super(Y,M,$,{server:{noClient:!0},text:{trailing:!0}})}}I3.COMMAND="PONG";class Y7 extends B{constructor(Y,M,$){super(Y,M,$,{text:{trailing:!0}})}}Y7.COMMAND="ERROR";class X7 extends B{constructor(Y,M,$){super(Y,M,$,{text:{trailing:!0,optional:!0}})}}X7.COMMAND="AWAY";class Z7 extends B{}Z7.COMMAND="REHASH";class O7 extends B{}O7.COMMAND="RESTART";class J7 extends B{constructor(Y,M,$){super(Y,M,$,{text:{trailing:!0}})}}J7.COMMAND="WALLOPS";class W7 extends B{constructor(Y,M,$){super(Y,M,$,{nicks:{rest:!0}})}}W7.COMMAND="USERHOST";class z7 extends B{constructor(Y,M,$){super(Y,M,$,{nicks:{rest:!0}})}}z7.COMMAND="ISON";class t extends B{constructor(Y,M,$){super(Y,M,$,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(Y){if(!(Y instanceof t))return!1;switch(this.subCommand){case"ACK":case"NAK":return Y.subCommand==="REQ"&&Y.capabilities===this.capabilities.trim();case"LS":case"LIST":return Y.subCommand===this.subCommand;default:return!1}}endsResponseTo(Y){if(!(Y instanceof t))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}t.COMMAND="CAP";t.SUPPORTS_CAPTURE=!0;class V7 extends B{constructor(Y,M,$){super(Y,M,$,{target:{}})}}V7.COMMAND="TAGMSG";var yM={};h1(yM,{Reply391Time:()=>u7,Reply381YoureOper:()=>g7,Reply376EndOfMotd:()=>_M,Reply375MotdStart:()=>y7,Reply372Motd:()=>S7,Reply368EndOfBanList:()=>w7,Reply367BanList:()=>_7,Reply366EndOfNames:()=>x7,Reply353NamesReply:()=>I7,Reply352WhoReply:()=>H7,Reply349EndOfExceptList:()=>v7,Reply348ExceptList:()=>D7,Reply341Inviting:()=>k7,Reply333TopicWhoTime:()=>E7,Reply332Topic:()=>T7,Reply331NoTopic:()=>j7,Reply324ChannelModeIs:()=>f7,Reply323ListEnd:()=>P7,Reply322List:()=>U7,Reply319WhoisChannels:()=>A7,Reply318EndOfWhois:()=>C7,Reply315EndOfWho:()=>N7,Reply311WhoisUser:()=>R7,Reply306NowAway:()=>B7,Reply305UnAway:()=>q7,Reply302UserHost:()=>L7,Reply301Away:()=>G7,Reply221UmodeIs:()=>F7,Reply005Isupport:()=>xM,Reply004ServerInfo:()=>IM,Reply003Created:()=>Q7,Reply002YourHost:()=>K7,Reply001Welcome:()=>HM,Error502UsersDontMatch:()=>Q2,Error501UmodeUnknownFlag:()=>K2,Error491NoOperHost:()=>V2,Error482ChanOpPrivsNeeded:()=>z2,Error481NoPrivileges:()=>W2,Error479BadChanName:()=>J2,Error475BadChannelKey:()=>O2,Error474BannedFromChan:()=>Z2,Error473InviteOnlyChan:()=>X2,Error472UnknownMode:()=>Y2,Error471ChannelIsFull:()=>$2,Error462AlreadyRegistered:()=>SM,Error461NeedMoreParams:()=>M2,Error451NotRegistered:()=>e7,Error443UserOnChannel:()=>a7,Error442NotOnChannel:()=>t7,Error441UserNotInChannel:()=>r7,Error436NickCollision:()=>s7,Error433NickNameInUse:()=>o7,Error432ErroneusNickname:()=>l7,Error431NoNickNameGiven:()=>n7,Error422NoMotd:()=>wM,Error421UnknownCommand:()=>i7,Error410InvalidCapCmd:()=>d7,Error405TooManyChannels:()=>c7,Error404CanNotSendToChan:()=>m7,Error403NoSuchChannel:()=>b7,Error402NoSuchServer:()=>p7,Error401NoSuchNick:()=>h7});class HM extends B{constructor(Y,M,$){super(Y,M,$,{me:{},welcomeText:{trailing:!0}})}}HM.COMMAND="001";class K7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},yourHost:{trailing:!0}})}}K7.COMMAND="002";class Q7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},createdText:{trailing:!0}})}}Q7.COMMAND="003";class IM extends B{constructor(Y,M,$){super(Y,M,$,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}IM.COMMAND="004";class xM extends B{constructor(Y,M,$){super(Y,M,$,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}xM.COMMAND="005";class F7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},modes:{}})}}F7.COMMAND="221";class G7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},text:{trailing:!0}})}}G7.COMMAND="301";class L7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},hosts:{trailing:!0}})}}L7.COMMAND="302";class q7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}q7.COMMAND="305";class B7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}B7.COMMAND="306";class R7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}R7.COMMAND="311";class N7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y instanceof X3}endsResponseTo(){return!0}}N7.COMMAND="315";class C7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nickMask:{},suffix:{trailing:!0}})}}C7.COMMAND="318";class A7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},channels:{trailing:!0}})}}A7.COMMAND="319";class U7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}U7.COMMAND="322";class P7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}P7.COMMAND="323";class f7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}f7.COMMAND="324";class j7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}j7.COMMAND="331";class T7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}T7.COMMAND="332";class E7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},who:{},ts:{}})}}E7.COMMAND="333";class k7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},channel:{type:"channel"}})}}k7.COMMAND="341";class D7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}D7.COMMAND="348";class v7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}v7.COMMAND="349";class H7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(Y){return Y instanceof X3}}H7.COMMAND="352";class I7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(Y){return Y instanceof D0}}I7.COMMAND="353";class x7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y instanceof D0}endsResponseTo(){return!0}}x7.COMMAND="366";class _7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}_7.COMMAND="367";class w7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}w7.COMMAND="368";class S7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},line:{trailing:!0}})}}S7.COMMAND="372";class y7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},line:{trailing:!0}})}}y7.COMMAND="375";class _M extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}_M.COMMAND="376";class g7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}g7.COMMAND="381";class u7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}u7.COMMAND="391";class h7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},suffix:{trailing:!0}})}}h7.COMMAND="401";class p7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},server:{},suffix:{trailing:!0}})}}p7.COMMAND="402";class b7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{},suffix:{trailing:!0}})}}b7.COMMAND="403";class m7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}m7.COMMAND="404";class c7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}c7.COMMAND="405";class d7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},subCommand:{},suffix:{trailing:!0}})}}d7.COMMAND="410";class i7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command===this.originalCommand}endsResponseTo(){return!0}}i7.COMMAND="421";class wM extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}wM.COMMAND="422";class n7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}n7.COMMAND="431";class l7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}l7.COMMAND="432";class o7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}o7.COMMAND="433";class s7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}s7.COMMAND="436";class r7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}r7.COMMAND="441";class t7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}t7.COMMAND="442";class a7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(Y){return Y.command==="NICK"}endsResponseTo(){return!0}}a7.COMMAND="443";class e7 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}e7.COMMAND="451";class M2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},originalCommand:{},suffix:{trailing:!0}})}}M2.COMMAND="461";class SM extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}SM.COMMAND="462";class $2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}$2.COMMAND="471";class Y2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},char:{},suffix:{trailing:!0}})}}Y2.COMMAND="472";class X2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}X2.COMMAND="473";class Z2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Z2.COMMAND="474";class O2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}O2.COMMAND="475";class J2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{},suffix:{trailing:!0}})}}J2.COMMAND="479";class W2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}W2.COMMAND="481";class z2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},channel:{},suffix:{trailing:!0}})}}z2.COMMAND="482";class V2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}V2.COMMAND="491";class K2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}K2.COMMAND="501";class Q2 extends B{constructor(Y,M,$){super(Y,M,$,{me:{},suffix:{trailing:!0}})}}Q2.COMMAND="502";var K$=new Map([...Object.values(vM),...Object.values(yM)].map((Y)=>[Y.COMMAND,Y]));function k9(Y){let[M,$]=J0(Y,"!",2);if($){let[X,O]=J0($,"@",2);if(O)return{nick:M,user:X,host:O};return{nick:M,host:X}}return{nick:M}}var E9={":":";",n:`
`,r:"\r",s:" "};function D9(Y){let M=new Map,$=Y.split(";");for(let X of $){let[O,J]=J0(X,"=",2);if(O==="")continue;M.set(O,J?J.replace(/\\(.?)/g,(z,V)=>Object.prototype.hasOwnProperty.call(E9,V)?E9[V]:V):"")}return M}function F2(Y,M=A0,$=K$,X=!1,O=[],J=!0){let z=Y.split(" "),V,F,L=[],R=void 0,U;while(z.length){if([V]=z,V.startsWith("@")&&!R&&!F&&!U)R=D9(V.slice(1));else if(V.startsWith(":"))if(!U&&!F){if(V.length>1)U=k9(V.slice(1))}else{L.push({value:z.join(" ").slice(1),trailing:!0});break}else if(F)L.push({value:V,trailing:!1});else F=V.toUpperCase();z.shift()}if(R||(R=new Map),!F)throw Error(`line without command received: ${Y}`);J&&(J=!O.includes(F));let q=B;if($.has(F))q=$.get(F);return new q(F,{params:L,tags:R,prefix:U,rawLine:Y},{serverProperties:M,isServer:X,shouldParseParams:J})}class S1 extends s{constructor(Y){super();this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=AM(A0),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;let{connection:M,credentials:$,channels:X,channelTypes:O,webSocket:J,logger:z={}}=Y;this._options=Y;let{pingOnInactivity:V=60,pingTimeout:F=10}=M;this._pingOnInactivity=V,this._pingTimeout=F,this._currentNick=$.nick,this._logger=e({name:"ircv3",emoji:!0,...z}),this.registerCoreMessageTypes();let{hostName:L,secure:R,reconnect:U=!0}=M,q={hostName:L,port:this.port,secure:R},f={lineBased:!0,logger:this._logger,additionalOptions:Y.connectionOptions},C=J?m4:p4;if(U)this._connection=new b4(C,q,f);else this._connection=new C(f,this._logger,Y.connectionOptions);for(let A of Object.values(d4))this.addCapability(A);if(this.addInternalListener(this.onRegister,async()=>{let A=this._hasRegisteredBefore,j=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;let w=A&&this._options.rejoinChannelsOnReconnect?j:await d3(X);if(w)for(let D of w)this.join(D)}),this.onTypedMessage(t,async({subCommand:A,capabilities:j})=>{let w=j.split(" ");switch(A.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${w.join(", ")}`);let D=g0(w,(y)=>{if(!y)return{};let[n,$0]=J0(y,"=",2);return{[n]:{name:n,param:$0||!0}}});for(let[y,n]of Object.entries(D))this._serverCapabilities.set(y,n);let h=Object.keys(D);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([y])=>h.includes(y)).map(([,y])=>y));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${w.join(", ")}`);for(let D of w)this._serverCapabilities.delete(D),this._negotiatedCapabilities.delete(D)}}}),this.onTypedMessage(H3,({text:A})=>{this.sendMessage(I3,{text:A})}),this.onTypedMessage(HM,({me:A})=>this._handleReceivedClientNick(A)),this.onTypedMessage(IM,({userModes:A})=>{if(A)this._serverProperties.supportedUserModes=A}),this.onTypedMessage(xM,({supports:A})=>{let j=g0(A.split(" "),(w)=>{let[D,h]=J0(w,"=",2);return{[D]:h||!0}});this._supportedFeatures={...this._supportedFeatures,...j}}),this.onTypedMessage(_M,({me:A})=>{if(!this._registered)this._handleReceivedClientNick(A),this._registered=!0,this.emit(this.onRegister)}),this.onTypedMessage(wM,({me:A})=>{if(!this._registered)this._handleReceivedClientNick(A),this._registered=!0,this.emit(this.onRegister)}),this.onTypedMessage(SM,({me:A})=>{if(!this._registered)this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(A),this._registered=!0,this.emit(this.onRegister)}),this.onTypedMessage(v3,(A)=>{var j;let{target:w,text:D}=A,h=I1(D),y=(j=A.prefix)===null||j===void 0?void 0:j.nick;if(h)if(h.command==="ACTION")this.emit(this.onAction,w,y,h.params,A);else this.emit(this.onCtcp,w,y,h.command,h.params,A);else this.emit(this.onPrivmsg,w,y,D,A)}),this.onTypedMessage(Y3,(A)=>{var j;let{nick:w}=A,D=(j=A.prefix)===null||j===void 0?void 0:j.nick;if(D===this._currentNick)this._currentNick=w;this.emit(this.onNickChange,D,w,A)}),this.onTypedMessage(DM,(A)=>{var j;let{target:w,text:D}=A,h=I1(D),y=(j=A.prefix)===null||j===void 0?void 0:j.nick;if(h)this.emit(this.onCtcpReply,w,y,h.command,h.params,A);this.emit(this.onNotice,w,y,D,A)}),!this._options.manuallyAcknowledgeJoins)this.onTypedMessage(k3,({channel:A,prefix:j})=>{if((j===null||j===void 0?void 0:j.nick)===this._currentNick)this.acknowledgeJoin(A)});if(this.onTypedMessage(D3,(A)=>{var j;if(((j=A.prefix)===null||j===void 0?void 0:j.nick)===this._currentNick)this._currentChannels.delete(A.channel),this._channelsFromLastRegister.delete(A.channel)}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=$.nick,this._userName=$.userName,this._realName=$.realName,O)this._serverProperties.channelTypes=O}receiveLine(Y){var M;this._logger.debug(`Received message: ${Y}`);let $;try{$=F2(Y,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(X){this._logger.error(`Error parsing message: ${X.message}`),this._logger.trace((M=X.stack)!==null&&M!==void 0?M:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify($)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,$),this._handleEvents($)}get serverProperties(){return AM(this._serverProperties)}get port(){let{webSocket:Y,connection:{port:M,secure:$}}=this._options;if(M)return M;if(Y)return $?443:80;return $?6697:6667}pingCheck(){let Y=Date.now(),M=Y.toString(),$=this.onTypedMessage(I3,(X)=>{let{text:O}=X;if(O===M){if(this._logger.debug(`Current ping: ${Date.now()-Y}ms`),this._pingTimeoutTimer)clearTimeout(this._pingTimeoutTimer);this.removeMessageListener($)}});this._pingTimeoutTimer=setTimeout(()=>{if(this.removeMessageListener($),this._options.connection.reconnect===!1)this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`);else this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`);this._connection.assumeExternalDisconnect()},this._pingTimeout*1000),this.sendMessage(H3,{text:M})}reconnect(Y){this.quit(Y),this.connect()}registerMessageType(Y){if(Y.COMMAND!=="")this._logger.trace(`Registering message type ${Y.COMMAND}`),this._registeredMessageTypes.set(Y.COMMAND.toUpperCase(),Y)}knowsCommand(Y){return this._registeredMessageTypes.has(Y.toUpperCase())}getCommandClass(Y){return this._registeredMessageTypes.get(Y.toUpperCase())}acknowledgeJoin(Y){this._currentChannels.add(Y),this._channelsFromLastRegister.add(Y)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(Y){if(this._clientCapabilities.set(Y.name,Y),Y.messageTypes)for(let M of Object.values(Y.messageTypes))this.registerMessageType(M)}async registerCapability(Y){if(this.addCapability(Y),this._serverCapabilities.has(Y.name))return await this._negotiateCapabilities([Y]);return[]}send(Y){this.sendRaw(Y.toString())}sendRaw(Y){if(this._connection.isConnected)this._logger.debug(`Sending message: ${Y}`),this._connection.sendLine(Y)}onNamedMessage(Y,M,$){if(!this._events.has(Y))this._events.set(Y,new Map);let X=this._events.get(Y);if(!$)do $=`${Y}:${P2(Math.random()*1e4,4,"0")}`;while(X.has($));return X.set($,M),$}onTypedMessage(Y,M,$){return this.onNamedMessage(Y.COMMAND,M,$)}removeMessageListener(Y){let[M]=Y.split(":");if(!this._events.has(M))return;this._events.get(M).delete(Y)}createMessage(Y,M,$){let X=$?new Map(Object.entries($)):void 0;return z$(Y,M,void 0,X,this.serverProperties)}sendMessage(Y,M,$){this.send(this.createMessage(Y,M,$))}async sendMessageAndCaptureReply(Y,M){if(!Y.SUPPORTS_CAPTURE)throw Error(`The command "${Y.COMMAND}" does not support reply capture`);let $=this.createMessage(Y,M),X=this.collect($).promise();return this.send($),await X}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(Y,...M){let $=new V$(this,Y,...M);return this._collectors.push($),$}stopCollect(Y){this._collectors.splice(this._collectors.findIndex((M)=>M===Y),1)}join(Y,M){this.sendMessage(k3,{channel:Y,key:M})}part(Y){this.sendMessage(D3,{channel:Y})}quit(Y){this.sendMessage(EM,{text:Y}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(Y,M,$={}){this.sendMessage(v3,{target:Y,text:M},$)}sendCtcp(Y,M,$){this.say(Y,`\x01${M.toUpperCase()} ${$}\x01`)}action(Y,M){this.sendCtcp(Y,"ACTION",M)}changeNick(Y){if(this._currentNick===Y)return;if(this._desiredNick=Y,this.isRegistered)this.sendMessage(Y3,{nick:Y})}registerCoreMessageTypes(){i3(vM,(Y)=>{this.registerMessageType(Y)}),i3(yM,(Y)=>{this.registerMessageType(Y)})}async _negotiateCapabilityBatch(Y){return await Promise.all(Y.filter((M)=>M.length).map(async(M)=>await this._negotiateCapabilities(M)))}async _negotiateCapabilities(Y){let M=g0(Y,(J)=>({[J.name]:J})),X=(await this.sendMessageAndCaptureReply(t,{subCommand:"REQ",capabilities:Y.map((J)=>J.name).join(" ")})).shift();if(!X)throw Error("capability negotiation failed unexpectedly without any reply");if(!(X instanceof t))throw Error(`capability negotiation failed unexpectedly with "${X.command}" command`);let O=X.capabilities.split(" ").filter((J)=>J);if(X.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${O.join(", ")}`);let J=O.map((z)=>M[z]);for(let z of J){let V=this._clientCapabilities.get(z.name);V.param=z.param,this._negotiatedCapabilities.set(V.name,V)}return J}return this._logger.warn(`Failed to negotiate capabilities: ${O.join(", ")}`),Error("capabilities failed to negotiate")}_setupConnection(){if(this._initialConnectionSetupDone)return;this._connection.onConnect(async()=>{var Y,M;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{let[$]=await Promise.all([d3(this._options.credentials.password),this.sendMessageAndCaptureReply(t,{subCommand:"LS",version:"302"}).then(async(X)=>{if(!X.length||!(X[0]instanceof t))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;let O=X.map((z)=>g0(z.capabilities.split(" "),(V)=>{if(!V)return{};let[F,L]=J0(V,"=",2);return{[F]:{name:F,param:L||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...O))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);let J=O.map((z)=>{let V=Object.keys(z);return Array.from(this._clientCapabilities.entries()).filter(([F])=>V.includes(F)).map(([,F])=>F)});return await this._negotiateCapabilityBatch(J)}).then(()=>{this.sendMessage(t,{subCommand:"END"})})]);if($)this.sendMessage(jM,{password:$});this.sendMessage(Y3,{nick:this._desiredNick}),this.sendMessage(TM,{user:(Y=this._userName)!==null&&Y!==void 0?Y:this._desiredNick,mode:"8",unused:"*",realName:(M=this._realName)!==null&&M!==void 0?M:this._desiredNick})}catch($){this.emit(this.onPasswordError,$),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive((Y)=>{this.receiveLine(Y)}),this._connection.onDisconnect((Y,M)=>{var $;if(this._registered=!1,this._pingCheckTimer)clearTimeout(this._pingCheckTimer);if(this._pingTimeoutTimer)clearTimeout(this._pingTimeoutTimer);if(Y)this._logger.info("Disconnected");else{let X=($=this._options.connection.reconnect)!==null&&$!==void 0?$:!0,O=M?`Disconnected unexpectedly: ${M.message}`:"Disconnected unexpectedly";if(X)this._logger.warn(`${O}; trying to reconnect`);else this._logger.error(O)}this.emit(this.onDisconnect,Y,M)}),this._connection.onEnd((Y)=>{if(!Y)this._logger.warn("No further retries will be made")})}_handleReceivedClientNick(Y){if(this._currentNick!==Y){if(this._currentNick!=="")this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${Y}`);this._currentNick=Y}}_handleEvents(Y){this._collectors.some(($)=>$.collect(Y));let M=this._events.get(Y.constructor.COMMAND);if(!M)return;for(let $ of M.values())$(Y)}_startPingCheckTimer(){if(this._pingCheckTimer)clearTimeout(this._pingCheckTimer);if(this._connection.isConnected)this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1000);else this._pingCheckTimer=void 0}}W([G(!1)],S1.prototype,"_options",void 0);class gM extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){let Y=this._tags.get("tmi-sent-ts");return new Date(Number(Y))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var Y;return(Y=this._tags.get("target-user-id"))!==null&&Y!==void 0?Y:null}}gM.COMMAND="CLEARCHAT";class G2 extends B{}G2.COMMAND="RECONNECT";class uM extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"}})}}uM.COMMAND="ROOMSTATE";var L2,F0=L2=class{constructor(M,$){this._userName=M.toLowerCase(),this._userData=$?new Map($):new Map}static _parseBadgesLike(M){if(!M)return new Map;return new Map(M.split(",").map(($)=>{let X=$.indexOf("/");if(X===-1)return[$,""];return[$.slice(0,X),$.slice(X+1)]}))}get userName(){return this._userName}get displayName(){var M;return(M=this._userData.get("display-name"))!==null&&M!==void 0?M:this._userName}get color(){return this._userData.get("color")}get badges(){let M=this._userData.get("badges");return L2._parseBadgesLike(M)}get badgeInfo(){let M=this._userData.get("badge-info");return L2._parseBadgesLike(M)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){let M=this._userData.get("vip");return M!=null&&M!=="0"}get isArtist(){return this.badges.has("artist-badge")}};W([G(!1)],F0.prototype,"_userData",void 0);W([g()],F0.prototype,"badges",null);W([g()],F0.prototype,"badgeInfo",null);F0=L2=W([W0,Q("chat","ChatUser","userId")],F0);function hM(Y){if(!Y)return new Map;return new Map(Y.split("/").map((M)=>{let[$,X]=M.split(":",2);if(!X)return null;return[$,X.split(",")]}).filter((M)=>M!==null))}class pM extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){let Y=this._tags.get("tmi-sent-ts");return new Date(Number(Y))}get userInfo(){return new F0(this._tags.get("login"),this._tags)}get channelId(){var Y;return(Y=this._tags.get("room-id"))!==null&&Y!==void 0?Y:null}get emoteOffsets(){return hM(this._tags.get("emotes"))}}pM.COMMAND="USERNOTICE";class q2 extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"}})}}q2.COMMAND="USERSTATE";class bM extends B{constructor(Y,M,$){super(Y,M,$,{target:{},text:{trailing:!0}})}get userInfo(){return new F0(this._prefix.nick,this._tags)}get emoteOffsets(){return hM(this._tags.get("emotes"))}}bM.COMMAND="WHISPER";var v9={name:"twitch.tv/commands",messageTypes:[gM,G2,uM,pM,q2,bM]};var H9={name:"twitch.tv/membership"};class mM extends B{constructor(Y,M,$){super(Y,M,$,{channel:{type:"channel"},text:{trailing:!0}})}get date(){let Y=this._tags.get("tmi-sent-ts");return new Date(Number(Y))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}mM.COMMAND="CLEARMSG";class B2 extends B{}B2.COMMAND="GLOBALUSERSTATE";var I9={name:"twitch.tv/tags",messageTypes:[B2,mM]};var x8=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"],cM=class extends U0.Commands.PrivateMessage{get id(){return this._tags.get("id")}get date(){let M=this._tags.get("tmi-sent-ts");return new Date(Number(M))}get userInfo(){return new F0(this._prefix.nick,this._tags)}get channelId(){var M;return(M=this._tags.get("room-id"))!==null&&M!==void 0?M:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return Boolean(this._tags.get("custom-reward-id"))}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var M;return(M=this._tags.get("reply-parent-msg-id"))!==null&&M!==void 0?M:null}get parentMessageText(){var M;return(M=this._tags.get("reply-parent-msg-body"))!==null&&M!==void 0?M:null}get parentMessageUserId(){var M;return(M=this._tags.get("reply-parent-user-id"))!==null&&M!==void 0?M:null}get parentMessageUserName(){var M;return(M=this._tags.get("reply-parent-user-login"))!==null&&M!==void 0?M:null}get parentMessageUserDisplayName(){var M;return(M=this._tags.get("reply-parent-display-name"))!==null&&M!==void 0?M:null}get threadMessageId(){var M;return(M=this._tags.get("reply-thread-parent-msg-id"))!==null&&M!==void 0?M:null}get threadMessageUserId(){var M;return(M=this._tags.get("reply-thread-parent-user-id"))!==null&&M!==void 0?M:null}get bits(){var M;return Number((M=this._tags.get("bits"))!==null&&M!==void 0?M:0)}get emoteOffsets(){return hM(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return p(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return p(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){let M=this.hypeChatAmount;if(!M)return null;return M/10**this.hypeChatDecimalPlaces}get hypeChatCurrency(){var M;return(M=this._tags.get("pinned-chat-paid-currency"))!==null&&M!==void 0?M:null}get hypeChatLevel(){let M=this._tags.get("pinned-chat-paid-level");if(!M)return null;return x8.indexOf(M)+1}get hypeChatIsSystemMessage(){let M=this._tags.get("pinned-chat-paid-is-system-message");if(!M)return null;return Boolean(Number(M))}};cM=W([Q("chat","ChatMessage","id")],cM);function y1(Y){return Y instanceof cM?Y.tags.get("id"):Y}function Q$(Y,M){if(Y.length<=M)return[Y];Y=Y.trim();let $=[],X=0,O=M;while(X<Y.length){let J=Y.lastIndexOf(" ",O);if(J===-1||J<=X||Y.length-X+1<=M)J=X+M;let z=Y.slice(X,J).trim();if(z.length)$.push(z);X=J+(Y[J]===" "?1:0),O=X+M}return $}var _8=/^[a-z0-9][a-z0-9_]{0,24}$/;function T(Y){let M=Y.replace(/^#/,"").toLowerCase();if(!_8.test(M))throw Error(`"${M}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return M}function dM(Y){return`#${T(Y)}`}var F$,iM=F$=class extends s{constructor(M={}){var $,X,O,J,z,V,F;if(M.authProvider&&!M.authProvider.getAccessTokenForIntent)throw new b0("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super();if(this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new S1({connection:{hostName:($=M.hostName)!==null&&$!==void 0?$:((X=M.webSocket)!==null&&X!==void 0?X:!0)?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(O=M.ssl)!==null&&O!==void 0?O:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(J=M.webSocket)!==null&&J!==void 0?J:!0,connectionOptions:M.connectionOptions,logger:{name:"twurple:chat:irc",...M.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:M.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((L,R)=>{var U,q,f,C;(U=this._messageRateLimiter)===null||U===void 0||U.clear(),(q=this._messageRateLimiter)===null||q===void 0||q.pause(),(f=this._joinRateLimiter)===null||f===void 0||f.clear(),(C=this._joinRateLimiter)===null||C===void 0||C.pause(),this.emit(this.onDisconnect,L,R)}),this._ircClient.registerMessageType(cM),this._chatLogger=e({name:"twurple:chat:twitch",...M.logger}),this._authProvider=M.authProvider,this._useLegacyScopes=!!M.legacyScopes,this._readOnly=!!M.readOnly,this._authIntents=[...(z=M.authIntents)!==null&&z!==void 0?z:[],"chat"],this._isAlwaysMod=(V=M.isAlwaysMod)!==null&&V!==void 0?V:!1,this._botLevel=(F=M.botLevel)!==null&&F!==void 0?F:"none",this._ircClient.addCapability(I9),this._ircClient.addCapability(v9),M.requestMembershipEvents)this._ircClient.addCapability(H9);this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{var L,R;(L=this._messageRateLimiter)===null||L===void 0||L.resume(),(R=this._joinRateLimiter)===null||R===void 0||R.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);let U=await d3(M.channels);if(U)await Promise.all(U.map(async(q)=>{var f;try{await this.join(q)}catch(C){this._chatLogger.warn(`Failed to join configured channel ${q}; original message: ${(f=C===null||C===void 0?void 0:C.message)!==null&&f!==void 0?f:C}`)}}))}),this._ircClient.onPasswordError((L)=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${L.message}`),this.emit(this.onTokenFetchFailure,L)}),this._ircClient.onPrivmsg((L,R,U,q)=>{if(R!=="jtv")this.emit(this.onMessage,T(L),R,U,q)}),this._ircClient.onAction((L,R,U,q)=>{this.emit(this.onAction,T(L),R,U,q)}),this.addInternalListener(this._onJoinResult,(L,R,U)=>{if(U)this.emit(this.onJoinFailure,T(L),U);else this._ircClient.acknowledgeJoin(L)}),this._ircClient.onTypedMessage(gM,(L)=>{let{channel:R,user:U,tags:q}=L,f=T(R);if(U){let C=q.get("ban-duration");if(C===void 0)this.emit(this.onBan,f,U,L);else this.emit(this.onTimeout,f,U,Number(C),L)}else this.emit(this.onChatClear,f,L)}),this._ircClient.onTypedMessage(mM,(L)=>{let{channel:R,targetMessageId:U}=L;this.emit(this.onMessageRemove,T(R),U,L)}),this._ircClient.onTypedMessage(U0.Commands.ChannelJoin,({prefix:L,channel:R})=>{this.emit(this.onJoin,T(R),L.nick)}),this._ircClient.onTypedMessage(U0.Commands.ChannelPart,({prefix:L,channel:R})=>{this.emit(this.onPart,T(R),L.nick)}),this._ircClient.onTypedMessage(uM,({channel:L,tags:R})=>{let U=!1;if(R.has("subs-only")&&R.has("slow"))this.emit(this._onJoinResult,L,R),U=!0;if(!U){let q=T(L);if(R.has("slow")){let f=Number(R.get("slow"));if(f)this.emit(this.onSlow,q,!0,f);else this.emit(this.onSlow,q,!1)}if(R.has("followers-only")){let f=Number(R.get("followers-only"));if(f===-1)this.emit(this.onFollowersOnly,q,!1);else this.emit(this.onFollowersOnly,q,!0,f)}}}),this._ircClient.onTypedMessage(pM,(L)=>{let{channel:R,text:U,tags:q}=L,f=q.get("msg-id"),C=T(R);switch(f){case"sub":case"resub":{let A=f==="sub"?this.onSub:this.onResub,j=q.get("msg-param-sub-plan"),w=q.get("msg-param-streak-months"),D={userId:q.get("user-id"),displayName:q.get("display-name"),plan:j,planName:q.get("msg-param-sub-plan-name"),isPrime:j==="Prime",months:Number(q.get("msg-param-cumulative-months")),streak:w?Number(w):void 0,message:U};if(q.get("msg-param-was-gifted")==="true"){let y=q.get("msg-param-anon-gift")==="true",n=Number(q.get("msg-param-gift-months")),$0=Number(q.get("msg-param-gift-month-being-redeemed"));if(y)D.originalGiftInfo={anonymous:!0,duration:n,redeemedMonth:$0};else D.originalGiftInfo={anonymous:!1,duration:n,redeemedMonth:$0,userId:q.get("msg-param-gifter-id"),userName:q.get("msg-param-gifter-login"),userDisplayName:q.get("msg-param-gifter-name")}}this.emit(A,C,q.get("login"),D,L);break}case"subgift":{let A=q.get("msg-param-sub-plan"),j=q.get("login"),w=j==="ananonymousgifter",D={userId:q.get("msg-param-recipient-id"),displayName:q.get("msg-param-recipient-display-name"),gifter:w?void 0:j,gifterUserId:w?void 0:q.get("user-id"),gifterDisplayName:w?void 0:q.get("display-name"),gifterGiftCount:w?void 0:Number(q.get("msg-param-sender-count")),giftDuration:Number(q.get("msg-param-gift-months")),plan:A,planName:q.get("msg-param-sub-plan-name"),isPrime:A==="Prime",months:Number(q.get("msg-param-months"))};this.emit(this.onSubGift,C,q.get("msg-param-recipient-user-name"),D,L);break}case"submysterygift":{let A=q.get("login"),j=A==="ananonymousgifter",w={gifter:j?void 0:A,gifterUserId:j?void 0:q.get("user-id"),gifterDisplayName:j?void 0:q.get("display-name"),gifterGiftCount:j?void 0:Number(q.get("msg-param-sender-count")),count:Number(q.get("msg-param-mass-gift-count")),plan:q.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,C,q.get("login"),w,L);break}case"primepaidupgrade":{let A={userId:q.get("user-id"),displayName:q.get("display-name"),plan:q.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,C,q.get("login"),A,L);break}case"giftpaidupgrade":{let A={userId:q.get("user-id"),displayName:q.get("display-name"),gifter:q.get("msg-param-sender-login"),gifterDisplayName:q.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,C,q.get("login"),A,L);break}case"standardpayforward":{let A=q.get("msg-param-prior-gifter-anonymous")==="true",j={userId:q.get("user-id"),displayName:q.get("display-name"),originalGifterUserId:A?void 0:q.get("msg-param-prior-gifter-id"),originalGifterDisplayName:A?void 0:q.get("msg-param-prior-gifter-display-name"),recipientUserId:q.get("msg-param-recipient-id"),recipientDisplayName:q.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,C,q.get("login"),j,L);break}case"communitypayforward":{let A=q.get("msg-param-prior-gifter-anonymous")==="true",j={userId:q.get("user-id"),displayName:q.get("display-name"),originalGifterUserId:A?void 0:q.get("msg-param-prior-gifter-id"),originalGifterDisplayName:A?void 0:q.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,C,q.get("login"),j,L);break}case"primecommunitygiftreceived":{let A={name:q.get("msg-param-gift-name"),gifter:q.get("login"),gifterDisplayName:q.get("display-name")};this.emit(this.onPrimeCommunityGift,C,q.get("msg-param-recipient"),A,L);break}case"raid":{let A={displayName:q.get("msg-param-displayName"),viewerCount:Number(q.get("msg-param-viewerCount"))};this.emit(this.onRaid,C,q.get("login"),A,L);break}case"unraid":{this.emit(this.onRaidCancel,C,L);break}case"ritual":{let A={ritualName:q.get("msg-param-ritual-name"),message:U};this.emit(this.onRitual,C,q.get("login"),A,L);break}case"bitsbadgetier":{let A={displayName:q.get("display-name"),threshold:Number(q.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,C,q.get("login"),A,L);break}case"extendsub":{let A={userId:q.get("user-id"),displayName:q.get("display-name"),plan:q.get("msg-param-sub-plan"),months:Number(q.get("msg-param-cumulative-months")),endMonth:Number(q.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,C,q.get("login"),A,L);break}case"rewardgift":{let A={domain:q.get("msg-param-domain"),gifterId:q.get("user-id"),gifterDisplayName:q.get("display-name"),count:Number(q.get("msg-param-selected-count")),gifterGiftCount:Number(q.get("msg-param-total-reward-count")),triggerType:q.get("msg-param-trigger-type")};this.emit(this.onRewardGift,C,q.get("login"),A,L);break}case"announcement":{let A={color:q.get("msg-param-color")};this.emit(this.onAnnouncement,C,q.get("login"),A,L);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${f}`)}}),this._ircClient.onTypedMessage(bM,(L)=>{this.emit(this.onWhisper,L.prefix.nick,L.text,L)}),this._ircClient.onTypedMessage(U0.Commands.Notice,async({target:L,text:R,tags:U})=>{let q=U.get("msg-id");switch(q){case"emote_only_on":{this.emit(this.onEmoteOnly,T(L),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,T(L),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,L,void 0,q);break}case"r9k_on":{this.emit(this.onUniqueChat,T(L),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,T(L),!1);break}case"subs_on":{this.emit(this.onSubsOnly,T(L),!0);break}case"subs_off":{this.emit(this.onSubsOnly,T(L),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,T(L),R);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,T(L),R);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,T(L),q);break}case void 0:{if(R==="Login authentication failed"||R==="Improperly formatted AUTH"||R==="Invalid NICK"){if(this._authVerified=!1,!this._authRetryTimer)this._authRetryTimer=nM(120),this._authRetryCount=0;let f=this._authRetryTimer.next().value,C=++this._authRetryCount;if(this.emit(this.onAuthenticationFailure,R,C),f!==0)this._chatLogger.info(`Retrying authentication in ${f} seconds`);await U2(f*1000),this._ircClient.reconnect()}break}default:if(!q.startsWith("usage_"))this._chatLogger.warn(`Unrecognized notice ID: '${q}'`)}})}connect(){if(!this._authProvider)this._ircClient.changeNick(F$._generateJustinfanNick());this._initializeRateLimiters(),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(M,$,X={},O){let J={};if(X.replyTo)J["reply-parent-msg-id"]=y1(X.replyTo);let z=Q$($,500);await Promise.all(z.map(async(V)=>await this._messageRateLimiter.request({type:"say",channel:dM(M),text:V,tags:J},O)))}async action(M,$,X){let O=Q$($,490);await Promise.all(O.map(async(J)=>await this._messageRateLimiter.request({type:"action",channel:dM(M),text:J},X)))}async join(M){await this._joinRateLimiter.request(dM(M))}part(M){this._ircClient.part(dM(M))}quit(){var M,$,X,O;($=(M=this._messageRateLimiter)===null||M===void 0?void 0:M.destroy)===null||$===void 0||$.call(M),(O=(X=this._joinRateLimiter)===null||X===void 0?void 0:X.destroy)===null||O===void 0||O.call(X),this._messageRateLimiter=void 0,this._joinRateLimiter=void 0,this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var M,$;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!B0(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;let X=this._getNecessaryScopes(),O=void 0,J=!1;for(let z of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(z,X),!this._authToken)continue;J=!0;let V=await m0(this._authToken.accessToken);if(!V.userName)throw new b0("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(V.userName),`oauth:${this._authToken.accessToken}`}catch(V){if(V instanceof a)O=V;else this._chatLogger.error(`Retrieving an access token failed: ${V.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await(($=(M=this._authProvider).refreshAccessTokenForIntent)===null||$===void 0?void 0:$.call(M,z)),this._authToken){let V=await m0(this._authToken.accessToken);if(!V.userName)throw new b0("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(V.userName),`oauth:${this._authToken.accessToken}`}}catch(V){if(V instanceof a)O=V;else this._chatLogger.error(`Refreshing the access token failed: ${V.message}`)}}throw this._authVerified=!1,O!==null&&O!==void 0?O:Error(J?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof Y0?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){if(this._useLegacyScopes)return["chat_login"];if(this._readOnly)return["chat:read"];return["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}_initializeRateLimiters(){let M=async({type:X,text:O,channel:J,tags:z})=>{if(X==="say")this._ircClient.say(J,O,z);else this._ircClient.action(J,O)},$=async(X)=>{let{promise:O,resolve:J,reject:z}=q0(),V,F=this.addInternalListener(this._onJoinResult,(L,R,U)=>{if(L===X){if(clearTimeout(V),U)z(U);else J();this.removeListener(F)}});V=setTimeout(()=>{this.removeListener(F),this.emit(this._onJoinResult,X,void 0,"twurple_timeout"),z(Error(`Did not receive a reply to join ${X} in time; assuming that the join failed`))},1e4),this._ircClient.join(X),await O};if(this._isAlwaysMod)this._messageRateLimiter=new L3({bucketSize:this._botLevel==="verified"?7500:100,timeFrame:32000,doRequest:M});else{let X=20;if(this._botLevel==="verified")X=7500;else if(this._botLevel==="known")X=50;this._messageRateLimiter=new Z4(new t3({bucketSize:1,timeFrame:1200,logger:{minLevel:E.ERROR},doRequest:M,getPartitionKey:({channel:O})=>O}),{bucketSize:X,timeFrame:32000})}this._joinRateLimiter=new L3({bucketSize:this._botLevel==="verified"?2000:20,timeFrame:11000,doRequest:$}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause()}};W([G(!1)],iM.prototype,"_authProvider",void 0);iM=F$=W([Q("chat","ChatClient")],iM);class G${constructor(Y,M){this._bot=Y,this.msg=M,this.action=async($)=>await this._bot.action(this.broadcasterName,$),this.announce=async($,X)=>await this._bot.announceById(this.msg.channelId,$,X),this.ban=async($)=>await this._bot.banByIds(this.broadcasterId,this.userId,$),this.clear=async()=>await this._bot.clearById(this.broadcasterId),this.runCommercial=async($=30)=>await this._bot.runCommercialById(this.broadcasterId,$),this.delete=async()=>await this._bot.deleteMessageById(this.broadcasterId,this.msg.id),this.enableEmoteOnly=async()=>await this._bot.enableEmoteOnlyById(this.broadcasterId),this.disableEmoteOnly=async()=>await this._bot.disableEmoteOnlyById(this.broadcasterId),this.enableFollowersOnly=async($=0)=>await this._bot.enableFollowersOnlyById(this.broadcasterId,$),this.disableFollowersOnly=async()=>await this._bot.disableFollowersOnlyById(this.broadcasterId),this.enableUniqueChat=async()=>await this._bot.enableUniqueChatById(this.broadcasterId),this.disableUniqueChat=async()=>await this._bot.disableUniqueChatById(this.broadcasterId),this.enableSlow=async($=30)=>await this._bot.enableSlowModeById(this.broadcasterId,$),this.disableSlow=async()=>await this._bot.disableSlowModeById(this.broadcasterId),this.enableSubsOnly=async()=>await this._bot.enableSubsOnlyById(this.broadcasterId),this.disableSubsOnly=async()=>await this._bot.disableSubsOnlyById(this.broadcasterId),this.addVip=async()=>await this._bot.addVipByIds(this.broadcasterId,this.userId),this.removeVip=async()=>await this._bot.removeVipByIds(this.broadcasterId,this.userId),this.timeout=async($=30,X="")=>await this._bot.timeoutByIds(this.broadcasterId,this.userId,$,X),this.purge=async($="")=>await this._bot.purgeByIds(this.broadcasterId,this.userId,$),this.reply=async($)=>await this._bot.say(this.broadcasterName,$,{replyTo:this.msg.id}),this.replyToParent=async($)=>{if(this.msg.isReply)await this._bot.say(this.broadcasterName,$,{replyTo:this.msg.parentMessageId})},this.replyToThread=async($)=>{if(this.msg.isReply)await this._bot.say(this.broadcasterName,$,{replyTo:this.msg.threadMessageId})},this.say=async($)=>await this._bot.say(this.broadcasterName,$)}get broadcasterId(){return this.msg.channelId}get broadcasterName(){return T(this.msg.target)}get userId(){return this.msg.userInfo.userId}get userName(){return this.msg.userInfo.userName}get userDisplayName(){return this.msg.userInfo.displayName}}var v0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._msg.userInfo.userId}get userName(){return this._userName}get userDisplayName(){return this._msg.userInfo.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get color(){return this._info.color}};W([G(!1)],v0.prototype,"_broadcasterName",void 0);W([G(!1)],v0.prototype,"_userName",void 0);W([G(!1)],v0.prototype,"_info",void 0);W([G(!1)],v0.prototype,"_msg",void 0);W([G(!1)],v0.prototype,"_bot",void 0);v0=W([Q("easy-bot","AnnouncementEvent","broadcasterId")],v0);var P0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._duration=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){if(!this._msg.targetUserId)throw new m("Ban event without target user received");return this._msg.targetUserId}get userName(){return this._userName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get duration(){return this._duration}async unban(){await this._bot.unbanByIds(this.broadcasterId,this.userId)}get messageObject(){return this._msg}};W([G(!1)],P0.prototype,"_broadcasterName",void 0);W([G(!1)],P0.prototype,"_userName",void 0);W([G(!1)],P0.prototype,"_duration",void 0);W([G(!1)],P0.prototype,"_msg",void 0);W([G(!1)],P0.prototype,"_bot",void 0);P0=W([Q("easy-bot","BanEvent","userId")],P0);var H0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._msg.userInfo.userId}get userName(){return this._userName}get userDisplayName(){return this._info.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get threshold(){return this._info.threshold}get messageObject(){return this._msg}};W([G(!1)],H0.prototype,"_broadcasterName",void 0);W([G(!1)],H0.prototype,"_userName",void 0);W([G(!1)],H0.prototype,"_info",void 0);W([G(!1)],H0.prototype,"_msg",void 0);W([G(!1)],H0.prototype,"_bot",void 0);H0=W([Q("easy-bot","BitsBadgeUpgradeEvent","userId")],H0);var x3=class{constructor(M,$,X){this._broadcasterName=T(M),this._msg=$,this._bot=X}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get messageObject(){return this._msg}};W([G(!1)],x3.prototype,"_broadcasterName",void 0);W([G(!1)],x3.prototype,"_msg",void 0);W([G(!1)],x3.prototype,"_bot",void 0);x3=W([Q("easy-bot","ChatClearEvent","broadcasterId")],x3);var I0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._gifterName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get gifterId(){return this._msg.userInfo.userId}get gifterName(){return this._gifterName}get gifterDisplayName(){return this._info.displayName}async getGifter(){return N(await this._bot.api.users.getUserById(this.gifterId))}get originalGifterId(){var M;return(M=this._info.originalGifterUserId)!==null&&M!==void 0?M:null}get originalGifterDisplayName(){var M;return(M=this._info.originalGifterDisplayName)!==null&&M!==void 0?M:null}async getOriginalGifter(){let M=this.originalGifterId;if(!M)return null;return N(await this._bot.api.users.getUserById(M))}};W([G(!1)],I0.prototype,"_broadcasterName",void 0);W([G(!1)],I0.prototype,"_gifterName",void 0);W([G(!1)],I0.prototype,"_info",void 0);W([G(!1)],I0.prototype,"_msg",void 0);W([G(!1)],I0.prototype,"_bot",void 0);I0=W([Q("easy-bot","CommunityPayForwardEvent","gifterId")],I0);var Z3=class{constructor(M,$,X,O){this._broadcasterName=T(M),this._info=$,this._msg=X,this._bot=O}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get gifterId(){var M;return(M=this._info.gifterUserId)!==null&&M!==void 0?M:null}get gifterName(){var M;return(M=this._info.gifter)!==null&&M!==void 0?M:null}get gifterDisplayName(){var M;return(M=this._info.gifterDisplayName)!==null&&M!==void 0?M:null}async getGifter(){let M=this.gifterId;if(!M)return null;return N(await this._bot.api.users.getUserById(M))}get plan(){return this._info.plan}get count(){return this._info.count}get messageObject(){return this._msg}};W([G(!1)],Z3.prototype,"_broadcasterName",void 0);W([G(!1)],Z3.prototype,"_info",void 0);W([G(!1)],Z3.prototype,"_msg",void 0);W([G(!1)],Z3.prototype,"_bot",void 0);Z3=W([Q("easy-bot","CommunitySubEvent","gifterId")],Z3);var _3=class{constructor(M,$,X){this._broadcasterName=T(M),this._enabled=$,this._bot=X}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get enabled(){return this._enabled}async enable(){await this._bot.enableEmoteOnly(this.broadcasterName)}async disable(){await this._bot.disableEmoteOnly(this.broadcasterName)}};W([G(!1)],_3.prototype,"_broadcasterName",void 0);W([G(!1)],_3.prototype,"_enabled",void 0);W([G(!1)],_3.prototype,"_bot",void 0);_3=W([Q("easy-bot","EmoteOnlyToggleEvent","broadcasterName")],_3);var O3=class{constructor(M,$,X,O){this._broadcasterName=T(M),this._enabled=$,this._delay=X,this._bot=O}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get enabled(){return this._enabled}get delay(){var M;return(M=this._delay)!==null&&M!==void 0?M:null}async enable(M=0){await this._bot.enableFollowersOnly(this.broadcasterName,M)}async disable(){await this._bot.disableFollowersOnly(this.broadcasterName)}};W([G(!1)],O3.prototype,"_broadcasterName",void 0);W([G(!1)],O3.prototype,"_enabled",void 0);W([G(!1)],O3.prototype,"_delay",void 0);W([G(!1)],O3.prototype,"_bot",void 0);O3=W([Q("easy-bot","FollowersOnlyToggleEvent","broadcasterName")],O3);var x0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._info.userId}get userName(){return this._userName}get userDisplayName(){return this._info.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get gifterName(){return this._info.gifter}get gifterDisplayName(){return this._info.gifterDisplayName}async getGifter(){return N(await this._bot.api.users.getUserByName(this.gifterName))}get messageObject(){return this._msg}};W([G(!1)],x0.prototype,"_broadcasterName",void 0);W([G(!1)],x0.prototype,"_userName",void 0);W([G(!1)],x0.prototype,"_info",void 0);W([G(!1)],x0.prototype,"_msg",void 0);W([G(!1)],x0.prototype,"_bot",void 0);x0=W([Q("easy-bot","GiftPaidUpgradeEvent","userId")],x0);var w3=class{constructor(M,$,X){this._broadcasterName=T(M),this._userName=$,this._bot=X}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get userName(){return this._userName}async getUser(){return N(await this._bot.api.users.getUserByName(this.userName))}leave(){this._bot.leave(this.broadcasterName)}};W([G(!1)],w3.prototype,"_broadcasterName",void 0);W([G(!1)],w3.prototype,"_userName",void 0);W([G(!1)],w3.prototype,"_bot",void 0);w3=W([Q("easy-bot","JoinEvent","broadcasterName")],w3);var S3=class{constructor(M,$,X){this._broadcasterName=T(M),this._reason=$,this._bot=X}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get reason(){return this._reason}async retry(){await this._bot.join(this.broadcasterName)}};W([G(!1)],S3.prototype,"_broadcasterName",void 0);W([G(!1)],S3.prototype,"_reason",void 0);W([G(!1)],S3.prototype,"_bot",void 0);S3=W([Q("easy-bot","JoinFailureEvent","broadcasterName")],S3);var y3=class{constructor(M,$,X){this._broadcasterName=T(M),this._userName=$,this._bot=X}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get userName(){return this._userName}async getUser(){return N(await this._bot.api.users.getUserByName(this.userName))}async join(){await this._bot.join(this.broadcasterName)}};W([G(!1)],y3.prototype,"_broadcasterName",void 0);W([G(!1)],y3.prototype,"_userName",void 0);W([G(!1)],y3.prototype,"_bot",void 0);y3=W([Q("easy-bot","LeaveEvent","broadcasterName")],y3);var G0=class{constructor(M,$,X,O,J,z){this._broadcasterName=T(M),this._userName=$,this._text=X,this._isAction=O,this._msg=J,this._bot=z}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._msg.userInfo.userId}get userName(){return this._userName}get userDisplayName(){return this._msg.userInfo.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get text(){return this._text}get isAction(){return this._isAction}get emoteOffsets(){return this._msg.emoteOffsets}async reply(M){await this._bot.reply(this.broadcasterName,M,this._msg)}async delete(){await this._bot.deleteMessageById(this.broadcasterId,this._msg)}};W([G(!1)],G0.prototype,"_broadcasterName",void 0);W([G(!1)],G0.prototype,"_userName",void 0);W([G(!1)],G0.prototype,"_text",void 0);W([G(!1)],G0.prototype,"_isAction",void 0);W([G(!1)],G0.prototype,"_msg",void 0);W([G(!1)],G0.prototype,"_bot",void 0);G0=W([Q("easy-bot","MessageEvent","userId")],G0);var J3=class{constructor(M,$,X,O){this._broadcasterName=T(M),this._messageId=$,this._msg=X,this._bot=O}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userName(){return this._msg.userName}get messageId(){return this._messageId}get originalText(){return this._msg.text}get messageObject(){return this._msg}};W([G(!1)],J3.prototype,"_broadcasterName",void 0);W([G(!1)],J3.prototype,"_messageId",void 0);W([G(!1)],J3.prototype,"_msg",void 0);W([G(!1)],J3.prototype,"_bot",void 0);J3=W([Q("easy-bot","MessageRemoveEvent","broadcasterName")],J3);var _0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._info.userId}get userName(){return this._userName}get userDisplayName(){return this._info.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get plan(){return this._info.plan}get messageObject(){return this._msg}};W([G(!1)],_0.prototype,"_broadcasterName",void 0);W([G(!1)],_0.prototype,"_userName",void 0);W([G(!1)],_0.prototype,"_info",void 0);W([G(!1)],_0.prototype,"_msg",void 0);W([G(!1)],_0.prototype,"_bot",void 0);_0=W([Q("easy-bot","PrimePaidUpgradeEvent","userId")],_0);var g3=class{constructor(M,$,X){this._broadcasterName=T(M),this._msg=$,this._bot=X}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._msg.userInfo.userId}get userName(){return this._msg.userInfo.userName}get userDisplayName(){return this._msg.userInfo.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get messageObject(){return this._msg}};W([G(!1)],g3.prototype,"_broadcasterName",void 0);W([G(!1)],g3.prototype,"_msg",void 0);W([G(!1)],g3.prototype,"_bot",void 0);g3=W([Q("easy-bot","RaidCancelEvent","broadcasterName")],g3);var w0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._msg.userInfo.userId}get userName(){return this._userName}get userDisplayName(){return this._info.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get viewerCount(){return this._info.viewerCount}get messageObject(){return this._msg}};W([G(!1)],w0.prototype,"_broadcasterName",void 0);W([G(!1)],w0.prototype,"_userName",void 0);W([G(!1)],w0.prototype,"_info",void 0);W([G(!1)],w0.prototype,"_msg",void 0);W([G(!1)],w0.prototype,"_bot",void 0);w0=W([Q("easy-bot","RaidEvent","userId")],w0);var W3=class{constructor(M,$,X,O){this._broadcasterName=T(M),this._enabled=$,this._delay=X,this._bot=O}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get enabled(){return this._enabled}get delay(){var M;return(M=this._delay)!==null&&M!==void 0?M:null}async enable(M=30){await this._bot.enableSlowMode(this.broadcasterName,M)}async disable(){await this._bot.disableSlowMode(this.broadcasterName)}};W([G(!1)],W3.prototype,"_broadcasterName",void 0);W([G(!1)],W3.prototype,"_enabled",void 0);W([G(!1)],W3.prototype,"_delay",void 0);W([G(!1)],W3.prototype,"_bot",void 0);W3=W([Q("easy-bot","SlowModeToggleEvent","broadcasterName")],W3);var S0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._gifterName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._info.recipientUserId}get userDisplayName(){return this._info.recipientDisplayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get gifterId(){return this._msg.userInfo.userId}get gifterName(){return this._gifterName}get gifterDisplayName(){return this._info.displayName}async getGifter(){return N(await this._bot.api.users.getUserById(this.gifterId))}get originalGifterId(){var M;return(M=this._info.originalGifterUserId)!==null&&M!==void 0?M:null}get originalGifterDisplayName(){var M;return(M=this._info.originalGifterDisplayName)!==null&&M!==void 0?M:null}async getOriginalGifter(){let M=this.originalGifterId;if(!M)return null;return N(await this._bot.api.users.getUserById(M))}get messageObject(){return this._msg}};W([G(!1)],S0.prototype,"_broadcasterName",void 0);W([G(!1)],S0.prototype,"_gifterName",void 0);W([G(!1)],S0.prototype,"_info",void 0);W([G(!1)],S0.prototype,"_msg",void 0);W([G(!1)],S0.prototype,"_bot",void 0);S0=W([Q("easy-bot","StandardPayForwardEvent","gifterId")],S0);var O0=class{constructor(M,$,X,O,J){this._broadcasterName=T(M),this._userName=$,this._info=X,this._msg=O,this._bot=J}get broadcasterId(){return this._msg.channelId}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserById(this.broadcasterId))}get userId(){return this._msg.userInfo.userId}get userName(){return this._userName}get userDisplayName(){return this._info.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get plan(){return this._info.plan}get planName(){return this._info.planName}get isPrime(){return this._info.isPrime}get months(){return this._info.months}get streak(){var M;return(M=this._info.streak)!==null&&M!==void 0?M:null}get message(){var M;return(M=this._info.message)!==null&&M!==void 0?M:null}get messageObject(){return this._msg}get wasGift(){return!!this._info.originalGiftInfo}get wasAnonymousGift(){var M,$;return($=(M=this._info.originalGiftInfo)===null||M===void 0?void 0:M.anonymous)!==null&&$!==void 0?$:!1}get originalGifterId(){var M,$;return($=(M=this._info.originalGiftInfo)===null||M===void 0?void 0:M.userId)!==null&&$!==void 0?$:null}get originalGifterName(){var M,$;return($=(M=this._info.originalGiftInfo)===null||M===void 0?void 0:M.userName)!==null&&$!==void 0?$:null}get originalGifterDisplayName(){var M,$;return($=(M=this._info.originalGiftInfo)===null||M===void 0?void 0:M.userDisplayName)!==null&&$!==void 0?$:null}async getOriginalGifter(){let M=this.originalGifterId;if(!M)return null;return N(await this._bot.api.users.getUserById(M))}get originalGiftDuration(){var M,$;return($=(M=this._info.originalGiftInfo)===null||M===void 0?void 0:M.duration)!==null&&$!==void 0?$:null}get giftRedeemedMonth(){var M,$;return($=(M=this._info.originalGiftInfo)===null||M===void 0?void 0:M.redeemedMonth)!==null&&$!==void 0?$:null}};W([G(!1)],O0.prototype,"_broadcasterName",void 0);W([G(!1)],O0.prototype,"_userName",void 0);W([G(!1)],O0.prototype,"_info",void 0);W([G(!1)],O0.prototype,"_msg",void 0);W([G(!1)],O0.prototype,"_bot",void 0);O0=W([Q("easy-bot","SubEvent","userId")],O0);var g1=class extends O0{constructor(M,$,X,O,J){super(M,$,X,O,J);this._giftInfo=X}get gifterId(){var M;return(M=this._giftInfo.gifterUserId)!==null&&M!==void 0?M:null}get gifterName(){var M;return(M=this._giftInfo.gifter)!==null&&M!==void 0?M:null}get gifterDisplayName(){var M;return(M=this._giftInfo.gifterDisplayName)!==null&&M!==void 0?M:null}async getGifter(){let M=this.gifterId;if(!M)return null;return N(await this._bot.api.users.getUserById(M))}};W([G(!1)],g1.prototype,"_giftInfo",void 0);g1=W([Q("easy-bot","SubGiftEvent","userId")],g1);var u3=class{constructor(M,$,X){this._broadcasterName=T(M),this._enabled=$,this._bot=X}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get enabled(){return this._enabled}async enable(){await this._bot.enableSubsOnly(this.broadcasterName)}async disable(){await this._bot.disableSubsOnly(this.broadcasterName)}};W([G(!1)],u3.prototype,"_broadcasterName",void 0);W([G(!1)],u3.prototype,"_enabled",void 0);W([G(!1)],u3.prototype,"_bot",void 0);u3=W([Q("easy-bot","SubsOnlyToggleEvent","broadcasterName")],u3);var h3=class{constructor(M,$,X){this._broadcasterName=T(M),this._enabled=$,this._bot=X}get broadcasterName(){return this._broadcasterName}async getBroadcaster(){return N(await this._bot.api.users.getUserByName(this.broadcasterName))}get enabled(){return this._enabled}async enable(){await this._bot.enableUniqueChat(this.broadcasterName)}async disable(){await this._bot.disableUniqueChat(this.broadcasterName)}};W([G(!1)],h3.prototype,"_broadcasterName",void 0);W([G(!1)],h3.prototype,"_enabled",void 0);W([G(!1)],h3.prototype,"_bot",void 0);h3=W([Q("easy-bot","UniqueChatToggleEvent","broadcasterName")],h3);var z3=class{constructor(M,$,X,O){this._userName=M,this._text=$,this._msg=X,this._bot=O}get userId(){return this._msg.userInfo.userId}get userName(){return this._userName}get userDisplayName(){return this._msg.userInfo.displayName}async getUser(){return N(await this._bot.api.users.getUserById(this.userId))}get text(){return this._text}async reply(M){await this._bot.whisperById(this.userId,M)}};W([G(!1)],z3.prototype,"_userName",void 0);W([G(!1)],z3.prototype,"_text",void 0);W([G(!1)],z3.prototype,"_msg",void 0);W([G(!1)],z3.prototype,"_bot",void 0);z3=W([Q("easy-bot","WhisperEvent","userId")],z3);class u1 extends s{constructor(Y){let{authProvider:M,authMethod:$,channel:X,channels:O,debug:J,commands:z,emitCommandMessageEvents:V,prefix:F,chatClientOptions:L}=Y;super();this._commands=new Map,this._botUserIdPromise=null,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnlyToggle=this.registerEvent(),this.onFollowersOnlyToggle=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onLeave=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChatToggle=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onSlowModeToggle=this.registerEvent(),this.onSubsOnlyToggle=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent();let R=X?[X]:O;if(!R)throw Error("didn't pass channel nor channels option, exiting");this._authProvider=M,this._prefix=F!==null&&F!==void 0?F:"!",this._authMethod=$!==null&&$!==void 0?$:"bot",this._commands=new Map(z===null||z===void 0?void 0:z.map((q)=>[q.name,q]));let U=J?E.DEBUG:E.ERROR;this.api=new E3({authProvider:this._authProvider,logger:{minLevel:U}}),this.chat=new iM({logger:{minLevel:U},...L,authProvider:this._authProvider,channels:R}),this.chat.onMessage(async(q,f,C,A)=>{let j=this._findMatch(A);if(j===null||j===void 0?void 0:j.command.canExecute(A.channelId,A.userInfo.userId))await j.command.execute(j.params,new G$(this,A));if(j===null||V)this.emit(this.onMessage,new G0(q,f,C,!1,A,this))}),this.chat.onConnect(()=>this.emit(this.onConnect)),this.chat.onDisconnect((q,f)=>this.emit(this.onDisconnect,q,f)),this.chat.onAuthenticationSuccess(()=>this.emit(this.onAuthenticationSuccess)),this.chat.onAuthenticationFailure((q,f)=>this.emit(this.onAuthenticationFailure,q,f)),this.chat.onTokenFetchFailure((q)=>this.emit(this.onTokenFetchFailure,q)),this.chat.onMessageFailed((q,f)=>this.emit(this.onMessageFailed,q,f)),this.chat.onTimeout((q,f,C,A)=>this.emit(this.onTimeout,new P0(q,f,C,A,this))),this.chat.onBan((q,f,C)=>this.emit(this.onBan,new P0(q,f,null,C,this))),this.chat.onBitsBadgeUpgrade((q,f,C,A)=>this.emit(this.onBitsBadgeUpgrade,new H0(q,f,C,A,this))),this.chat.onChatClear((q,f)=>this.emit(this.onChatClear,new x3(q,f,this))),this.chat.onEmoteOnly((q,f)=>this.emit(this.onEmoteOnlyToggle,new _3(q,f,this))),this.chat.onFollowersOnly((q,f,C)=>this.emit(this.onFollowersOnlyToggle,new O3(q,f,C,this))),this.chat.onJoin((q,f)=>this.emit(this.onJoin,new w3(q,f,this))),this.chat.onJoinFailure((q,f)=>this.emit(this.onJoinFailure,new S3(q,f,this))),this.chat.onPart((q,f)=>this.emit(this.onLeave,new y3(q,f,this))),this.chat.onMessageRemove((q,f,C)=>this.emit(this.onMessageRemove,new J3(q,f,C,this))),this.chat.onUniqueChat((q,f)=>this.emit(this.onUniqueChatToggle,new h3(q,f,this))),this.chat.onRaid((q,f,C,A)=>this.emit(this.onRaid,new w0(q,f,C,A,this))),this.chat.onRaidCancel((q,f)=>this.emit(this.onRaidCancel,new g3(q,f,this))),this.chat.onSlow((q,f,C)=>this.emit(this.onSlowModeToggle,new W3(q,f,C,this))),this.chat.onSubsOnly((q,f)=>this.emit(this.onSubsOnlyToggle,new u3(q,f,this))),this.chat.onSub((q,f,C,A)=>this.emit(this.onSub,new O0(q,f,C,A,this))),this.chat.onResub((q,f,C,A)=>this.emit(this.onResub,new O0(q,f,C,A,this))),this.chat.onSubGift((q,f,C,A)=>this.emit(this.onSubGift,new g1(q,f,C,A,this))),this.chat.onCommunitySub((q,f,C,A)=>this.emit(this.onCommunitySub,new Z3(q,C,A,this))),this.chat.onPrimePaidUpgrade((q,f,C,A)=>this.emit(this.onPrimePaidUpgrade,new _0(q,f,C,A,this))),this.chat.onGiftPaidUpgrade((q,f,C,A)=>this.emit(this.onGiftPaidUpgrade,new x0(q,f,C,A,this))),this.chat.onStandardPayForward((q,f,C,A)=>this.emit(this.onStandardPayForward,new S0(q,f,C,A,this))),this.chat.onCommunityPayForward((q,f,C,A)=>this.emit(this.onCommunityPayForward,new I0(q,f,C,A,this))),this.chat.onAnnouncement((q,f,C,A)=>this.emit(this.onAnnouncement,new v0(q,f,C,A,this))),this.chat.onWhisper((q,f,C)=>this.emit(this.onWhisper,new z3(q,f,C,this))),this.chat.onAction((q,f,C,A)=>this.emit(this.onAction,new G0(q,f,C,!0,A,this))),this.chat.connect()}async announce(Y,M,$){await this.announceById(await this._resolveUserId(Y),M,$)}async announceById(Y,M,$){await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async(X)=>await X.chat.sendAnnouncement(Y,{message:M,color:$}))}async ban(Y,M,$){let X=await this._resolveUserId(Y),O=await this._resolveUserId(M);await this.banByIds(X,O,$)}async banByIds(Y,M,$){await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async(X)=>await X.moderation.banUser(Y,{user:M,reason:$}))}async unban(Y,M){let $=await this._resolveUserId(Y),X=await this._resolveUserId(M);await this.unbanByIds($,X)}async unbanByIds(Y,M){await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async($)=>await $.moderation.unbanUser(Y,M))}async clear(Y){let M=await this._resolveUserId(Y);await this.clearById(M)}async clearById(Y){await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async(M)=>await M.moderation.deleteChatMessages(Y))}async changeColor(Y){await this.api.chat.setColorForUser(await this._getBotUserId(),Y)}async runCommercial(Y,M=30){let $=await this._resolveUserId(Y);await this.runCommercialById($,M)}async runCommercialById(Y,M=30){await this.api.channels.startChannelCommercial(Y,M)}async deleteMessage(Y,M){let $=await this._resolveUserId(Y);await this.deleteMessageById($,M)}async deleteMessageById(Y,M){await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async($)=>await $.moderation.deleteChatMessages(Y,y1(M)))}async enableEmoteOnly(Y){let M=await this._resolveUserId(Y);await this.enableEmoteOnlyById(M)}async enableEmoteOnlyById(Y){await this._updateChannelSettings(Y,{emoteOnlyModeEnabled:!0})}async disableEmoteOnly(Y){let M=await this._resolveUserId(Y);await this.disableEmoteOnlyById(M)}async disableEmoteOnlyById(Y){await this._updateChannelSettings(Y,{emoteOnlyModeEnabled:!1})}async enableFollowersOnly(Y,M=0){let $=await this._resolveUserId(Y);await this.enableFollowersOnlyById($,M)}async enableFollowersOnlyById(Y,M=0){await this._updateChannelSettings(Y,{followerOnlyModeEnabled:!0,followerOnlyModeDelay:M})}async disableFollowersOnly(Y){let M=await this._resolveUserId(Y);await this.disableFollowersOnlyById(M)}async disableFollowersOnlyById(Y){await this._updateChannelSettings(Y,{followerOnlyModeEnabled:!1})}async mod(Y,M){let $=await this._resolveUserId(Y),X=await this._resolveUserId(M);await this.modByIds($,X)}async modByIds(Y,M){await this.api.moderation.addModerator(Y,M)}async unmod(Y,M){let $=await this._resolveUserId(Y),X=await this._resolveUserId(M);await this.unmodByIds($,X)}async unmodByIds(Y,M){await this.api.moderation.removeModerator(Y,M)}async enableUniqueChat(Y){let M=await this._resolveUserId(Y);await this.enableUniqueChatById(M)}async enableUniqueChatById(Y){await this._updateChannelSettings(Y,{uniqueChatModeEnabled:!0})}async disableUniqueChat(Y){let M=await this._resolveUserId(Y);await this.disableUniqueChatById(M)}async disableUniqueChatById(Y){await this._updateChannelSettings(Y,{uniqueChatModeEnabled:!1})}async enableSlowMode(Y,M=30){let $=await this._resolveUserId(Y);await this.enableSlowModeById($,M)}async enableSlowModeById(Y,M=30){await this._updateChannelSettings(Y,{slowModeEnabled:!0,slowModeDelay:M})}async disableSlowMode(Y){let M=await this._resolveUserId(Y);await this.disableSlowModeById(M)}async disableSlowModeById(Y){await this._updateChannelSettings(Y,{slowModeEnabled:!1})}async enableSubsOnly(Y){let M=await this._resolveUserId(Y);await this.enableSubsOnlyById(M)}async enableSubsOnlyById(Y){await this._updateChannelSettings(Y,{subscriberOnlyModeEnabled:!0})}async disableSubsOnly(Y){let M=await this._resolveUserId(Y);await this.disableSubsOnlyById(M)}async disableSubsOnlyById(Y){await this._updateChannelSettings(Y,{subscriberOnlyModeEnabled:!1})}async timeout(Y,M,$=60,X=""){if(!Number.isInteger($)||$<1||$>1209600)throw Error(`Invalid timeout duration: ${$}. It must be an integer between 1 and 1209600.`);let O=await this._resolveUserId(Y),J=await this._resolveUserId(M);await this.timeoutByIds(O,J,$,X)}async timeoutByIds(Y,M,$=60,X=""){if(!Number.isInteger($)||$<1||$>1209600)throw Error(`Invalid timeout duration: ${$}. It must be an integer between 1 and 1209600.`);await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async(O)=>await O.moderation.banUser(Y,{user:M,reason:X,duration:$}))}async purge(Y,M,$=""){await this.timeout(Y,M,1,$)}async purgeByIds(Y,M,$=""){await this.timeoutByIds(Y,M,1,$)}async addVip(Y,M){let $=await this._resolveUserId(Y),X=await this._resolveUserId(M);await this.addVipByIds($,X)}async addVipByIds(Y,M){await this.api.channels.addVip(Y,M)}async removeVip(Y,M){let $=await this._resolveUserId(Y),X=await this._resolveUserId(M);await this.removeVipByIds($,X)}async removeVipByIds(Y,M){await this.api.channels.removeVip(Y,M)}async getMods(Y){let M=await this._resolveUserId(Y);return await this.getModsById(M)}async getModsById(Y){return await this.api.moderation.getModeratorsPaginated(Y).getAll()}async getVips(Y){let M=await this._resolveUserId(Y);return await this.getVipsById(M)}async getVipsById(Y){return await this.api.channels.getVipsPaginated(Y).getAll()}async join(Y){await this.chat.join(Y)}leave(Y){this.chat.part(Y)}async reply(Y,M,$){await this.chat.say(Y,M,{replyTo:$})}async say(Y,M,$={}){await this.chat.say(Y,M,$)}async action(Y,M){await this.chat.action(Y,M)}async whisper(Y,M){await this.whisperById(await this._resolveUserId(Y),M)}async whisperById(Y,M){await this.api.whispers.sendWhisper(await this._getBotUserId(),Y,M)}_findMatch(Y){let M=Y.text.trim().replace(/  +/g," ");if(Y.isReply){let[$,...X]=M.split(" ");if($.toLowerCase()===`@${Y.parentMessageUserName}`)M=X.join(" ")}for(let $ of this._commands.values()){let X=$.match(M,this._prefix);if(X!==null)return{command:$,params:X}}return null}async _getBotUserId(){if(this._botUserIdPromise)return await this._botUserIdPromise;return await(this._botUserIdPromise=this.api.asIntent(["chat"],async(Y)=>await Y.getTokenInfo()).then((Y)=>{if(!Y.userId)throw new m("Bot token is not a user token");return Y.userId}))}async _getPreferredUserIdForModAction(Y){if(this._authMethod==="bot")return await this._getBotUserId();return Y}async _resolveUserId(Y){let M=T(Y),$=await this.api.users.getUserByName(M);if(!$)throw Error(`User ${M} does not exist`);return $.id}async _updateChannelSettings(Y,M){await this.api.asUser(await this._getPreferredUserIdForModAction(Y),async($)=>await $.chat.updateSettings(Y,M))}}W([G(!1)],u1.prototype,"_authProvider",void 0);class L${userService;emoteService;statisticsService;constructor(Y,M,$){this.userService=Y;this.emoteService=M;this.statisticsService=$}async handleMessage(Y){let{broadcasterName:M,userDisplayName:$,userId:X,text:O,userInfo:J}=Y,z=J?.isMod??!1,V=J?.isSubscriber??!1,F=J?.isBroadcaster??!1,L=J?.isVip??!1,R=[];if(F)R.push("BROADCASTER");if(z)R.push("MOD");if(L)R.push("VIP");if(V)R.push("SUB");if(R.length>0)console.log(`  Badges: ${R.join(", ")}`);this.statisticsService.recordMessage(M);let U=await this.emoteService.getChannelEmotes(M),q=this.emoteService.findEmotesInMessage(O,U);if(q.length>0)for(let f of q){let C=this.emoteService.getEmoteMetadata(M,f);if(C)this.statisticsService.recordEmoteUsage(M,f,{emoteId:C.id,imageUrl:C.imageUrl,animated:C.animated});else this.statisticsService.recordEmoteUsage(M,f)}}}class q${userService;emoteCache=new Map;emoteMetadataCache=new Map;cacheTimestamps=new Map;CACHE_DURATION=300000;constructor(Y){this.userService=Y}async fetchChannelEmotes(Y){let M=this.getCachedEmotes(Y);if(M)return M;try{let $=await this.userService.getUserIdByName(Y);if(!$)return console.error(`[EmoteService] Could not find channel ID for ${Y}`),new Set;let X=await fetch(`https://7tv.io/v3/users/twitch/${$}`);if(!X.ok){if(X.status===404)return console.log(`[EmoteService] Channel ${Y} has no 7TV emotes`),new Set;throw Error(`7TV API returned ${X.status}`)}let O=await X.json(),J=new Set,z=new Map;if(O.emote_set?.emotes)for(let V of O.emote_set.emotes)J.add(V.name),z.set(V.name,{id:V.data.id,name:V.name,imageUrl:`https://cdn.7tv.app/emote/${V.data.id}/1x.webp`,animated:V.data.animated});return console.log(`[EmoteService] Loaded ${J.size} emotes for ${Y}`),this.emoteCache.set(Y.toLowerCase(),J),this.emoteMetadataCache.set(Y.toLowerCase(),z),this.cacheTimestamps.set(Y.toLowerCase(),Date.now()),J}catch($){return console.error(`[EmoteService] Error fetching emotes for ${Y}:`,$),new Set}}getCachedEmotes(Y){let M=this.emoteCache.get(Y.toLowerCase()),$=this.cacheTimestamps.get(Y.toLowerCase());if(M&&$){if(Date.now()-$<this.CACHE_DURATION)return M}return null}async getChannelEmotes(Y){return this.fetchChannelEmotes(Y)}findEmotesInMessage(Y,M){let $=new Set,X=Y.split(/\s+/);for(let O of X)if(M.has(O))$.add(O);return Array.from($)}getEmoteMetadata(Y,M){return this.emoteMetadataCache.get(Y.toLowerCase())?.get(M)??null}getAllEmoteMetadata(Y){return this.emoteMetadataCache.get(Y.toLowerCase())??null}async preloadChannelEmotes(Y){console.log(`[EmoteService] Pre-loading emotes for ${Y.length} channel(s)...`);let M=Y.map(($)=>this.fetchChannelEmotes($));await Promise.all(M),console.log("[EmoteService] Emote pre-loading complete")}}import{promises as B$}from"fs";import w8 from"path";class R${channelStats=new Map;dataDir="./data/statistics";statsFile=w8.join(this.dataDir,"stats.json");saveInterval=null;isDirty=!1;recordEmoteUsage(Y,M,$){let X=Y.toLowerCase();if(!this.channelStats.has(X))this.channelStats.set(X,{channelName:X,totalMessages:0,totalEmotesUsed:0,emotes:new Map});let O=this.channelStats.get(X),J=O.emotes.get(M);if(!J)J={emoteName:M,count:0,lastUsed:Date.now(),channel:X,emoteId:$?.emoteId,imageUrl:$?.imageUrl,animated:$?.animated},O.emotes.set(M,J);J.count++,J.lastUsed=Date.now(),O.totalEmotesUsed++,this.isDirty=!0}recordMessage(Y){let M=Y.toLowerCase();if(!this.channelStats.has(M))this.channelStats.set(M,{channelName:M,totalMessages:0,totalEmotesUsed:0,emotes:new Map});this.channelStats.get(M).totalMessages++,this.isDirty=!0}getChannelStats(Y){return this.channelStats.get(Y.toLowerCase())??null}getAllStats(){return Array.from(this.channelStats.values())}getTopEmotes(Y=100){let M=[];for(let $ of this.channelStats.values())M.push(...Array.from($.emotes.values()));return M.sort(($,X)=>X.count-$.count).slice(0,Y)}getTopEmotesForChannel(Y,M=10){let $=this.getChannelStats(Y);if(!$)return[];return Array.from($.emotes.values()).sort((X,O)=>O.count-X.count).slice(0,M)}exportStats(){return{channels:this.getAllStats().map((M)=>({channelName:M.channelName,totalMessages:M.totalMessages,totalEmotesUsed:M.totalEmotesUsed,emotes:Array.from(M.emotes.values()).sort(($,X)=>X.count-$.count)})),topEmotes:this.getTopEmotes(20),lastUpdated:Date.now()}}clearStats(){this.channelStats.clear(),this.isDirty=!0,console.log("[StatisticsService] All statistics cleared")}async saveStats(){try{await B$.mkdir(this.dataDir,{recursive:!0});let Y=Array.from(this.channelStats.values()).map((M)=>({channelName:M.channelName,totalMessages:M.totalMessages,totalEmotesUsed:M.totalEmotesUsed,emotes:Array.from(M.emotes.values())}));await B$.writeFile(this.statsFile,JSON.stringify(Y,null,2),"utf-8"),this.isDirty=!1,console.log("[StatisticsService] Statistics saved to disk")}catch(Y){console.error("[StatisticsService] Error saving statistics:",Y)}}async loadStats(){try{let Y=await B$.readFile(this.statsFile,"utf-8"),M=JSON.parse(Y);this.channelStats.clear();for(let $ of M){let X=new Map;for(let O of $.emotes)X.set(O.emoteName,O);this.channelStats.set($.channelName,{channelName:$.channelName,totalMessages:$.totalMessages,totalEmotesUsed:$.totalEmotesUsed,emotes:X})}console.log(`[StatisticsService] Loaded statistics for ${this.channelStats.size} channel(s)`),this.isDirty=!1}catch(Y){if(Y.code==="ENOENT")console.log("[StatisticsService] No existing statistics file found, starting fresh");else console.error("[StatisticsService] Error loading statistics:",Y)}}startAutoSave(){if(this.saveInterval)return;this.saveInterval=setInterval(async()=>{if(this.isDirty)await this.saveStats()},30000),console.log("[StatisticsService] Auto-save enabled (every 30 seconds)")}async stopAutoSave(){if(this.saveInterval)clearInterval(this.saveInterval),this.saveInterval=null;if(this.isDirty)await this.saveStats();console.log("[StatisticsService] Auto-save stopped")}}class N${apiClient;constructor(Y){this.apiClient=Y}async getUserIdByName(Y){try{return(await this.apiClient.users.getUserByName(Y))?.id??null}catch(M){return console.error(`[UserService] Error looking up user "${Y}":`,M),null}}async getUserByName(Y){try{return await this.apiClient.users.getUserByName(Y)}catch(M){return console.error(`[UserService] Error looking up user "${Y}":`,M),null}}async getUserById(Y){try{return await this.apiClient.users.getUserById(Y)}catch(M){return console.error(`[UserService] Error looking up user ID "${Y}":`,M),null}}async getUsersByNames(Y){try{return await this.apiClient.users.getUsersByNames(Y)}catch(M){return console.error("[UserService] Error looking up users:",M),[]}}}class C${bot;apiClient;userService;emoteService;statisticsService;messageHandler;constructor(Y,M){this.apiClient=new E3({authProvider:Y}),this.userService=new N$(this.apiClient),this.emoteService=new q$(this.userService),this.statisticsService=new R$,this.messageHandler=new L$(this.userService,this.emoteService,this.statisticsService),this.bot=new u1({authProvider:Y,channels:M,commands:[]}),this.setupEventHandlers(),this.emoteService.preloadChannelEmotes(M).catch(($)=>{console.error("[Bot] Error pre-loading emotes:",$)})}setupEventHandlers(){this.bot.onMessage(async(Y)=>{await this.messageHandler.handleMessage(Y)}),this.bot.onConnect(()=>{console.log("[Bot] Connected to Twitch chat")}),this.bot.onDisconnect((Y,M)=>{if(Y)console.log("[Bot] Manually disconnected");else console.log(`[Bot] Disconnected: ${M}`)})}getUserService(){return this.userService}getEmoteService(){return this.emoteService}getStatisticsService(){return this.statisticsService}getBot(){return this.bot}}class A${statisticsService;emoteService;port;server;constructor(Y,M,$=3000){this.statisticsService=Y;this.emoteService=M;this.port=$}start(){this.server=Bun.serve({port:this.port,fetch:(Y)=>this.handleRequest(Y)}),console.log(`[Dashboard] Server running at http://localhost:${this.port}`)}async handleRequest(Y){let M=new URL(Y.url);if(M.pathname==="/api/stats")return this.handleStatsAPI();if(M.pathname==="/"||M.pathname==="/index.html")return new Response(this.getHTML(),{headers:{"Content-Type":"text/html","Content-Security-Policy":"default-src 'self'; script-src 'unsafe-inline'; style-src 'unsafe-inline'; img-src 'self' https://cdn.7tv.app; connect-src 'self'"}});return new Response("Not Found",{status:404})}handleStatsAPI(){let Y=this.statisticsService.exportStats(),M=Y.channels.map(($)=>{let X=this.emoteService.getAllEmoteMetadata($.channelName);if(!X)return $;let O=new Map($.emotes.map((z)=>[z.emoteName,z])),J=Array.from(X.values()).map((z)=>{let V=O.get(z.name);return{emoteName:z.name,count:V?.count??0,lastUsed:V?.lastUsed??0,channel:$.channelName,emoteId:z.id,imageUrl:z.imageUrl,animated:z.animated}});return{...$,emotes:J.sort((z,V)=>V.count-z.count)}});return new Response(JSON.stringify({...Y,channels:M}),{headers:{"Content-Type":"application/json"}})}getHTML(){return`<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:,">
  <title>SmokeyBot - Emote Statistics</title>
  <script>(function(){var t=localStorage.getItem('smokeybot-theme');if(t!=='dark'&&t!=='light')t='dark';document.documentElement.setAttribute('data-theme',t);document.documentElement.classList.add('no-transition');})()</script>
  <style>
    :root {
      --font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.5rem;
      --font-size-2xl: 2rem;
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition-fast: 150ms ease;
      --transition-base: 250ms ease;
      --transition-theme: 300ms ease;
      --max-width: 1400px;
    }

    html[data-theme="dark"] {
      --color-bg-primary: #0f1923;
      --color-bg-secondary: #1a2634;
      --color-bg-card: rgba(26, 38, 52, 0.85);
      --color-bg-card-hover: rgba(26, 38, 52, 0.95);
      --color-bg-elevated: rgba(255, 255, 255, 0.06);
      --color-bg-input: rgba(255, 255, 255, 0.08);
      --color-border: rgba(255, 255, 255, 0.1);
      --color-border-hover: rgba(255, 255, 255, 0.2);
      --color-text-primary: #e8edf2;
      --color-text-secondary: rgba(232, 237, 242, 0.7);
      --color-text-muted: rgba(232, 237, 242, 0.5);
      --color-accent: #3b82f6;
      --color-accent-hover: #60a5fa;
      --color-accent-muted: rgba(59, 130, 246, 0.15);
      --color-success: #66bb6a;
      --color-error: #ef5350;
      --color-badge-used: #3b82f6;
      --color-badge-unused: rgba(255, 255, 255, 0.15);
      --color-badge-text: #ffffff;
      --color-row-hover: rgba(255, 255, 255, 0.04);
      --color-scrollbar-track: rgba(255, 255, 255, 0.05);
      --color-scrollbar-thumb: rgba(255, 255, 255, 0.2);
      --color-scrollbar-thumb-hover: rgba(255, 255, 255, 0.35);
      --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.3);
      --shadow-elevated: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    html[data-theme="light"] {
      --color-bg-primary: #f5f7fa;
      --color-bg-secondary: #ffffff;
      --color-bg-card: rgba(255, 255, 255, 0.9);
      --color-bg-card-hover: rgba(255, 255, 255, 1);
      --color-bg-elevated: rgba(0, 0, 0, 0.04);
      --color-bg-input: rgba(0, 0, 0, 0.05);
      --color-border: rgba(0, 0, 0, 0.1);
      --color-border-hover: rgba(0, 0, 0, 0.2);
      --color-text-primary: #1a1a2e;
      --color-text-secondary: rgba(26, 26, 46, 0.65);
      --color-text-muted: rgba(26, 26, 46, 0.4);
      --color-accent: #2563eb;
      --color-accent-hover: #3b82f6;
      --color-accent-muted: rgba(37, 99, 235, 0.1);
      --color-success: #16a34a;
      --color-error: #dc2626;
      --color-badge-used: #2563eb;
      --color-badge-unused: rgba(0, 0, 0, 0.08);
      --color-badge-text: #ffffff;
      --color-row-hover: rgba(0, 0, 0, 0.03);
      --color-scrollbar-track: rgba(0, 0, 0, 0.05);
      --color-scrollbar-thumb: rgba(0, 0, 0, 0.15);
      --color-scrollbar-thumb-hover: rgba(0, 0, 0, 0.25);
      --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
      --shadow-elevated: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    html.no-transition, html.no-transition * {
      transition: none !important;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body, .controls-bar, .stat-card, .channel-card,
    .emote-table-section, .emote-item, .top-emotes,
    .emote-table, .emote-table th, .emote-table td,
    .table-stats, .table-search-input, .toggle-slider, .btn {
      transition: background-color var(--transition-theme),
                  color var(--transition-theme),
                  border-color var(--transition-theme),
                  box-shadow var(--transition-theme);
    }

    body {
      font-family: var(--font-family);
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      padding: var(--space-lg);
      min-height: 100vh;
    }

    .container { max-width: var(--max-width); margin: 0 auto; }

    header { text-align: center; margin-bottom: var(--space-2xl); }

    h1 {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      margin-bottom: var(--space-sm);
      color: var(--color-text-primary);
    }

    .subtitle { font-size: var(--font-size-lg); color: var(--color-text-secondary); }

    /* Controls bar */
    .controls-bar {
      display: flex;
      align-items: center;
      gap: var(--space-lg);
      padding: var(--space-md) var(--space-lg);
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-xl);
      flex-wrap: wrap;
    }
    .controls-group {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    .controls-group--right { margin-left: auto; }
    .text-muted { color: var(--color-text-muted); font-size: var(--font-size-sm); }

    /* Toggle switch */
    .toggle { display: flex; align-items: center; gap: var(--space-sm); cursor: pointer; }
    .toggle input { display: none; }
    .toggle-slider {
      width: 40px; height: 22px;
      background: var(--color-bg-elevated);
      border-radius: 11px;
      position: relative;
      transition: background var(--transition-fast);
      border: 1px solid var(--color-border);
      flex-shrink: 0;
    }
    .toggle-slider::after {
      content: '';
      position: absolute;
      width: 16px; height: 16px;
      border-radius: 50%;
      background: var(--color-text-secondary);
      top: 2px; left: 2px;
      transition: transform var(--transition-fast), background var(--transition-fast);
    }
    .toggle input:checked + .toggle-slider {
      background: var(--color-accent-muted);
      border-color: var(--color-accent);
    }
    .toggle input:checked + .toggle-slider::after {
      transform: translateX(18px);
      background: var(--color-accent);
    }
    .toggle-label { font-size: var(--font-size-sm); color: var(--color-text-primary); }

    /* Buttons */
    .btn {
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      background: var(--color-bg-elevated);
      color: var(--color-text-primary);
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: background var(--transition-fast), border-color var(--transition-fast);
    }
    .btn:hover { background: var(--color-bg-card-hover); border-color: var(--color-border-hover); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .theme-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 50%;
      color: var(--color-text-secondary);
    }
    .theme-toggle-btn:hover { color: var(--color-accent); }
    .theme-toggle-btn svg { width: 18px; height: 18px; }

    /* Spinner */
    .spinner {
      display: inline-block;
      width: 18px; height: 18px;
      border: 2px solid var(--color-text-muted);
      border-top-color: var(--color-accent);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .stat-card {
      background: var(--color-bg-card);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      box-shadow: var(--shadow-card);
      border: 1px solid var(--color-border);
    }
    .stat-card h2 {
      font-size: var(--font-size-base);
      margin-bottom: var(--space-sm);
      color: var(--color-text-secondary);
      font-weight: 500;
    }
    .stat-value {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: bold;
      color: var(--color-accent);
    }
    .stat-value--changed { animation: valueFlash 0.6s ease; }
    @keyframes valueFlash {
      0% { color: var(--color-accent); transform: scale(1); }
      30% { color: var(--color-success); transform: scale(1.05); }
      100% { color: var(--color-accent); transform: scale(1); }
    }

    /* Channel section */
    .channel-section { margin-bottom: var(--space-xl); }

    .channel-card {
      background: var(--color-bg-card);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin-bottom: var(--space-lg);
      box-shadow: var(--shadow-card);
      border: 1px solid var(--color-border);
    }
    .channel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
      flex-wrap: wrap;
      gap: var(--space-md);
    }
    .channel-name {
      font-size: clamp(1.25rem, 3vw, 2rem);
      font-weight: bold;
      color: var(--color-accent);
    }
    .channel-stats { display: flex; gap: var(--space-xl); font-size: var(--font-size-base); }
    .channel-stat { display: flex; flex-direction: column; align-items: center; }
    .channel-stat-value { font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-text-primary); }
    .channel-stat-label { font-size: var(--font-size-sm); color: var(--color-text-muted); }

    /* Emote grid */
    .emote-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }
    .emote-item {
      background: var(--color-bg-elevated);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-sm);
      transition: background var(--transition-base), transform var(--transition-base);
      text-decoration: none;
      color: inherit;
      border: 1px solid transparent;
    }
    .emote-item:hover {
      background: var(--color-bg-card-hover);
      transform: translateY(-2px);
      cursor: pointer;
      border-color: var(--color-border);
    }
    .emote-info { display: flex; align-items: center; gap: var(--space-sm); flex: 1; min-width: 0; }
    .emote-image { width: 32px; height: 32px; object-fit: contain; flex-shrink: 0; }
    .emote-name {
      font-weight: 600;
      font-size: var(--font-size-base);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 200px;
    }
    .emote-count {
      background: var(--color-badge-used);
      color: var(--color-badge-text);
      padding: var(--space-xs) var(--space-md);
      border-radius: 20px;
      font-weight: bold;
      font-size: var(--font-size-sm);
      flex-shrink: 0;
    }
    .emote-count--zero {
      background: var(--color-badge-unused);
      color: var(--color-text-muted);
    }
    .no-emote-image {
      width: 32px; height: 32px;
      background: var(--color-bg-elevated);
      border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: var(--font-size-lg);
      flex-shrink: 0;
    }

    /* Top emotes */
    .top-emotes {
      background: var(--color-bg-card);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      box-shadow: var(--shadow-card);
      border: 1px solid var(--color-border);
    }
    .top-emotes h2 {
      font-size: var(--font-size-xl);
      margin-bottom: var(--space-md);
      text-align: center;
    }

    /* Loading */
    .loading {
      text-align: center;
      font-size: var(--font-size-xl);
      padding: var(--space-2xl);
      color: var(--color-text-secondary);
    }
    .loading .spinner { width: 32px; height: 32px; margin-bottom: var(--space-md); }

    /* Emote table section */
    .emote-table-section {
      background: var(--color-bg-card);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin-top: var(--space-lg);
      box-shadow: var(--shadow-card);
      border: 1px solid var(--color-border);
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      padding: var(--space-md);
      user-select: none;
      border-radius: var(--radius-md);
      transition: background var(--transition-fast);
    }
    .table-header:hover { background: var(--color-bg-elevated); }
    .table-header h3 { font-size: var(--font-size-lg); margin: 0; }
    .collapse-icon {
      font-size: var(--font-size-xl);
      transition: transform var(--transition-base);
      color: var(--color-text-muted);
    }
    .collapse-icon.expanded { transform: rotate(180deg); }

    .table-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .table-content.expanded {
      max-height: none;
      margin-top: var(--space-md);
      overflow: visible;
    }

    /* Search input */
    .table-search { margin-bottom: var(--space-md); }
    .table-search-input {
      width: 100%;
      padding: var(--space-sm) var(--space-md);
      background: var(--color-bg-input);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      color: var(--color-text-primary);
      font-size: var(--font-size-base);
      outline: none;
      transition: border-color var(--transition-fast);
    }
    .table-search-input:focus { border-color: var(--color-accent); }
    .table-search-input::placeholder { color: var(--color-text-muted); }

    .table-wrapper {
      max-height: 600px;
      overflow-y: auto;
      overflow-x: auto;
      border-radius: var(--radius-md);
      -webkit-overflow-scrolling: touch;
    }
    .table-wrapper::-webkit-scrollbar { width: 8px; height: 8px; }
    .table-wrapper::-webkit-scrollbar-track { background: var(--color-scrollbar-track); border-radius: 4px; }
    .table-wrapper::-webkit-scrollbar-thumb { background: var(--color-scrollbar-thumb); border-radius: 4px; }
    .table-wrapper::-webkit-scrollbar-thumb:hover { background: var(--color-scrollbar-thumb-hover); }

    .emote-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--color-bg-elevated);
      border-radius: var(--radius-md);
      overflow: hidden;
    }
    .emote-table thead {
      background: var(--color-bg-secondary);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .emote-table th {
      padding: var(--space-md);
      text-align: left;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      background: var(--color-bg-secondary);
      color: var(--color-text-secondary);
      font-size: var(--font-size-sm);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: color var(--transition-fast);
    }
    .emote-table th:hover { color: var(--color-text-primary); }
    .sort-indicator {
      display: inline-block;
      margin-left: var(--space-xs);
      opacity: 0.4;
      transition: opacity var(--transition-fast);
      vertical-align: middle;
    }
    .emote-table th:hover .sort-indicator { opacity: 0.7; }
    .emote-table th[aria-sort="ascending"] .sort-indicator,
    .emote-table th[aria-sort="descending"] .sort-indicator {
      opacity: 1;
      color: var(--color-accent);
    }
    .emote-table th[aria-sort="ascending"],
    .emote-table th[aria-sort="descending"] { color: var(--color-text-primary); }

    .emote-table td {
      padding: var(--space-sm) var(--space-md);
      border-top: 1px solid var(--color-border);
    }
    .emote-table tr:hover { background: var(--color-row-hover); }
    .emote-table-row { transition: background var(--transition-fast); }
    .emote-table-row--unused { opacity: 0.45; }
    .emote-table-row--unused:hover { opacity: 0.7; }
    .emote-table-row--new { animation: rowAppear 0.5s ease; }
    @keyframes rowAppear {
      from { background: var(--color-accent-muted); }
      to { background: transparent; }
    }

    .emote-table-image { width: 28px; height: 28px; object-fit: contain; vertical-align: middle; }
    .emote-table-link {
      color: var(--color-accent);
      text-decoration: none;
      font-weight: 600;
      font-size: var(--font-size-sm);
    }
    .emote-table-link:hover { text-decoration: underline; color: var(--color-accent-hover); }

    .table-stats {
      padding: var(--space-sm) var(--space-md);
      background: var(--color-bg-elevated);
      border-radius: var(--radius-sm);
      margin-bottom: var(--space-md);
      display: flex;
      gap: var(--space-lg);
      flex-wrap: wrap;
    }
    .table-stat-item { display: flex; flex-direction: column; }
    .table-stat-label { font-size: var(--font-size-xs); color: var(--color-text-muted); }
    .table-stat-value { font-size: var(--font-size-lg); font-weight: bold; color: var(--color-accent); }

    /* Toast system */
    .toast-container {
      position: fixed;
      bottom: var(--space-lg);
      right: var(--space-lg);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      pointer-events: none;
    }
    .toast {
      pointer-events: auto;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      color: var(--color-badge-text);
      font-size: var(--font-size-sm);
      box-shadow: var(--shadow-elevated);
      animation: toastIn var(--transition-base) forwards;
      max-width: 400px;
    }
    .toast--error { background: var(--color-error); }
    .toast--info { background: var(--color-accent); }
    .toast--leaving { animation: toastOut var(--transition-base) forwards; }
    @keyframes toastIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes toastOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(20px); }
    }

    /* Tablet */
    @media (max-width: 1024px) {
      .stats-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
      .emote-list { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
    }

    /* Mobile */
    @media (max-width: 768px) {
      body { padding: var(--space-md); }
      .stats-grid { grid-template-columns: 1fr; gap: var(--space-sm); }
      .channel-header { flex-direction: column; align-items: flex-start; }
      .channel-stats { width: 100%; justify-content: space-around; }
      .emote-list { grid-template-columns: 1fr 1fr; gap: var(--space-sm); }
      .emote-item { padding: var(--space-sm); }
      .emote-name { max-width: 100px; font-size: var(--font-size-sm); }
      .emote-table { min-width: 400px; }
      .controls-bar { flex-direction: column; gap: var(--space-sm); align-items: stretch; }
      .controls-group { justify-content: center; }
      .controls-group--right { margin-left: 0; justify-content: center; }
      .btn { min-height: 44px; padding: var(--space-md); font-size: var(--font-size-base); }
      .table-header { padding: var(--space-md) var(--space-sm); min-height: 48px; }
      .emote-table th, .emote-table td { padding: var(--space-md) var(--space-sm); }
      .table-search-input { padding: var(--space-md); font-size: 16px; }
      .toast-container { left: var(--space-md); right: var(--space-md); }
      .toast { max-width: none; }
    }

    /* Small phone */
    @media (max-width: 480px) {
      .emote-list { grid-template-columns: 1fr; }
      .channel-stats { gap: var(--space-md); }
      .table-stats { flex-direction: column; gap: var(--space-sm); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>SmokeyBot Dashboard</h1>
      <div class="subtitle">7TV Emote Statistics Tracker</div>
    </header>

    <div id="loading" class="loading">
      <div class="spinner" style="width:32px;height:32px;margin:0 auto var(--space-md)"></div>
      Loading statistics...
    </div>
    <div id="content" style="display: none;">
      <div class="controls-bar">
        <div class="controls-group">
          <label class="toggle" id="toggleLabel">
            <input type="checkbox" id="autoRefreshCheckbox">
            <span class="toggle-slider"></span>
            <span class="toggle-label">Auto-refresh</span>
          </label>
          <span class="text-muted" id="autoRefreshStatus">Every 5s</span>
        </div>
        <div class="controls-group">
          <button id="refreshBtn" class="btn">Refresh Now</button>
          <span id="loadingSpinner" class="spinner" style="display:none"></span>
        </div>
        <div class="controls-group controls-group--right">
          <span class="text-muted">Updated <span id="lastUpdated">never</span></span>
          <button class="btn theme-toggle-btn" id="themeToggle" aria-label="Toggle theme">
            <span id="themeIcon"></span>
          </button>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <h2>Total Messages</h2>
          <div class="stat-value" id="totalMessages">0</div>
        </div>
        <div class="stat-card">
          <h2>Total Emotes Used</h2>
          <div class="stat-value" id="totalEmotes">0</div>
        </div>
        <div class="stat-card">
          <h2>Channels Tracked</h2>
          <div class="stat-value" id="totalChannels">0</div>
        </div>
      </div>

      <div class="top-emotes">
        <h2>Top Emotes (All Channels)</h2>
        <div class="emote-list" id="topEmotes"></div>
      </div>

      <div class="channel-section" id="channels"></div>

      <div id="emoteTables"></div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container"></div>

  <script>
  (function() {
    'use strict';

    // =========== State ===========
    var state = {
      tableStates: {},
      sortStates: {},
      searchFilters: {},
      latestChannelData: [],
      previousEmotes: {},
      autoRefreshEnabled: true,
      refreshInterval: null,
      lastUpdated: null
    };

    // =========== DOM Cache ===========
    var dom = {};
    function cacheDom() {
      dom.loading = document.getElementById('loading');
      dom.content = document.getElementById('content');
      dom.totalMessages = document.getElementById('totalMessages');
      dom.totalEmotes = document.getElementById('totalEmotes');
      dom.totalChannels = document.getElementById('totalChannels');
      dom.topEmotes = document.getElementById('topEmotes');
      dom.channels = document.getElementById('channels');
      dom.emoteTables = document.getElementById('emoteTables');
      dom.lastUpdated = document.getElementById('lastUpdated');
      dom.autoRefreshCheckbox = document.getElementById('autoRefreshCheckbox');
      dom.autoRefreshStatus = document.getElementById('autoRefreshStatus');
      dom.toastContainer = document.getElementById('toastContainer');
      dom.refreshBtn = document.getElementById('refreshBtn');
      dom.loadingSpinner = document.getElementById('loadingSpinner');
      dom.themeToggle = document.getElementById('themeToggle');
      dom.themeIcon = document.getElementById('themeIcon');
    }

    // =========== HTML Escaping ===========
    function escapeHtml(str) {
      if (!str) return '';
      return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;')
        .replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    // =========== Theme ===========
    var THEME_KEY = 'smokeybot-theme';
    var SUN_SVG = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>';
    var MOON_SVG = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>';

    function getTheme() {
      return document.documentElement.getAttribute('data-theme') || 'dark';
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      try { localStorage.setItem(THEME_KEY, theme); } catch(e) {}
      updateThemeIcon(theme);
    }

    function toggleTheme() {
      setTheme(getTheme() === 'dark' ? 'light' : 'dark');
    }

    function updateThemeIcon(theme) {
      if (!dom.themeIcon) return;
      dom.themeIcon.innerHTML = theme === 'dark' ? SUN_SVG : MOON_SVG;
    }

    // =========== Persistence ===========
    var STORAGE_KEY = 'smokeybot-dashboard';

    function loadState() {
      try {
        var saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;
        var parsed = JSON.parse(saved);
        if (parsed.tableStates) state.tableStates = parsed.tableStates;
        if (parsed.sortStates) state.sortStates = parsed.sortStates;
        if (typeof parsed.autoRefreshEnabled === 'boolean') {
          state.autoRefreshEnabled = parsed.autoRefreshEnabled;
        }
      } catch (e) {
        console.warn('[Dashboard] Failed to load saved state:', e);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({
          tableStates: state.tableStates,
          sortStates: state.sortStates,
          autoRefreshEnabled: state.autoRefreshEnabled
        }));
      } catch (e) {
        console.warn('[Dashboard] Failed to save state:', e);
      }
    }

    // =========== Toast ===========
    function showToast(message, type) {
      type = type || 'info';
      var toast = document.createElement('div');
      toast.className = 'toast toast--' + type;
      toast.textContent = message;
      dom.toastContainer.appendChild(toast);
      setTimeout(function() {
        toast.classList.add('toast--leaving');
        toast.addEventListener('animationend', function() { toast.remove(); });
      }, 4000);
    }

    // =========== Relative Time ===========
    function relativeTime(timestamp) {
      if (!timestamp) return 'never';
      var seconds = Math.floor((Date.now() - timestamp) / 1000);
      if (seconds < 5) return 'just now';
      if (seconds < 60) return seconds + 's ago';
      var minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + 'm ago';
      var hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + 'h ago';
      return new Date(timestamp).toLocaleDateString();
    }

    function updateTimeDisplay() {
      if (dom.lastUpdated) {
        dom.lastUpdated.textContent = relativeTime(state.lastUpdated);
      }
    }

    // =========== Value Animation ===========
    function animateValueChange(element, newValue) {
      var formatted = newValue.toLocaleString();
      if (element.textContent !== formatted) {
        element.textContent = formatted;
        element.classList.remove('stat-value--changed');
        void element.offsetWidth;
        element.classList.add('stat-value--changed');
      }
    }

    // =========== API ===========
    async function fetchStats() {
      if (dom.loadingSpinner) dom.loadingSpinner.style.display = 'inline-block';
      if (dom.refreshBtn) dom.refreshBtn.disabled = true;
      try {
        var response = await fetch('/api/stats');
        if (!response.ok) throw new Error('HTTP ' + response.status);
        var data = await response.json();
        updateDashboard(data);
      } catch (error) {
        var msg = error instanceof Error ? error.message : String(error);
        showToast('Failed to fetch stats: ' + msg, 'error');
      } finally {
        if (dom.loadingSpinner) dom.loadingSpinner.style.display = 'none';
        if (dom.refreshBtn) dom.refreshBtn.disabled = false;
      }
    }

    // =========== Rendering ===========
    function renderEmote(emote) {
      var hasMetadata = emote.emoteId && emote.imageUrl;
      var safeName = escapeHtml(emote.emoteName);
      var safeUrl = escapeHtml(emote.imageUrl);
      var safeId = escapeHtml(emote.emoteId);
      var emoteLink = hasMetadata ? 'https://7tv.app/emotes/' + safeId : '#';
      var imageHtml = hasMetadata
        ? '<img src="' + safeUrl + '" alt="' + safeName + '" class="emote-image" loading="lazy">'
        : '<div class="no-emote-image">?</div>';

      var displayName = emote.emoteName.length > 16
        ? escapeHtml(emote.emoteName.substring(0, 14)) + '...'
        : safeName;

      var wrapper = hasMetadata ? 'a' : 'div';
      var linkAttrs = hasMetadata ? 'href="' + emoteLink + '" target="_blank" rel="noopener noreferrer"' : '';
      var countClass = emote.count === 0 ? 'emote-count emote-count--zero' : 'emote-count';

      return '<' + wrapper + ' class="emote-item" ' + linkAttrs + ' title="' + safeName + '">'
        + '<div class="emote-info">' + imageHtml
        + '<span class="emote-name">' + displayName + '</span></div>'
        + '<span class="' + countClass + '">' + emote.count + '</span>'
        + '</' + wrapper + '>';
    }

    function renderTableRow(emote, isNew) {
      var hasMetadata = emote.emoteId && emote.imageUrl;
      var safeName = escapeHtml(emote.emoteName);
      var safeUrl = escapeHtml(emote.imageUrl);
      var safeId = escapeHtml(emote.emoteId);
      var imageHtml = hasMetadata
        ? '<img src="' + safeUrl + '" alt="' + safeName + '" class="emote-table-image" loading="lazy">'
        : '?';
      var linkHtml = hasMetadata
        ? '<a href="https://7tv.app/emotes/' + safeId + '" target="_blank" rel="noopener noreferrer" class="emote-table-link">View</a>'
        : '-';

      var rowClass = 'emote-table-row';
      if (emote.count === 0) rowClass += ' emote-table-row--unused';
      if (isNew) rowClass += ' emote-table-row--new';

      return '<tr class="' + rowClass + '">'
        + '<td>' + imageHtml + '</td>'
        + '<td>' + safeName + '</td>'
        + '<td><strong>' + emote.count + '</strong></td>'
        + '<td>' + linkHtml + '</td></tr>';
    }

    function updateDashboard(data) {
      dom.loading.style.display = 'none';
      dom.content.style.display = 'block';

      var totalMessages = data.channels.reduce(function(sum, ch) { return sum + ch.totalMessages; }, 0);
      var totalEmotes = data.channels.reduce(function(sum, ch) { return sum + ch.totalEmotesUsed; }, 0);

      animateValueChange(dom.totalMessages, totalMessages);
      animateValueChange(dom.totalEmotes, totalEmotes);
      animateValueChange(dom.totalChannels, data.channels.length);

      dom.topEmotes.innerHTML = data.topEmotes.map(renderEmote).join('');

      dom.channels.innerHTML = data.channels.map(function(channel) {
        var safeChannel = escapeHtml(channel.channelName);
        return '<div class="channel-card">'
          + '<div class="channel-header">'
          + '<div class="channel-name">#' + safeChannel + '</div>'
          + '<div class="channel-stats">'
          + '<div class="channel-stat"><div class="channel-stat-value">' + channel.totalMessages.toLocaleString() + '</div><div class="channel-stat-label">Messages</div></div>'
          + '<div class="channel-stat"><div class="channel-stat-value">' + channel.totalEmotesUsed.toLocaleString() + '</div><div class="channel-stat-label">Emotes</div></div>'
          + '</div></div>'
          + '<div class="emote-list">' + channel.emotes.slice(0, 10).map(renderEmote).join('') + '</div>'
          + '</div>';
      }).join('');

      // Track new emotes for highlight animation
      var newEmoteSets = {};
      data.channels.forEach(function(channel) {
        var prev = state.previousEmotes[channel.channelName];
        if (prev) {
          var newSet = {};
          channel.emotes.forEach(function(e) {
            if (e.count > 0 && !prev[e.emoteName]) newSet[e.emoteName] = true;
          });
          newEmoteSets[channel.channelName] = newSet;
        }
        var current = {};
        channel.emotes.forEach(function(e) {
          if (e.count > 0) current[e.emoteName] = true;
        });
        state.previousEmotes[channel.channelName] = current;
      });

      state.latestChannelData = data.channels;
      renderEmoteTables(data.channels, newEmoteSets);

      state.lastUpdated = Date.now();
      updateTimeDisplay();
    }

    function renderEmoteTables(channels, newEmoteSets) {
      newEmoteSets = newEmoteSets || {};

      // Save focused search input
      var focusedChannel = null;
      var focusedCursor = 0;
      var activeEl = document.activeElement;
      if (activeEl && activeEl.dataset && activeEl.dataset.action === 'search') {
        focusedChannel = activeEl.dataset.channel;
        focusedCursor = activeEl.selectionStart || 0;
      }

      dom.emoteTables.innerHTML = channels.map(function(channel) {
        var channelId = channel.channelName;
        var safeChannelId = escapeHtml(channelId);
        var isExpanded = state.tableStates[channelId] || false;
        var usedEmotes = channel.emotes.filter(function(e) { return e.count > 0; });
        var unusedCount = channel.emotes.length - usedEmotes.length;
        var newSet = newEmoteSets[channelId] || {};

        var sortState = state.sortStates[channelId] || { column: 'count', direction: 'desc' };

        function ariaSort(col) {
          if (sortState.column !== col) return 'none';
          return sortState.direction === 'asc' ? 'ascending' : 'descending';
        }
        function sortIcon(col) {
          if (sortState.column !== col) return '<span class="sort-indicator">&#x21C5;</span>';
          return sortState.direction === 'asc'
            ? '<span class="sort-indicator">&#x2191;</span>'
            : '<span class="sort-indicator">&#x2193;</span>';
        }

        // Sort emotes based on current sort state
        var sortedEmotes = channel.emotes.slice();
        if (sortState.column === 'name') {
          sortedEmotes.sort(function(a, b) {
            var cmp = a.emoteName.localeCompare(b.emoteName);
            return sortState.direction === 'asc' ? cmp : -cmp;
          });
        } else if (sortState.column === 'count') {
          sortedEmotes.sort(function(a, b) {
            var cmp = a.count - b.count;
            return sortState.direction === 'asc' ? cmp : -cmp;
          });
        }

        var tableContent = '';
        if (isExpanded) {
          var searchVal = escapeHtml(state.searchFilters[channelId] || '');
          tableContent = '<div class="table-stats">'
            + '<div class="table-stat-item"><span class="table-stat-label">Total Emotes</span><span class="table-stat-value">' + channel.emotes.length + '</span></div>'
            + '<div class="table-stat-item"><span class="table-stat-label">Used</span><span class="table-stat-value">' + usedEmotes.length + '</span></div>'
            + '<div class="table-stat-item"><span class="table-stat-label">Unused</span><span class="table-stat-value">' + unusedCount + '</span></div>'
            + '</div>'
            + '<div class="table-search"><input type="text" class="table-search-input" placeholder="Filter emotes..." data-channel="' + safeChannelId + '" data-action="search" value="' + searchVal + '"></div>'
            + '<div class="table-wrapper">'
            + '<table class="emote-table" id="emote-table-' + safeChannelId + '">'
            + '<thead><tr>'
            + '<th>Preview</th>'
            + '<th data-action="sort" data-channel="' + safeChannelId + '" data-column="name" aria-sort="' + ariaSort('name') + '">Name ' + sortIcon('name') + '</th>'
            + '<th data-action="sort" data-channel="' + safeChannelId + '" data-column="count" aria-sort="' + ariaSort('count') + '">Uses ' + sortIcon('count') + '</th>'
            + '<th>Link</th>'
            + '</tr></thead>'
            + '<tbody id="table-body-' + safeChannelId + '">'
            + sortedEmotes.map(function(emote) { return renderTableRow(emote, !!newSet[emote.emoteName]); }).join('')
            + '</tbody></table></div>';
        } else {
          tableContent = '<p style="text-align:center;padding:var(--space-lg);color:var(--color-text-muted);">Click to expand and view all emotes</p>';
        }

        return '<div class="emote-table-section">'
          + '<div class="table-header" data-action="toggle-table" data-channel="' + safeChannelId + '">'
          + '<h3>All Emotes for #' + safeChannelId + ' (' + channel.emotes.length + ' total)</h3>'
          + '<span class="collapse-icon ' + (isExpanded ? 'expanded' : '') + '">&#x25BC;</span>'
          + '</div>'
          + '<div class="table-content ' + (isExpanded ? 'expanded' : '') + '" id="table-' + safeChannelId + '">'
          + tableContent
          + '</div></div>';
      }).join('');

      // Restore search filters and focus
      Object.keys(state.searchFilters).forEach(function(channelId) {
        if (state.searchFilters[channelId]) {
          filterTableRows(channelId);
        }
      });
      if (focusedChannel) {
        var restored = dom.emoteTables.querySelector('[data-channel="' + focusedChannel + '"][data-action="search"]');
        if (restored) {
          restored.focus();
          restored.setSelectionRange(focusedCursor, focusedCursor);
        }
      }
    }

    // =========== Search/Filter ===========
    function filterTableRows(channelId) {
      var filter = (state.searchFilters[channelId] || '').toLowerCase();
      var tbody = document.getElementById('table-body-' + channelId);
      if (!tbody) return;
      var rows = tbody.querySelectorAll('tr');
      rows.forEach(function(row) {
        var nameCell = row.querySelector('td:nth-child(2)');
        if (!nameCell) return;
        var name = nameCell.textContent.toLowerCase();
        row.style.display = name.indexOf(filter) !== -1 ? '' : 'none';
      });
    }

    // =========== Table Interactions ===========
    function toggleTable(channelId) {
      state.tableStates[channelId] = !state.tableStates[channelId];
      saveState();
      renderEmoteTables(state.latestChannelData);
    }

    function sortTable(channelId, column) {
      if (!state.sortStates[channelId]) {
        state.sortStates[channelId] = { column: 'count', direction: 'desc' };
      }

      if (state.sortStates[channelId].column === column) {
        state.sortStates[channelId].direction = state.sortStates[channelId].direction === 'asc' ? 'desc' : 'asc';
      } else {
        state.sortStates[channelId].column = column;
        state.sortStates[channelId].direction = column === 'count' ? 'desc' : 'asc';
      }

      saveState();
      renderEmoteTables(state.latestChannelData);
    }

    // =========== Auto-Refresh ===========
    function syncAutoRefreshUI() {
      dom.autoRefreshCheckbox.checked = state.autoRefreshEnabled;
      dom.autoRefreshStatus.textContent = state.autoRefreshEnabled ? 'Every 5s' : 'Paused';
    }

    function toggleAutoRefresh() {
      state.autoRefreshEnabled = !state.autoRefreshEnabled;
      syncAutoRefreshUI();
      saveState();
      if (state.autoRefreshEnabled) {
        startAutoRefresh();
      } else {
        stopAutoRefresh();
      }
    }

    function startAutoRefresh() {
      if (state.refreshInterval) clearInterval(state.refreshInterval);
      state.refreshInterval = setInterval(function() {
        if (state.autoRefreshEnabled) fetchStats();
      }, 5000);
    }

    function stopAutoRefresh() {
      if (state.refreshInterval) {
        clearInterval(state.refreshInterval);
        state.refreshInterval = null;
      }
    }

    // =========== Event Binding ===========
    function bindEvents() {
      // Event delegation on emote tables
      dom.emoteTables.addEventListener('click', function(e) {
        var toggleEl = e.target.closest('[data-action="toggle-table"]');
        if (toggleEl) {
          toggleTable(toggleEl.dataset.channel);
          return;
        }
        var sortEl = e.target.closest('[data-action="sort"]');
        if (sortEl) {
          sortTable(sortEl.dataset.channel, sortEl.dataset.column);
          return;
        }
      });

      // Search input
      dom.emoteTables.addEventListener('input', function(e) {
        if (e.target.matches && e.target.matches('[data-action="search"]')) {
          var channelId = e.target.dataset.channel;
          state.searchFilters[channelId] = e.target.value;
          filterTableRows(channelId);
        }
      });

      // Auto-refresh toggle
      document.getElementById('toggleLabel').addEventListener('click', function(e) {
        e.preventDefault();
        toggleAutoRefresh();
      });

      // Refresh button
      dom.refreshBtn.addEventListener('click', function() { fetchStats(); });

      // Theme toggle
      dom.themeToggle.addEventListener('click', toggleTheme);
    }

    // =========== Init ===========
    function init() {
      cacheDom();
      loadState();
      updateThemeIcon(getTheme());
      syncAutoRefreshUI();
      bindEvents();
      fetchStats();
      if (state.autoRefreshEnabled) startAutoRefresh();
      // Update relative time every second
      setInterval(updateTimeDisplay, 1000);
      // Remove no-transition class after first paint (double-rAF for robustness)
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          document.documentElement.classList.remove('no-transition');
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
  </script>
</body>
</html>`}stop(){if(this.server)this.server.stop(),console.log("[Dashboard] Server stopped")}}var p3=null;async function S8(){try{console.log("[Main] Starting Twitch Chat Bot...");let Y=U$();console.log(`[Main] Loaded configuration for ${Y.channels.length} channel(s): ${Y.channels.join(", ")}`);let M=new r1,$=r1.createInitialToken(Y.accessToken,Y.refreshToken),X=await M.createAuthProvider(Y.clientId,Y.clientSecret,$);console.log("[Main] Authentication provider initialized"),p3=new C$(X,Y.channels),await p3.getStatisticsService().loadStats(),p3.getStatisticsService().startAutoSave(),console.log("[Main] Bot initialized and connecting to channels..."),console.log("[Main] Bot is now listening to chat messages. Press Ctrl+C to stop."),new A$(p3.getStatisticsService(),p3.getEmoteService(),3000).start(),console.log("[Main] Dashboard available at http://localhost:3000")}catch(Y){console.error("[Main] Fatal error:",Y),process.exit(1)}}async function x9(){if(console.log(`
[Main] Shutting down bot...`),p3)await p3.getStatisticsService().stopAutoSave();process.exit(0)}process.on("SIGINT",x9);process.on("SIGTERM",x9);S8();
